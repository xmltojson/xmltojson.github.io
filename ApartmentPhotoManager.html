<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Apartment Photo Manager</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ==================== CSS Variables ==================== */
        :root {
            --primary-color: #6366f1;
            --primary-dark: #4f46e5;
            --primary-light: #818cf8;
            --secondary-color: #64748b;
            --success-color: #22c55e;
            --danger-color: #ef4444;
            --warning-color: #f59e0b;
            --background: #0f172a;
            --surface: #1e293b;
            --surface-light: #334155;
            --text-primary: #f8fafc;
            --text-secondary: #94a3b8;
            --border-color: #475569;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.4);
            --radius: 12px;
            --radius-sm: 8px;
            --transition: all 0.3s ease;
        }

        /* ==================== Reset & Base ==================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            font-size: 16px;
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: var(--background);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }

        /* ==================== App Container ==================== */
        .app-container {
            max-width: 1200px;
            margin: 0 auto;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* ==================== Header ==================== */
        .header {
            background: linear-gradient(135deg, var(--surface) 0%, var(--surface-light) 100%);
            padding: 1rem;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow);
            border-bottom: 1px solid var(--border-color);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-light);
        }

        .logo i {
            font-size: 1.75rem;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-actions {
            display: flex;
            gap: 0.5rem;
        }

        /* ==================== Buttons ==================== */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: var(--radius);
            font-family: inherit;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, var(--primary-light), var(--primary-color));
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-secondary {
            background: var(--surface-light);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: var(--border-color);
        }

        .btn-danger {
            background: var(--danger-color);
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background: #16a34a;
        }

        .btn-google {
            background: #4285f4;
            color: white;
            width: 100%;
        }

        .btn-google:hover {
            background: #3367d6;
        }

        .btn-icon {
            width: 44px;
            height: 44px;
            border: none;
            border-radius: var(--radius-sm);
            background: var(--surface);
            color: var(--text-secondary);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
        }

        .btn-icon:hover {
            background: var(--primary-color);
            color: white;
        }

        .btn-close {
            width: 36px;
            height: 36px;
            border: none;
            border-radius: 50%;
            background: var(--surface-light);
            color: var(--text-secondary);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-close:hover {
            background: var(--danger-color);
            color: white;
        }

        /* ==================== Main Content ==================== */
        .main-content {
            flex: 1;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        /* ==================== Cards ==================== */
        .card {
            background: var(--surface);
            border-radius: var(--radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
        }

        .card h2 {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.25rem;
            margin-bottom: 1.25rem;
            color: var(--primary-light);
        }

        /* ==================== Forms ==================== */
        .form-group {
            margin-bottom: 1rem;
        }

        .form-group:last-child {
            margin-bottom: 0;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid var(--border-color);
            border-radius: var(--radius-sm);
            background: var(--background);
            color: var(--text-primary);
            font-family: inherit;
            font-size: 1rem;
            transition: var(--transition);
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .form-group small {
            display: block;
            margin-top: 0.5rem;
            color: var(--text-secondary);
            font-size: 0.8rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        /* ==================== Photo Counter ==================== */
        .photo-counter {
            background: var(--surface);
            border-radius: var(--radius);
            padding: 1rem 1.5rem;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
        }

        .counter-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }

        .counter-label {
            font-weight: 500;
            color: var(--text-secondary);
        }

        .counter-value {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--primary-light);
        }

        .progress-bar {
            height: 8px;
            background: var(--background);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--success-color));
            border-radius: 4px;
            transition: width 0.5s ease;
            width: 0%;
        }

        /* ==================== Photo Grid ==================== */
        .photo-section {
            flex: 1;
        }

        .photo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .photo-card {
            position: relative;
            aspect-ratio: 1;
            border-radius: var(--radius);
            overflow: hidden;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--shadow);
            border: 2px solid transparent;
        }

        .photo-card:hover {
            transform: scale(1.03);
            border-color: var(--primary-color);
        }

        .photo-card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .photo-card-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 0.75rem;
            background: linear-gradient(transparent, rgba(0, 0, 0, 0.8));
            color: white;
        }

        .photo-card-label {
            font-size: 0.8rem;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .photo-card-status {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
        }

        .photo-card-status.pending {
            background: var(--warning-color);
            color: white;
        }

        .photo-card-status.uploaded {
            background: var(--success-color);
            color: white;
        }

        .photo-card-status.error {
            background: var(--danger-color);
            color: white;
        }

        /* ==================== Add Photo Button ==================== */
        .add-photo-container {
            margin-top: 1rem;
        }

        .add-photo-btn {
            width: 100%;
            padding: 2rem;
            border: 3px dashed var(--border-color);
            border-radius: var(--radius);
            background: var(--surface);
            color: var(--text-secondary);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.75rem;
            font-family: inherit;
            font-size: 1rem;
        }

        .add-photo-btn i {
            font-size: 2.5rem;
            color: var(--primary-color);
        }

        .add-photo-btn:hover {
            border-color: var(--primary-color);
            background: rgba(99, 102, 241, 0.1);
            color: var(--text-primary);
        }

        .add-photo-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* ==================== Action Section ==================== */
        .action-section {
            display: flex;
            gap: 1rem;
            padding-top: 1rem;
        }

        .action-section .btn {
            flex: 1;
        }

        /* ==================== Modals ==================== */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(4px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
            padding: 1rem;
        }

        .modal.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: var(--surface);
            border-radius: var(--radius);
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            transform: scale(0.9);
            transition: var(--transition);
            box-shadow: var(--shadow-lg);
        }

        .modal.active .modal-content {
            transform: scale(1);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .modal-header h3 {
            font-size: 1.25rem;
            color: var(--text-primary);
        }

        .modal-body {
            padding: 1.5rem;
            overflow-y: auto;
            flex: 1;
        }

        .modal-body img {
            width: 100%;
            border-radius: var(--radius-sm);
            margin-bottom: 1rem;
        }

        .modal-footer {
            display: flex;
            gap: 1rem;
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--border-color);
        }

        .modal-footer .btn {
            flex: 1;
        }

        /* ==================== Dialog Modal ==================== */
        .dialog-content {
            max-width: 400px;
        }

        .dialog-icon {
            width: 64px;
            height: 64px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1.5rem;
            font-size: 2rem;
        }

        .dialog-icon.warning {
            background: rgba(245, 158, 11, 0.2);
            color: var(--warning-color);
        }

        .dialog-icon.danger {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger-color);
        }

        .dialog-icon.success {
            background: rgba(34, 197, 94, 0.2);
            color: var(--success-color);
        }

        .dialog-icon.info {
            background: rgba(99, 102, 241, 0.2);
            color: var(--primary-color);
        }

        .dialog-title {
            text-align: center;
            font-size: 1.25rem;
            margin-bottom: 0.75rem;
            color: var(--text-primary);
        }

        .dialog-message {
            text-align: center;
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }

        .dialog-buttons {
            display: flex;
            gap: 1rem;
        }

        .dialog-buttons .btn {
            flex: 1;
        }

        /* ==================== Photo Details ==================== */
        .photo-details {
            margin-top: 1rem;
        }

        .photo-meta {
            display: flex;
            justify-content: space-between;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border-color);
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        /* ==================== Settings ==================== */
        .settings-section {
            margin-bottom: 2rem;
        }

        .settings-section:last-child {
            margin-bottom: 0;
        }

        .settings-section h4 {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
            color: var(--primary-light);
            font-size: 1rem;
        }

        .connection-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
            padding: 0.75rem;
            background: var(--background);
            border-radius: var(--radius-sm);
        }

        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        .status-indicator.connected {
            background: var(--success-color);
            box-shadow: 0 0 8px var(--success-color);
        }

        .status-indicator.disconnected {
            background: var(--danger-color);
        }

        /* ==================== Loading Overlay ==================== */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(15, 23, 42, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .loading-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .loading-spinner {
            text-align: center;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 4px solid var(--surface-light);
            border-top-color: var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .loading-spinner p {
            color: var(--text-secondary);
            font-size: 1rem;
        }

        /* ==================== Toast Notifications ==================== */
        .toast-container {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            z-index: 3000;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .toast {
            padding: 1rem 1.5rem;
            border-radius: var(--radius-sm);
            color: white;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            animation: slideIn 0.3s ease;
            box-shadow: var(--shadow-lg);
            max-width: 350px;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .toast.success {
            background: var(--success-color);
        }

        .toast.error {
            background: var(--danger-color);
        }

        .toast.warning {
            background: var(--warning-color);
        }

        .toast.info {
            background: var(--primary-color);
        }

        /* ==================== Empty State ==================== */
        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: var(--text-secondary);
        }

        .empty-state i {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .empty-state h3 {
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        /* ==================== Responsive Design ==================== */

        /* Tablets */
        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .photo-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }
            
            .action-section {
                flex-direction: column;
            }
            
            .modal-content {
                max-height: 95vh;
            }
        }

        /* Mobile */
        @media (max-width: 480px) {
            html {
                font-size: 14px;
            }
            
            .header {
                padding: 0.75rem;
            }
            
            .logo span {
                display: none;
            }
            
            .main-content {
                padding: 0.75rem;
            }
            
            .card {
                padding: 1rem;
            }
            
            .photo-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.75rem;
            }
            
            .add-photo-btn {
                padding: 1.5rem;
            }
            
            .add-photo-btn i {
                font-size: 2rem;
            }
            
            .toast-container {
                left: 1rem;
                right: 1rem;
            }
            
            .toast {
                max-width: 100%;
            }

            .dialog-buttons {
                flex-direction: column;
            }
        }

        /* Landscape Mobile */
        @media (max-height: 500px) and (orientation: landscape) {
            .header {
                padding: 0.5rem 1rem;
            }
            
            .main-content {
                padding: 0.5rem 1rem;
                gap: 0.75rem;
            }
            
            .photo-grid {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
                gap: 0.5rem;
            }
            
            .card {
                padding: 0.75rem;
            }
            
            .card h2 {
                font-size: 1rem;
                margin-bottom: 0.75rem;
            }
            
            .modal-content {
                max-height: 95vh;
                flex-direction: row;
                max-width: 90vw;
            }
            
            .modal-body {
                display: flex;
                gap: 1rem;
            }
            
            .modal-body img {
                width: 50%;
                margin-bottom: 0;
                object-fit: contain;
            }
            
            .photo-details {
                flex: 1;
                margin-top: 0;
            }
        }

        /* Large Screens */
        @media (min-width: 1024px) {
            .photo-grid {
                grid-template-columns: repeat(5, 1fr);
            }
        }

        /* Extra Large Screens */
        @media (min-width: 1400px) {
            .app-container {
                max-width: 1400px;
            }
            
            .photo-grid {
                grid-template-columns: repeat(6, 1fr);
            }
        }

        /* Dark Mode Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--background);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--surface-light);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--border-color);
        }

        /* Selection */
        ::selection {
            background: var(--primary-color);
            color: white;
        }

        /* Focus Visible */
        :focus-visible {
            outline: 2px solid var(--primary-color);
            outline-offset: 2px;
        }

        /* Print Styles */
        @media print {
            .header,
            .action-section,
            .add-photo-container {
                display: none;
            }
            
            .photo-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-building"></i>
                    <span>ApartSnap</span>
                </div>
                <div class="header-actions">
                    <button class="btn-icon" id="exportBtn" title="Export Data">
                        <i class="fas fa-download"></i>
                    </button>
                    <button class="btn-icon" id="settingsBtn" title="Settings">
                        <i class="fas fa-cog"></i>
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Apartment Info Section -->
            <section class="apartment-info card">
                <h2><i class="fas fa-home"></i> Apartment Details</h2>
                <div class="form-group">
                    <label for="apartmentName">Apartment Name/ID</label>
                    <input type="text" id="apartmentName" placeholder="e.g., Sunset View Apt #301">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="apartmentAddress">Address</label>
                        <input type="text" id="apartmentAddress" placeholder="123 Main Street">
                    </div>
                    <div class="form-group">
                        <label for="inspectionDate">Inspection Date</label>
                        <input type="date" id="inspectionDate">
                    </div>
                </div>
                <div class="form-group">
                    <label for="notes">Notes</label>
                    <textarea id="notes" placeholder="Additional notes about the apartment..."></textarea>
                </div>
            </section>

            <!-- Photo Counter -->
            <div class="photo-counter">
                <div class="counter-info">
                    <span class="counter-label">Photos</span>
                    <span class="counter-value"><span id="photoCount">0</span>/15</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
            </div>

            <!-- Photo Grid -->
            <section class="photo-section">
                <div class="photo-grid" id="photoGrid">
                    <!-- Photos will be dynamically added here -->
                </div>
                
                <!-- Add Photo Button -->
                <div class="add-photo-container" id="addPhotoContainer">
                    <button class="add-photo-btn" id="addPhotoBtn">
                        <i class="fas fa-camera"></i>
                        <span>Add Photo</span>
                    </button>
                    <input type="file" id="photoInput" accept="image/*" capture="environment" multiple hidden>
                </div>
            </section>

            <!-- Action Buttons -->
            <section class="action-section">
                <button class="btn btn-primary" id="saveAllBtn">
                    <i class="fas fa-save"></i>
                    <span>Save to Device</span>
                </button>
                <button class="btn btn-secondary" id="clearAllBtn">
                    <i class="fas fa-trash-alt"></i>
                    <span>Clear All</span>
                </button>
            </section>
        </main>

        <!-- Photo Modal -->
        <div class="modal" id="photoModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="modalTitle">Photo Preview</h3>
                    <button class="btn-close" id="closeModal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <img id="modalImage" src="" alt="Photo preview">
                    <div class="photo-details">
                        <div class="form-group">
                            <label for="photoLabel">Photo Label</label>
                            <input type="text" id="photoLabel" placeholder="e.g., Living Room">
                        </div>
                        <div class="photo-meta">
                            <span id="photoDate"></span>
                            <span id="photoSize"></span>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-danger" id="deletePhotoBtn">
                        <i class="fas fa-trash"></i> Delete
                    </button>
                    <button class="btn btn-primary" id="savePhotoBtn">
                        <i class="fas fa-save"></i> Save
                    </button>
                </div>
            </div>
        </div>

        <!-- Settings Modal -->
        <div class="modal" id="settingsModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Settings</h3>
                    <button class="btn-close" id="closeSettings">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="settings-section">
                        <h4><i class="fas fa-image"></i> Photo Settings</h4>
                        <div class="form-group">
                            <label for="imageQuality">Image Quality</label>
                            <select id="imageQuality">
                                <option value="0.5">Low (smaller files)</option>
                                <option value="0.7" selected>Medium</option>
                                <option value="0.85">High</option>
                                <option value="0.95">Maximum (larger files)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="maxWidth">Max Width (px)</label>
                            <input type="number" id="maxWidth" value="1920" min="800" max="4096">
                        </div>
                    </div>
                    <div class="settings-section">
                        <h4><i class="fas fa-database"></i> Data Management</h4>
                        <div class="form-group">
                            <label>Storage Used</label>
                            <div class="connection-status">
                                <span id="storageUsed">Calculating...</span>
                            </div>
                        </div>
                        <button class="btn btn-secondary" id="importDataBtn" style="width: 100%; margin-bottom: 0.5rem;">
                            <i class="fas fa-upload"></i> Import Data
                        </button>
                        <input type="file" id="importInput" accept=".json" hidden>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary" id="saveSettingsBtn">
                        <i class="fas fa-save"></i> Save Settings
                    </button>
                </div>
            </div>
        </div>

        <!-- Confirm Dialog Modal -->
        <div class="modal" id="dialogModal">
            <div class="modal-content dialog-content">
                <div class="modal-body">
                    <div class="dialog-icon" id="dialogIcon">
                        <i class="fas fa-question"></i>
                    </div>
                    <h3 class="dialog-title" id="dialogTitle">Confirm Action</h3>
                    <p class="dialog-message" id="dialogMessage">Are you sure you want to proceed?</p>
                    <div class="dialog-buttons">
                        <button class="btn btn-secondary" id="dialogCancelBtn">Cancel</button>
                        <button class="btn btn-primary" id="dialogConfirmBtn">Confirm</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Alert Dialog Modal -->
        <div class="modal" id="alertModal">
            <div class="modal-content dialog-content">
                <div class="modal-body">
                    <div class="dialog-icon" id="alertIcon">
                        <i class="fas fa-info"></i>
                    </div>
                    <h3 class="dialog-title" id="alertTitle">Information</h3>
                    <p class="dialog-message" id="alertMessage">Message goes here.</p>
                    <div class="dialog-buttons">
                        <button class="btn btn-primary" id="alertOkBtn">OK</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Loading Overlay -->
        <div class="loading-overlay" id="loadingOverlay">
            <div class="loading-spinner">
                <div class="spinner"></div>
                <p id="loadingText">Processing...</p>
            </div>
        </div>

        <!-- Toast Notifications -->
        <div class="toast-container" id="toastContainer"></div>
    </div>

    <script>
        // ==================== Configuration ====================
        const CONFIG = {
            MAX_PHOTOS: 15,
            STORAGE_KEY: 'apartmentPhotoManager',
            DEFAULT_QUALITY: 0.7,
            DEFAULT_MAX_WIDTH: 1920
        };

        // ==================== Dialog Manager ====================
        class DialogManager {
            constructor() {
                this.dialogModal = document.getElementById('dialogModal');
                this.dialogIcon = document.getElementById('dialogIcon');
                this.dialogTitle = document.getElementById('dialogTitle');
                this.dialogMessage = document.getElementById('dialogMessage');
                this.dialogCancelBtn = document.getElementById('dialogCancelBtn');
                this.dialogConfirmBtn = document.getElementById('dialogConfirmBtn');

                this.alertModal = document.getElementById('alertModal');
                this.alertIcon = document.getElementById('alertIcon');
                this.alertTitle = document.getElementById('alertTitle');
                this.alertMessage = document.getElementById('alertMessage');
                this.alertOkBtn = document.getElementById('alertOkBtn');

                this.resolveCallback = null;
                this.initEventListeners();
            }

            initEventListeners() {
                this.dialogCancelBtn.addEventListener('click', () => this.closeConfirm(false));
                this.dialogConfirmBtn.addEventListener('click', () => this.closeConfirm(true));
                this.dialogModal.addEventListener('click', (e) => {
                    if (e.target === this.dialogModal) this.closeConfirm(false);
                });

                this.alertOkBtn.addEventListener('click', () => this.closeAlert());
                this.alertModal.addEventListener('click', (e) => {
                    if (e.target === this.alertModal) this.closeAlert();
                });
            }

            confirm(options) {
                return new Promise((resolve) => {
                    this.resolveCallback = resolve;

                    const { title, message, type = 'warning', confirmText = 'Confirm', cancelText = 'Cancel' } = options;

                    this.dialogTitle.textContent = title;
                    this.dialogMessage.textContent = message;
                    this.dialogConfirmBtn.textContent = confirmText;
                    this.dialogCancelBtn.textContent = cancelText;

                    // Set icon and colors based on type
                    const iconMap = {
                        warning: { icon: 'exclamation-triangle', btnClass: 'btn-warning' },
                        danger: { icon: 'trash-alt', btnClass: 'btn-danger' },
                        success: { icon: 'check-circle', btnClass: 'btn-success' },
                        info: { icon: 'info-circle', btnClass: 'btn-primary' }
                    };

                    const config = iconMap[type] || iconMap.info;
                    this.dialogIcon.className = `dialog-icon ${type}`;
                    this.dialogIcon.innerHTML = `<i class="fas fa-${config.icon}"></i>`;
                    
                    this.dialogConfirmBtn.className = `btn ${config.btnClass || 'btn-primary'}`;
                    if (type === 'danger') {
                        this.dialogConfirmBtn.className = 'btn btn-danger';
                    }

                    this.dialogModal.classList.add('active');
                });
            }

            closeConfirm(result) {
                this.dialogModal.classList.remove('active');
                if (this.resolveCallback) {
                    this.resolveCallback(result);
                    this.resolveCallback = null;
                }
            }

            alert(options) {
                return new Promise((resolve) => {
                    const { title, message, type = 'info' } = options;

                    this.alertTitle.textContent = title;
                    this.alertMessage.textContent = message;

                    const iconMap = {
                        warning: 'exclamation-triangle',
                        danger: 'times-circle',
                        success: 'check-circle',
                        info: 'info-circle',
                        error: 'times-circle'
                    };

                    this.alertIcon.className = `dialog-icon ${type}`;
                    this.alertIcon.innerHTML = `<i class="fas fa-${iconMap[type] || iconMap.info}"></i>`;

                    this.alertModal.classList.add('active');
                    
                    this.alertResolve = resolve;
                });
            }

            closeAlert() {
                this.alertModal.classList.remove('active');
                if (this.alertResolve) {
                    this.alertResolve();
                    this.alertResolve = null;
                }
            }
        }

        // ==================== State Management ====================
        class StateManager {
            constructor() {
                this.state = this.loadState();
            }

            loadState() {
                try {
                    const saved = localStorage.getItem(CONFIG.STORAGE_KEY);
                    if (saved) {
                        return JSON.parse(saved);
                    }
                } catch (e) {
                    console.error('Error loading state:', e);
                }
                return this.getDefaultState();
            }

            getDefaultState() {
                return {
                    apartment: {
                        name: '',
                        address: '',
                        inspectionDate: new Date().toISOString().split('T')[0],
                        notes: ''
                    },
                    photos: [],
                    settings: {
                        imageQuality: CONFIG.DEFAULT_QUALITY,
                        maxWidth: CONFIG.DEFAULT_MAX_WIDTH
                    }
                };
            }

            saveState() {
                try {
                    localStorage.setItem(CONFIG.STORAGE_KEY, JSON.stringify(this.state));
                } catch (e) {
                    console.error('Error saving state:', e);
                    throw new Error('Storage quota exceeded. Please delete some photos.');
                }
            }

            updateApartment(data) {
                this.state.apartment = { ...this.state.apartment, ...data };
                this.saveState();
            }

            addPhoto(photo) {
                if (this.state.photos.length < CONFIG.MAX_PHOTOS) {
                    this.state.photos.push(photo);
                    this.saveState();
                    return true;
                }
                return false;
            }

            updatePhoto(id, data) {
                const index = this.state.photos.findIndex(p => p.id === id);
                if (index !== -1) {
                    this.state.photos[index] = { ...this.state.photos[index], ...data };
                    this.saveState();
                }
            }

            deletePhoto(id) {
                this.state.photos = this.state.photos.filter(p => p.id !== id);
                this.saveState();
            }

            clearAllPhotos() {
                this.state.photos = [];
                this.state.apartment = this.getDefaultState().apartment;
                this.saveState();
            }

            updateSettings(settings) {
                this.state.settings = { ...this.state.settings, ...settings };
                this.saveState();
            }

            getPhotoCount() {
                return this.state.photos.length;
            }

            getStorageSize() {
                const data = localStorage.getItem(CONFIG.STORAGE_KEY) || '';
                const bytes = new Blob([data]).size;
                if (bytes < 1024) return `${bytes} B`;
                if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(2)} KB`;
                return `${(bytes / (1024 * 1024)).toFixed(2)} MB`;
            }

            exportData() {
                return JSON.stringify(this.state, null, 2);
            }

            importData(data) {
                try {
                    const parsed = JSON.parse(data);
                    if (parsed.apartment && parsed.photos) {
                        this.state = parsed;
                        this.saveState();
                        return true;
                    }
                    return false;
                } catch (e) {
                    return false;
                }
            }
        }

        // ==================== Image Processor ====================
        class ImageProcessor {
            static async processImage(file, maxWidth, quality) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const img = new Image();
                        img.onload = () => {
                            const canvas = document.createElement('canvas');
                            let width = img.width;
                            let height = img.height;

                            if (width > maxWidth) {
                                height = (height * maxWidth) / width;
                                width = maxWidth;
                            }

                            canvas.width = width;
                            canvas.height = height;

                            const ctx = canvas.getContext('2d');
                            ctx.drawImage(img, 0, 0, width, height);

                            const dataUrl = canvas.toDataURL('image/jpeg', quality);
                            resolve({
                                dataUrl,
                                width,
                                height,
                                size: Math.round((dataUrl.length * 3) / 4 / 1024)
                            });
                        };
                        img.onerror = reject;
                        img.src = e.target.result;
                    };
                    reader.onerror = reject;
                    reader.readAsDataURL(file);
                });
            }

            static generateKebabFileName(label = 'photo') {
                const now = new Date();
                const date = now.toISOString().split('T')[0];
                const time = now.toTimeString().split(' ')[0].replace(/:/g, '-');
                const cleanLabel = label.toLowerCase()
                    .replace(/[^a-z0-9\s]/g, '')
                    .replace(/\s+/g, '-')
                    .substring(0, 30);
                return `${date}-${time}-${cleanLabel}.jpg`;
            }
        }

        // ==================== UI Manager ====================
        class UIManager {
            constructor(stateManager, dialogManager) {
                this.state = stateManager;
                this.dialog = dialogManager;
                this.currentPhotoId = null;
                this.initElements();
                this.initEventListeners();
                this.render();
            }

            initElements() {
                // Form elements
                this.apartmentName = document.getElementById('apartmentName');
                this.apartmentAddress = document.getElementById('apartmentAddress');
                this.inspectionDate = document.getElementById('inspectionDate');
                this.notes = document.getElementById('notes');

                // Photo elements
                this.photoGrid = document.getElementById('photoGrid');
                this.photoInput = document.getElementById('photoInput');
                this.addPhotoBtn = document.getElementById('addPhotoBtn');
                this.addPhotoContainer = document.getElementById('addPhotoContainer');
                this.photoCount = document.getElementById('photoCount');
                this.progressFill = document.getElementById('progressFill');

                // Action buttons
                this.saveAllBtn = document.getElementById('saveAllBtn');
                this.clearAllBtn = document.getElementById('clearAllBtn');
                this.exportBtn = document.getElementById('exportBtn');
                this.settingsBtn = document.getElementById('settingsBtn');

                // Photo modal
                this.photoModal = document.getElementById('photoModal');
                this.modalImage = document.getElementById('modalImage');
                this.modalTitle = document.getElementById('modalTitle');
                this.photoLabel = document.getElementById('photoLabel');
                this.photoDate = document.getElementById('photoDate');
                this.photoSize = document.getElementById('photoSize');
                this.closeModal = document.getElementById('closeModal');
                this.deletePhotoBtn = document.getElementById('deletePhotoBtn');
                this.savePhotoBtn = document.getElementById('savePhotoBtn');

                // Settings modal
                this.settingsModal = document.getElementById('settingsModal');
                this.closeSettings = document.getElementById('closeSettings');
                this.imageQuality = document.getElementById('imageQuality');
                this.maxWidth = document.getElementById('maxWidth');
                this.saveSettingsBtn = document.getElementById('saveSettingsBtn');
                this.storageUsed = document.getElementById('storageUsed');
                this.importDataBtn = document.getElementById('importDataBtn');
                this.importInput = document.getElementById('importInput');

                // Loading & Toast
                this.loadingOverlay = document.getElementById('loadingOverlay');
                this.loadingText = document.getElementById('loadingText');
                this.toastContainer = document.getElementById('toastContainer');
            }

            initEventListeners() {
                // Form auto-save
                const formInputs = [this.apartmentName, this.apartmentAddress, this.inspectionDate, this.notes];
                formInputs.forEach(input => {
                    input.addEventListener('change', () => this.saveApartmentInfo());
                    input.addEventListener('blur', () => this.saveApartmentInfo());
                });

                // Photo input
                this.addPhotoBtn.addEventListener('click', () => this.photoInput.click());
                this.photoInput.addEventListener('change', (e) => this.handlePhotoInput(e));

                // Action buttons
                this.saveAllBtn.addEventListener('click', () => this.saveAllPhotos());
                this.clearAllBtn.addEventListener('click', () => this.confirmClearAll());
                this.exportBtn.addEventListener('click', () => this.exportData());
                this.settingsBtn.addEventListener('click', () => this.openSettings());

                // Photo modal
                this.closeModal.addEventListener('click', () => this.closePhotoModal());
                this.deletePhotoBtn.addEventListener('click', () => this.deleteCurrentPhoto());
                this.savePhotoBtn.addEventListener('click', () => this.savePhotoChanges());
                this.photoModal.addEventListener('click', (e) => {
                    if (e.target === this.photoModal) this.closePhotoModal();
                });

                // Settings modal
                this.closeSettings.addEventListener('click', () => this.closeSettingsModal());
                this.saveSettingsBtn.addEventListener('click', () => this.saveSettings());
                this.settingsModal.addEventListener('click', (e) => {
                    if (e.target === this.settingsModal) this.closeSettingsModal();
                });
                this.importDataBtn.addEventListener('click', () => this.importInput.click());
                this.importInput.addEventListener('change', (e) => this.handleImport(e));

                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        this.closePhotoModal();
                        this.closeSettingsModal();
                    }
                });

                // Handle orientation change
                window.addEventListener('orientationchange', () => {
                    setTimeout(() => this.render(), 100);
                });
            }

            saveApartmentInfo() {
                this.state.updateApartment({
                    name: this.apartmentName.value,
                    address: this.apartmentAddress.value,
                    inspectionDate: this.inspectionDate.value,
                    notes: this.notes.value
                });
            }

            async handlePhotoInput(e) {
                const files = Array.from(e.target.files);
                if (!files.length) return;

                const remainingSlots = CONFIG.MAX_PHOTOS - this.state.getPhotoCount();
                if (remainingSlots <= 0) {
                    await this.dialog.alert({
                        title: 'Maximum Reached',
                        message: 'You have reached the maximum of 15 photos. Please delete some photos to add more.',
                        type: 'warning'
                    });
                    return;
                }

                const filesToProcess = files.slice(0, remainingSlots);
                this.showLoading(`Processing ${filesToProcess.length} photo(s)...`);

                try {
                    for (let i = 0; i < filesToProcess.length; i++) {
                        const file = filesToProcess[i];
                        this.updateLoadingText(`Processing photo ${i + 1} of ${filesToProcess.length}...`);
                        
                        const processed = await ImageProcessor.processImage(
                            file,
                            this.state.state.settings.maxWidth,
                            this.state.state.settings.imageQuality
                        );

                        const photo = {
                            id: Date.now() + Math.random().toString(36).substr(2, 9),
                            dataUrl: processed.dataUrl,
                            label: `Photo ${this.state.getPhotoCount() + 1}`,
                            date: new Date().toISOString(),
                            size: processed.size,
                            width: processed.width,
                            height: processed.height,
                            status: 'pending'
                        };

                        this.state.addPhoto(photo);
                    }

                    this.render();
                    this.showToast(`${filesToProcess.length} photo(s) added`, 'success');

                    if (files.length > remainingSlots) {
                        await this.dialog.alert({
                            title: 'Some Photos Skipped',
                            message: `${files.length - remainingSlots} photo(s) were skipped because the limit of 15 was reached.`,
                            type: 'warning'
                        });
                    }
                } catch (error) {
                    console.error('Error processing photos:', error);
                    await this.dialog.alert({
                        title: 'Error',
                        message: 'There was an error processing the photos. Please try again.',
                        type: 'error'
                    });
                } finally {
                    this.hideLoading();
                    this.photoInput.value = '';
                }
            }

            render() {
                this.renderApartmentInfo();
                this.renderPhotoGrid();
                this.updatePhotoCounter();
                this.updateAddPhotoButton();
                this.renderSettings();
            }

            renderApartmentInfo() {
                const { apartment } = this.state.state;
                this.apartmentName.value = apartment.name;
                this.apartmentAddress.value = apartment.address;
                this.inspectionDate.value = apartment.inspectionDate;
                this.notes.value = apartment.notes;
            }

            renderPhotoGrid() {
                const { photos } = this.state.state;
                
                if (photos.length === 0) {
                    this.photoGrid.innerHTML = `
                        <div class="empty-state" style="grid-column: 1 / -1;">
                            <i class="fas fa-camera"></i>
                            <h3>No Photos Yet</h3>
                            <p>Tap the button below to add your first photo</p>
                        </div>
                    `;
                    return;
                }
                
                this.photoGrid.innerHTML = photos.map(photo => `
                    <div class="photo-card" data-id="${photo.id}">
                        <img src="${photo.dataUrl}" alt="${photo.label}" loading="lazy">
                        <div class="photo-card-overlay">
                            <div class="photo-card-label">${photo.label}</div>
                        </div>
                        <div class="photo-card-status ${photo.status}" title="${photo.status}">
                            <i class="fas fa-${this.getStatusIcon(photo.status)}"></i>
                        </div>
                    </div>
                `).join('');

                // Add click listeners
                this.photoGrid.querySelectorAll('.photo-card').forEach(card => {
                    card.addEventListener('click', () => {
                        const id = card.dataset.id;
                        this.openPhotoModal(id);
                    });
                });
            }

            getStatusIcon(status) {
                switch (status) {
                    case 'saved': return 'check';
                    case 'error': return 'exclamation';
                    default: return 'clock';
                }
            }

            updatePhotoCounter() {
                const count = this.state.getPhotoCount();
                this.photoCount.textContent = count;
                this.progressFill.style.width = `${(count / CONFIG.MAX_PHOTOS) * 100}%`;
            }

            updateAddPhotoButton() {
                const count = this.state.getPhotoCount();
                const isDisabled = count >= CONFIG.MAX_PHOTOS;
                this.addPhotoBtn.disabled = isDisabled;
                
                if (isDisabled) {
                    this.addPhotoContainer.style.display = 'none';
                } else {
                    this.addPhotoContainer.style.display = 'block';
                }
            }

            openPhotoModal(id) {
                const photo = this.state.state.photos.find(p => p.id === id);
                if (!photo) return;

                this.currentPhotoId = id;
                this.modalImage.src = photo.dataUrl;
                this.modalTitle.textContent = photo.label;
                this.photoLabel.value = photo.label;
                this.photoDate.textContent = new Date(photo.date).toLocaleString();
                this.photoSize.textContent = `${photo.size} KB`;

                this.photoModal.classList.add('active');
            }

            closePhotoModal() {
                this.photoModal.classList.remove('active');
                this.currentPhotoId = null;
            }

            savePhotoChanges() {
                if (!this.currentPhotoId) return;

                this.state.updatePhoto(this.currentPhotoId, {
                    label: this.photoLabel.value
                });

                this.render();
                this.closePhotoModal();
                this.showToast('Photo updated', 'success');
            }

            async deleteCurrentPhoto() {
                if (!this.currentPhotoId) return;

                const confirmed = await this.dialog.confirm({
                    title: 'Delete Photo',
                    message: 'Are you sure you want to delete this photo? This action cannot be undone.',
                    type: 'danger',
                    confirmText: 'Delete',
                    cancelText: 'Cancel'
                });

                if (confirmed) {
                    this.state.deletePhoto(this.currentPhotoId);
                    this.render();
                    this.closePhotoModal();
                    this.showToast('Photo deleted', 'success');
                }
            }

            async confirmClearAll() {
                if (this.state.getPhotoCount() === 0) {
                    await this.dialog.alert({
                        title: 'No Photos',
                        message: 'There are no photos to clear.',
                        type: 'info'
                    });
                    return;
                }

                const confirmed = await this.dialog.confirm({
                    title: 'Clear All Data',
                    message: 'Are you sure you want to delete all photos and apartment information? This action cannot be undone.',
                    type: 'danger',
                    confirmText: 'Clear All',
                    cancelText: 'Cancel'
                });

                if (confirmed) {
                    this.state.clearAllPhotos();
                    this.render();
                    this.showToast('All data cleared', 'success');
                }
            }

            openSettings() {
                this.renderSettings();
                this.settingsModal.classList.add('active');
            }

            closeSettingsModal() {
                this.settingsModal.classList.remove('active');
            }

            renderSettings() {
                const { settings } = this.state.state;
                
                this.imageQuality.value = settings.imageQuality;
                this.maxWidth.value = settings.maxWidth;
                this.storageUsed.textContent = this.state.getStorageSize();
            }

            saveSettings() {
                this.state.updateSettings({
                    imageQuality: parseFloat(this.imageQuality.value),
                    maxWidth: parseInt(this.maxWidth.value)
                });

                this.closeSettingsModal();
                this.showToast('Settings saved', 'success');
            }

            async saveAllPhotos() {
                const photos = this.state.state.photos;
                
                if (photos.length === 0) {
                    await this.dialog.alert({
                        title: 'No Photos',
                        message: 'There are no photos to save.',
                        type: 'info'
                    });
                    return;
                }

                this.showLoading('Preparing download...');

                try {
                    const { apartment } = this.state.state;
                    const zip = await this.createZipFile(photos, apartment);
                    
                    // Create download link
                    const fileName = ImageProcessor.generateKebabFileName(apartment.name || 'apartment-photos').replace('.jpg', '.zip');
                    
                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(zip);
                    link.download = fileName;
                    link.click();
                    URL.revokeObjectURL(link.href);

                    // Mark all as saved
                    photos.forEach(photo => {
                        this.state.updatePhoto(photo.id, { status: 'saved' });
                    });

                    this.render();
                    this.showToast('Photos saved successfully', 'success');
                } catch (error) {
                    console.error('Save error:', error);
                    await this.dialog.alert({
                        title: 'Save Error',
                        message: 'There was an error saving the photos. Please try again.',
                        type: 'error'
                    });
                } finally {
                    this.hideLoading();
                }
            }

            async createZipFile(photos, apartment) {
                // Simple approach: create a JSON manifest and individual image downloads
                // For a real ZIP file, you'd use a library like JSZip
                
                const manifest = {
                    apartment: apartment,
                    photos: photos.map(p => ({
                        id: p.id,
                        label: p.label,
                        date: p.date,
                        fileName: ImageProcessor.generateKebabFileName(p.label)
                    })),
                    exportDate: new Date().toISOString()
                };

                // Create a blob with all data
                const exportData = {
                    manifest,
                    images: photos.map(p => ({
                        fileName: ImageProcessor.generateKebabFileName(p.label),
                        data: p.dataUrl
                    }))
                };

                return new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            }

            exportData() {
                const data = this.state.exportData();
                const blob = new Blob([data], { type: 'application/json' });
                const fileName = `apartment-data-${new Date().toISOString().split('T')[0]}.json`;
                
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = fileName;
                link.click();
                URL.revokeObjectURL(link.href);

                this.showToast('Data exported', 'success');
            }

            async handleImport(e) {
                const file = e.target.files[0];
                if (!file) return;

                const confirmed = await this.dialog.confirm({
                    title: 'Import Data',
                    message: 'This will replace all current data. Are you sure you want to continue?',
                    type: 'warning',
                    confirmText: 'Import',
                    cancelText: 'Cancel'
                });

                if (!confirmed) {
                    this.importInput.value = '';
                    return;
                }

                try {
                    const text = await file.text();
                    const success = this.state.importData(text);

                    if (success) {
                        this.render();
                        this.closeSettingsModal();
                        this.showToast('Data imported successfully', 'success');
                    } else {
                        await this.dialog.alert({
                            title: 'Import Error',
                            message: 'The file format is invalid. Please select a valid export file.',
                            type: 'error'
                        });
                    }
                } catch (error) {
                    await this.dialog.alert({
                        title: 'Import Error',
                        message: 'There was an error reading the file. Please try again.',
                        type: 'error'
                    });
                }

                this.importInput.value = '';
            }

            showLoading(text = 'Processing...') {
                this.loadingText.textContent = text;
                this.loadingOverlay.classList.add('active');
            }

            updateLoadingText(text) {
                this.loadingText.textContent = text;
            }

            hideLoading() {
                this.loadingOverlay.classList.remove('active');
            }

            showToast(message, type = 'info') {
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                
                const icon = {
                    success: 'check-circle',
                    error: 'exclamation-circle',
                    warning: 'exclamation-triangle',
                    info: 'info-circle'
                }[type];

                toast.innerHTML = `
                    <i class="fas fa-${icon}"></i>
                    <span>${message}</span>
                `;

                this.toastContainer.appendChild(toast);

                setTimeout(() => {
                    toast.style.animation = 'slideIn 0.3s ease reverse';
                    setTimeout(() => toast.remove(), 300);
                }, 3000);
            }
        }

        // ==================== App Initialization ====================
        class App {
            constructor() {
                this.stateManager = new StateManager();
                this.dialogManager = new DialogManager();
                this.uiManager = null;
            }

            init() {
                if (document.readyState === 'loading') {
                    document.addEventListener('DOMContentLoaded', () => this.start());
                } else {
                    this.start();
                }
            }

            start() {
                this.uiManager = new UIManager(this.stateManager, this.dialogManager);
                console.log('Apartment Photo Manager initialized');
            }
        }

        // Start the app
        const app = new App();
        app.init();
    </script>
</body>
</html>
