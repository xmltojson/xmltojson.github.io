<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Typing Speed Test</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #5E60CE;
            --primary-dark: #4EA8DE;
            --secondary: #48BFE3;
            --accent: #64DFDF;
            --success: #56CFE1;
            --warning: #72EFDD;
            --danger: #FF6B6B;
            --dark: #1A1A2E;
            --light: #E8F4F8;
            --bg-gradient: linear-gradient(135deg, #5E60CE 0%, #48BFE3 50%, #64DFDF 100%);
            --card-bg: rgba(255, 255, 255, 0.95);
            --text-dark: #1A1A2E;
            --text-light: #5A6C7D;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: var(--bg-gradient);
            min-height: 100vh;
            color: var(--text-dark);
            overflow-x: hidden;
        }

        /* Animated Background */
        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }

        .bg-animation span {
            position: absolute;
            display: block;
            width: 20px;
            height: 20px;
            background: rgba(255, 255, 255, 0.15);
            animation: float 25s linear infinite;
            bottom: -150px;
            border-radius: 50%;
        }

        .bg-animation span:nth-child(1) { left: 25%; width: 80px; height: 80px; animation-delay: 0s; }
        .bg-animation span:nth-child(2) { left: 10%; width: 20px; height: 20px; animation-delay: 2s; animation-duration: 12s; }
        .bg-animation span:nth-child(3) { left: 70%; width: 20px; height: 20px; animation-delay: 4s; }
        .bg-animation span:nth-child(4) { left: 40%; width: 60px; height: 60px; animation-delay: 0s; animation-duration: 18s; }
        .bg-animation span:nth-child(5) { left: 65%; width: 20px; height: 20px; animation-delay: 0s; }
        .bg-animation span:nth-child(6) { left: 75%; width: 110px; height: 110px; animation-delay: 3s; }
        .bg-animation span:nth-child(7) { left: 35%; width: 150px; height: 150px; animation-delay: 7s; }
        .bg-animation span:nth-child(8) { left: 50%; width: 25px; height: 25px; animation-delay: 15s; animation-duration: 45s; }
        .bg-animation span:nth-child(9) { left: 20%; width: 15px; height: 15px; animation-delay: 2s; animation-duration: 35s; }
        .bg-animation span:nth-child(10) { left: 85%; width: 150px; height: 150px; animation-delay: 0s; animation-duration: 11s; }

        @keyframes float {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; border-radius: 50%; }
            100% { transform: translateY(-1000px) rotate(720deg); opacity: 0; border-radius: 50%; }
        }

        /* Header */
        .header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            color: white;
            font-size: 1.5rem;
            font-weight: 700;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: white;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .help-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 10px 20px;
            border-radius: 25px;
            color: white;
            font-family: inherit;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .help-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .user-stats {
            display: flex;
            align-items: center;
            gap: 15px;
            color: white;
        }

        .stat-badge {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 16px;
            border-radius: 25px;
            font-weight: 500;
            transition: transform 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .stat-badge:hover {
            transform: scale(1.05);
        }

        .streak-fire {
            animation: pulse 1s ease infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        /* Main Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px;
        }

        /* Navigation Tabs */
        .nav-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .nav-tab {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.2);
            padding: 12px 24px;
            border-radius: 30px;
            color: white;
            font-family: inherit;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-tab:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            border-color: rgba(255, 255, 255, 0.4);
        }

        .nav-tab.active {
            background: white;
            color: var(--primary);
            border-color: white;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        }

        .nav-tab .shortcut {
            font-size: 0.7rem;
            background: rgba(255, 255, 255, 0.3);
            padding: 2px 6px;
            border-radius: 4px;
            margin-left: 5px;
        }

        .nav-tab.active .shortcut {
            background: rgba(94, 96, 206, 0.15);
        }

        /* Cards */
        .card {
            background: var(--card-bg);
            border-radius: 24px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            animation: slideUp 0.5s ease;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Language Selector */
        .language-selector {
            display: flex;
            gap: 12px;
            margin-bottom: 25px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .lang-btn {
            padding: 12px 24px;
            border: 2px solid var(--light);
            background: white;
            border-radius: 14px;
            cursor: pointer;
            font-family: inherit;
            font-weight: 500;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-dark);
        }

        .lang-btn:hover {
            border-color: var(--secondary);
            background: linear-gradient(135deg, rgba(72, 191, 227, 0.1) 0%, rgba(100, 223, 223, 0.1) 100%);
            transform: translateY(-2px);
        }

        .lang-btn.active {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            border-color: transparent;
            box-shadow: 0 8px 25px rgba(94, 96, 206, 0.3);
        }

        .lang-btn .shortcut {
            font-size: 0.7rem;
            background: rgba(0, 0, 0, 0.08);
            padding: 2px 6px;
            border-radius: 4px;
        }

        .lang-btn.active .shortcut {
            background: rgba(255, 255, 255, 0.25);
        }

        /* Typing Area */
        .typing-container {
            position: relative;
        }

        .text-display {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.3rem;
            line-height: 2;
            padding: 25px;
            background: linear-gradient(135deg, #f8fafc 0%, #e8f4f8 100%);
            border-radius: 16px;
            margin-bottom: 20px;
            min-height: 150px;
            position: relative;
            overflow: hidden;
            border: 2px solid rgba(94, 96, 206, 0.1);
        }

        .text-display .char {
            transition: all 0.1s ease;
            position: relative;
        }

        .text-display .char.correct {
            color: var(--primary);
        }

        .text-display .char.incorrect {
            color: var(--danger);
            background: rgba(255, 107, 107, 0.2);
            border-radius: 3px;
        }

        .text-display .char.current {
            background: linear-gradient(135deg, var(--accent) 0%, var(--warning) 100%);
            border-radius: 3px;
            animation: blink 1s ease infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .text-display .char.pending {
            color: var(--text-light);
        }

        .typing-input {
            width: 100%;
            padding: 20px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.2rem;
            border: 2px solid var(--light);
            border-radius: 16px;
            outline: none;
            transition: all 0.3s ease;
            background: white;
        }

        .typing-input:focus {
            border-color: var(--secondary);
            box-shadow: 0 0 0 4px rgba(72, 191, 227, 0.15);
        }

        .typing-input:disabled {
            background: var(--light);
            cursor: not-allowed;
        }

        /* Stats Display */
        .stats-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--primary) 0%, #7B68EE 100%);
            color: white;
            padding: 20px;
            border-radius: 16px;
            text-align: center;
            transition: transform 0.3s ease;
            box-shadow: 0 8px 25px rgba(94, 96, 206, 0.25);
        }

        .stat-card:nth-child(2) {
            background: linear-gradient(135deg, var(--secondary) 0%, var(--accent) 100%);
            box-shadow: 0 8px 25px rgba(72, 191, 227, 0.25);
        }

        .stat-card:nth-child(3) {
            background: linear-gradient(135deg, #56CFE1 0%, #72EFDD 100%);
            box-shadow: 0 8px 25px rgba(86, 207, 225, 0.25);
        }

        .stat-card:nth-child(4) {
            background: linear-gradient(135deg, var(--accent) 0%, #80FFDB 100%);
            box-shadow: 0 8px 25px rgba(100, 223, 223, 0.25);
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            display: block;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-top: 5px;
        }

        /* Timer */
        .timer-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .timer-btn {
            padding: 12px 24px;
            border: 2px solid var(--light);
            background: white;
            border-radius: 12px;
            cursor: pointer;
            font-family: inherit;
            font-weight: 600;
            transition: all 0.3s ease;
            color: var(--text-dark);
        }

        .timer-btn:hover {
            border-color: var(--secondary);
            background: linear-gradient(135deg, rgba(72, 191, 227, 0.1) 0%, rgba(100, 223, 223, 0.1) 100%);
        }

        .timer-btn.active {
            background: linear-gradient(135deg, var(--secondary) 0%, var(--accent) 100%);
            color: white;
            border-color: transparent;
            box-shadow: 0 6px 20px rgba(72, 191, 227, 0.3);
        }

        .timer-display {
            font-size: 3rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            min-width: 100px;
            text-align: center;
        }

        /* Control Buttons */
        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 25px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 14px;
            font-family: inherit;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            box-shadow: 0 8px 25px rgba(94, 96, 206, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(94, 96, 206, 0.4);
        }

        .btn-secondary {
            background: var(--light);
            color: var(--text-dark);
            border: 2px solid transparent;
        }

        .btn-secondary:hover {
            background: white;
            border-color: var(--secondary);
            transform: translateY(-3px);
        }

        .btn .shortcut {
            font-size: 0.7rem;
            background: rgba(255, 255, 255, 0.25);
            padding: 2px 6px;
            border-radius: 4px;
        }

        .btn-secondary .shortcut {
            background: rgba(0, 0, 0, 0.08);
        }

        /* Results Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(26, 26, 46, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(8px);
        }

        .modal-overlay.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal {
            background: white;
            border-radius: 28px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            animation: scaleIn 0.3s ease;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.2);
        }

        @keyframes scaleIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .modal h2 {
            font-size: 2rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .modal-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 30px 0;
        }

        .modal-stat {
            padding: 20px;
            background: linear-gradient(135deg, #f8fafc 0%, var(--light) 100%);
            border-radius: 16px;
        }

        .modal-stat-value {
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .modal-stat-label {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .stars-earned {
            font-size: 3rem;
            margin: 20px 0;
            animation: bounce 0.5s ease;
        }

        @keyframes bounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        .points-earned {
            font-size: 1.5rem;
            background: linear-gradient(135deg, var(--accent) 0%, var(--warning) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 600;
            margin-bottom: 20px;
        }

        /* Help Modal */
        .help-modal {
            max-width: 600px;
            text-align: left;
        }

        .help-modal h2 {
            text-align: center;
            margin-bottom: 20px;
        }

        .help-section {
            margin-bottom: 25px;
        }

        .help-section h3 {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .help-section p, .help-section li {
            color: var(--text-light);
            line-height: 1.8;
        }

        .help-section ul {
            list-style: none;
            padding-left: 0;
        }

        .help-section li {
            padding: 10px 0;
            border-bottom: 1px solid var(--light);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .help-section li:last-child {
            border-bottom: none;
        }

        .key-combo {
            background: linear-gradient(135deg, var(--light) 0%, #dbeafe 100%);
            padding: 6px 14px;
            border-radius: 8px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--primary);
        }

        .help-tip {
            background: linear-gradient(135deg, rgba(94, 96, 206, 0.1) 0%, rgba(72, 191, 227, 0.1) 100%);
            padding: 18px;
            border-radius: 14px;
            border-left: 4px solid var(--primary);
        }

        .help-tip p {
            margin: 0;
        }

        /* Calendar Section */
        .calendar-container {
            display: none;
        }

        .calendar-container.active {
            display: block;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .calendar-header h3 {
            font-size: 1.5rem;
            color: var(--text-dark);
        }

        .calendar-nav {
            display: flex;
            gap: 10px;
        }

        .calendar-nav button {
            width: 40px;
            height: 40px;
            border: 2px solid var(--light);
            background: white;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s ease;
            color: var(--text-dark);
        }

        .calendar-nav button:hover {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            border-color: transparent;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
        }

        .calendar-day-header {
            padding: 10px;
            text-align: center;
            font-weight: 600;
            color: var(--text-light);
            font-size: 0.85rem;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            font-size: 0.9rem;
            border: 2px solid transparent;
        }

        .calendar-day:hover {
            background: var(--light);
        }

        .calendar-day.other-month {
            color: #ccc;
        }

        .calendar-day.today {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
        }

        .calendar-day.has-activity {
            background: linear-gradient(135deg, rgba(72, 191, 227, 0.15) 0%, rgba(100, 223, 223, 0.15) 100%);
            border-color: var(--secondary);
        }

        .calendar-day.has-activity::after {
            content: '‚≠ê';
            position: absolute;
            bottom: 2px;
            font-size: 0.6rem;
        }

        .calendar-day.streak {
            background: linear-gradient(135deg, var(--accent) 0%, var(--warning) 100%);
            color: var(--text-dark);
            border-color: transparent;
        }

        /* Statistics Section */
        .stats-container {
            display: none;
        }

        .stats-container.active {
            display: block;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stats-card-large {
            background: linear-gradient(135deg, var(--primary) 0%, #7B68EE 100%);
            color: white;
            padding: 25px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(94, 96, 206, 0.25);
        }

        .stats-card-large .value {
            font-size: 3rem;
            font-weight: 700;
        }

        .stats-card-large .label {
            opacity: 0.9;
        }

        .history-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: linear-gradient(135deg, #f8fafc 0%, var(--light) 100%);
            border-radius: 14px;
            margin-bottom: 10px;
            transition: transform 0.3s ease;
            border: 2px solid transparent;
        }

        .history-item:hover {
            transform: translateX(5px);
            border-color: var(--secondary);
        }

        .history-date {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .history-stats {
            display: flex;
            gap: 20px;
        }

        .history-stat {
            text-align: center;
        }

        .history-stat-value {
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .history-stat-label {
            font-size: 0.75rem;
            color: var(--text-light);
        }

        /* Progress Bar */
        .progress-container {
            margin-top: 20px;
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .progress-bar {
            height: 12px;
            background: var(--light);
            border-radius: 6px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 50%, var(--accent) 100%);
            border-radius: 6px;
            transition: width 0.5s ease;
        }

        /* Achievements */
        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .achievement {
            padding: 20px 15px;
            background: var(--light);
            border-radius: 16px;
            text-align: center;
            transition: all 0.3s ease;
            opacity: 0.5;
            border: 2px solid transparent;
        }

        .achievement.unlocked {
            opacity: 1;
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border-color: #fbbf24;
            box-shadow: 0 8px 25px rgba(251, 191, 36, 0.25);
        }

        .achievement-icon {
            font-size: 2rem;
            margin-bottom: 8px;
        }

        .achievement-name {
            font-size: 0.8rem;
            font-weight: 600;
        }

        /* Daily Bonus */
        .daily-bonus {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 50%, var(--accent) 100%);
            color: white;
            padding: 20px;
            border-radius: 16px;
            text-align: center;
            margin-bottom: 25px;
            animation: glow 2s ease infinite;
            box-shadow: 0 10px 30px rgba(94, 96, 206, 0.3);
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 10px 30px rgba(94, 96, 206, 0.3); }
            50% { box-shadow: 0 15px 45px rgba(94, 96, 206, 0.5); }
        }

        .daily-bonus h3 {
            margin-bottom: 10px;
        }

        .daily-bonus .streak-count {
            font-size: 2rem;
            font-weight: 700;
        }

        /* Keyboard Shortcuts Info */
        .shortcuts-hint {
            text-align: center;
            color: var(--text-light);
            font-size: 0.85rem;
            margin-top: 20px;
            padding: 12px;
            background: linear-gradient(135deg, rgba(94, 96, 206, 0.08) 0%, rgba(72, 191, 227, 0.08) 100%);
            border-radius: 12px;
        }

        .shortcuts-hint kbd {
            background: white;
            padding: 4px 10px;
            border-radius: 6px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            margin: 0 3px;
            color: var(--primary);
            font-weight: 600;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 15px;
            }

            .header-actions {
                flex-direction: column;
                width: 100%;
            }

            .user-stats {
                flex-wrap: wrap;
                justify-content: center;
            }

            .container {
                padding: 15px;
            }

            .card {
                padding: 20px;
            }

            .text-display {
                font-size: 1rem;
                padding: 15px;
            }

            .stat-value {
                font-size: 1.8rem;
            }

            .timer-display {
                font-size: 2rem;
            }

            .modal {
                padding: 25px;
            }

            .modal-stats {
                grid-template-columns: 1fr;
            }

            .nav-tab .shortcut,
            .lang-btn .shortcut,
            .btn .shortcut {
                display: none;
            }
        }

        /* Confetti Animation */
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            top: -10px;
            animation: confetti-fall 3s ease-out forwards;
            z-index: 1001;
        }

        @keyframes confetti-fall {
            to {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        /* Section visibility */
        .section {
            display: none;
        }

        .section.active {
            display: block;
        }
    </style>
</head>
<body>
    <!-- Animated Background -->
    <div class="bg-animation">
        <span></span><span></span><span></span><span></span><span></span>
        <span></span><span></span><span></span><span></span><span></span>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="logo">
            <div class="logo-icon">‚å®Ô∏è</div>
            <span>Typing Speed Test</span>
        </div>
        <div class="header-actions">
            <button class="help-btn" id="helpBtn">
                ‚ùì How to Play <span class="shortcut">F1</span>
            </button>
            <div class="user-stats">
                <div class="stat-badge">
                    <span class="streak-fire">üî•</span>
                    <span id="streakCount">0</span> day streak
                </div>
                <div class="stat-badge">
                    ‚≠ê <span id="totalStars">0</span> stars
                </div>
                <div class="stat-badge">
                    üèÜ <span id="totalPoints">0</span> points
                </div>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div class="container">
        <!-- Navigation -->
        <nav class="nav-tabs">
            <button class="nav-tab active" data-tab="test">
                ‚å®Ô∏è Typing Test <span class="shortcut">1</span>
            </button>
            <button class="nav-tab" data-tab="calendar">
                üìÖ Calendar <span class="shortcut">2</span>
            </button>
            <button class="nav-tab" data-tab="stats">
                üìä Statistics <span class="shortcut">3</span>
            </button>
            <button class="nav-tab" data-tab="achievements">
                üèÜ Achievements <span class="shortcut">4</span>
            </button>
        </nav>

        <!-- Typing Test Section -->
        <section id="test-section" class="section active">
            <div class="card">
                <!-- Daily Bonus -->
                <div class="daily-bonus" id="dailyBonus" style="display: none;">
                    <h3>üéâ Daily Bonus!</h3>
                    <p>You've visited <span class="streak-count" id="visitStreak">0</span> days in a row!</p>
                    <p>+<span id="bonusPoints">0</span> bonus points earned!</p>
                </div>

                <!-- Language Selector -->
                <div class="language-selector">
                    <button class="lang-btn active" data-lang="en">
                        English <span class="shortcut">Alt+1</span>
                    </button>
                    <button class="lang-btn" data-lang="uk">
                        –£–∫—Ä–∞—ó–Ω—Å—å–∫–∞ <span class="shortcut">Alt+2</span>
                    </button>
                    <button class="lang-btn" data-lang="ru">
                        –†—É—Å—Å–∫–∏–π <span class="shortcut">Alt+3</span>
                    </button>
                    <button class="lang-btn" data-lang="de">
                        Deutsch <span class="shortcut">Alt+4</span>
                    </button>
                </div>

                <!-- Timer Selection -->
                <div class="timer-container">
                    <button class="timer-btn" data-time="30">30s</button>
                    <button class="timer-btn active" data-time="60">60s</button>
                    <button class="timer-btn" data-time="120">120s</button>
                    <div class="timer-display" id="timerDisplay">60</div>
                </div>

                <!-- Typing Area -->
                <div class="typing-container">
                    <div class="text-display" id="textDisplay">
                        Press <strong>Enter</strong> or click "Start Test" to begin...
                    </div>
                    <input 
                        type="text" 
                        class="typing-input" 
                        id="typingInput" 
                        placeholder="Start typing here..."
                        disabled
                        autocomplete="off"
                        autocorrect="off"
                        autocapitalize="off"
                        spellcheck="false"
                    >
                </div>

                <!-- Live Stats -->
                <div class="stats-row">
                    <div class="stat-card">
                        <span class="stat-value" id="liveCPM">0</span>
                        <span class="stat-label">CPM</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-value" id="liveWPM">0</span>
                        <span class="stat-label">WPM</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-value" id="liveAccuracy">100%</span>
                        <span class="stat-label">Accuracy</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-value" id="liveErrors">0</span>
                        <span class="stat-label">Errors</span>
                    </div>
                </div>

                <!-- Controls -->
                <div class="controls">
                    <button class="btn btn-primary" id="startBtn">
                        ‚ñ∂Ô∏è Start Test <span class="shortcut">Enter</span>
                    </button>
                    <button class="btn btn-secondary" id="resetBtn">
                        üîÑ Reset <span class="shortcut">Esc</span>
                    </button>
                </div>

                <!-- Shortcuts Hint -->
                <div class="shortcuts-hint">
                    üí° Quick tips: Press <kbd>Enter</kbd> to start, <kbd>Esc</kbd> to reset, <kbd>Tab</kbd> to restart after test, <kbd>F1</kbd> for help
                </div>
            </div>
        </section>

        <!-- Calendar Section -->
        <section id="calendar-section" class="section">
            <div class="card">
                <div class="calendar-header">
                    <h3 id="calendarTitle">January 2024</h3>
                    <div class="calendar-nav">
                        <button id="prevMonth">‚óÄ</button>
                        <button id="nextMonth">‚ñ∂</button>
                    </div>
                </div>
                <div class="calendar-grid" id="calendarGrid">
                    <!-- Calendar will be generated here -->
                </div>

                <div class="progress-container" style="margin-top: 30px;">
                    <h4>Monthly Progress</h4>
                    <div class="progress-label">
                        <span>Days practiced this month</span>
                        <span id="monthlyProgress">0/30</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="monthlyProgressBar" style="width: 0%"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Statistics Section -->
        <section id="stats-section" class="section">
            <div class="card">
                <h3 style="margin-bottom: 20px;">üìä Your Statistics</h3>
                
                <div class="stats-grid">
                    <div class="stats-card-large">
                        <div class="value" id="avgCPM">0</div>
                        <div class="label">Average CPM</div>
                    </div>
                    <div class="stats-card-large" style="background: linear-gradient(135deg, var(--secondary) 0%, var(--accent) 100%);">
                        <div class="value" id="avgAccuracy">0%</div>
                        <div class="label">Average Accuracy</div>
                    </div>
                    <div class="stats-card-large" style="background: linear-gradient(135deg, #56CFE1 0%, #72EFDD 100%);">
                        <div class="value" id="bestCPM">0</div>
                        <div class="label">Best CPM</div>
                    </div>
                    <div class="stats-card-large" style="background: linear-gradient(135deg, var(--accent) 0%, #80FFDB 100%);">
                        <div class="value" id="totalTests">0</div>
                        <div class="label">Total Tests</div>
                    </div>
                </div>

                <h4 style="margin: 30px 0 15px;">Recent History</h4>
                <div class="history-list" id="historyList">
                    <!-- History items will be generated here -->
                </div>
            </div>
        </section>

        <!-- Achievements Section -->
        <section id="achievements-section" class="section">
            <div class="card">
                <h3 style="margin-bottom: 20px;">üèÜ Achievements</h3>
                <div class="achievements-grid" id="achievementsGrid">
                    <!-- Achievements will be generated here -->
                </div>
            </div>
        </section>
    </div>

    <!-- Results Modal -->
    <div class="modal-overlay" id="resultsModal">
        <div class="modal">
            <h2>üéâ Test Complete!</h2>
            <p>Great job! Here are your results:</p>
            
            <div class="modal-stats">
                <div class="modal-stat">
                    <div class="modal-stat-value" id="finalCPM">0</div>
                    <div class="modal-stat-label">Characters/Min</div>
                </div>
                <div class="modal-stat">
                    <div class="modal-stat-value" id="finalWPM">0</div>
                    <div class="modal-stat-label">Words/Min</div>
                </div>
                <div class="modal-stat">
                    <div class="modal-stat-value" id="finalAccuracy">0%</div>
                    <div class="modal-stat-label">Accuracy</div>
                </div>
                <div class="modal-stat">
                    <div class="modal-stat-value" id="finalErrors">0</div>
                    <div class="modal-stat-label">Errors</div>
                </div>
            </div>

            <div class="stars-earned" id="starsEarned">‚≠ê‚≠ê‚≠ê</div>
            <div class="points-earned" id="pointsEarned">+100 points!</div>

            <div class="controls">
                <button class="btn btn-primary" id="tryAgainBtn">
                    üîÑ Try Again <span class="shortcut">Tab</span>
                </button>
                <button class="btn btn-secondary" id="closeModalBtn">
                    ‚úñÔ∏è Close <span class="shortcut">Esc</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Help Modal -->
    <div class="modal-overlay" id="helpModal">
        <div class="modal help-modal">
            <h2>‚ùì How to Play</h2>
            
            <div class="help-section">
                <h3>üéØ Goal</h3>
                <p>Type the displayed text as quickly and accurately as possible. Your speed is measured in CPM (Characters Per Minute) and WPM (Words Per Minute).</p>
            </div>

            <div class="help-section">
                <h3>üìù Instructions</h3>
                <ul style="list-style: decimal; padding-left: 20px;">
                    <li style="display: list-item;">Select your preferred language</li>
                    <li style="display: list-item;">Choose a time duration (30s, 60s, or 120s)</li>
                    <li style="display: list-item;">Press Enter or click "Start Test"</li>
                    <li style="display: list-item;">Type the text shown in the display area</li>
                    <li style="display: list-item;">Try to type accurately - errors reduce your score!</li>
                </ul>
            </div>

            <div class="help-section">
                <h3>‚å®Ô∏è Keyboard Shortcuts</h3>
                <ul>
                    <li>Start Test <span class="key-combo">Enter</span></li>
                    <li>Reset / Close Modal <span class="key-combo">Esc</span></li>
                    <li>Try Again (after test) <span class="key-combo">Tab</span></li>
                    <li>Open Help <span class="key-combo">F1</span></li>
                    <li>Typing Test Tab <span class="key-combo">1</span></li>
                    <li>Calendar Tab <span class="key-combo">2</span></li>
                    <li>Statistics Tab <span class="key-combo">3</span></li>
                    <li>Achievements Tab <span class="key-combo">4</span></li>
                    <li>English <span class="key-combo">Alt + 1</span></li>
                    <li>Ukrainian <span class="key-combo">Alt + 2</span></li>
                    <li>Russian <span class="key-combo">Alt + 3</span></li>
                    <li>German <span class="key-combo">Alt + 4</span></li>
                </ul>
            </div>

            <div class="help-section">
                <h3>‚≠ê Scoring System</h3>
                <ul>
                    <li>‚≠ê‚≠ê‚≠ê Three Stars <span class="key-combo">95%+ accuracy & 200+ CPM</span></li>
                    <li>‚≠ê‚≠ê Two Stars <span class="key-combo">85%+ accuracy & 150+ CPM</span></li>
                    <li>‚≠ê One Star <span class="key-combo">Complete the test</span></li>
                </ul>
            </div>

            <div class="help-section">
                <h3>üî• Streaks & Bonuses</h3>
                <p>Visit daily to build your streak! Each consecutive day earns you bonus points:</p>
                <ul>
                    <li>Daily visit bonus <span class="key-combo">Streak √ó 10 points</span></li>
                    <li>Daily star <span class="key-combo">+1 ‚≠ê</span></li>
                </ul>
            </div>

            <div class="help-section">
                <div class="help-tip">
                    <p>üí° <strong>Pro Tip:</strong> Focus on accuracy first, then speed. It's better to type slowly and correctly than fast with many errors!</p>
                </div>
            </div>

            <div class="controls" style="margin-top: 25px;">
                <button class="btn btn-primary" id="closeHelpBtn">
                    Got it! <span class="shortcut">Esc</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        // Text passages for different languages
        const textPassages = {
            en: [
                "The morning sun cast golden rays across the peaceful valley, awakening the sleeping village below. Birds began their cheerful songs as farmers prepared for another day of honest work in the fields.",
                "Learning a new skill requires patience and dedication. Whether it is playing an instrument, speaking a foreign language, or mastering a sport, consistent practice leads to remarkable improvement over time.",
                "The ancient library held countless secrets within its weathered walls. Scholars from distant lands traveled for months just to glimpse the rare manuscripts that contained knowledge from civilizations long forgotten.",
                "Modern technology has revolutionized how we connect with one another. Video calls bridge continents, instant messages cross oceans, and social networks unite people who might never have met otherwise.",
                "The chef carefully selected each ingredient for the evening meal. Fresh vegetables from the local market, aromatic herbs from the garden, and the finest spices combined to create a culinary masterpiece.",
                "Adventure awaits those brave enough to step outside their comfort zone. Every journey begins with a single step, and every great story starts with someone willing to take a chance on the unknown.",
                "The starry night sky has inspired poets and dreamers throughout human history. Countless generations have gazed upward, wondering about distant worlds and the mysteries that lie beyond our reach.",
                "Education opens doors that would otherwise remain closed forever. Knowledge empowers individuals to make informed decisions, pursue their passions, and contribute meaningfully to society."
            ],
            uk: [
                "–†–∞–Ω–∫–æ–≤–µ —Å–æ–Ω—Ü–µ –∫–∏–¥–∞–ª–æ –∑–æ–ª–æ—Ç—ñ –ø—Ä–æ–º–µ–Ω—ñ –Ω–∞ –º–∏—Ä–Ω—É –¥–æ–ª–∏–Ω—É, –ø—Ä–æ–±—É–¥–∂—É—é—á–∏ —Å–æ–Ω–Ω–µ —Å–µ–ª–æ –≤–Ω–∏–∑—É. –ü—Ç–∞—Ö–∏ –ø–æ—á–∏–Ω–∞–ª–∏ —Å–≤–æ—ó –≤–µ—Å–µ–ª—ñ –ø—ñ—Å–Ω—ñ, –ø–æ–∫–∏ —Ñ–µ—Ä–º–µ—Ä–∏ –≥–æ—Ç—É–≤–∞–ª–∏—Å—è –¥–æ —á–µ—Ä–≥–æ–≤–æ–≥–æ –¥–Ω—è —á–µ—Å–Ω–æ—ó –ø—Ä–∞—Ü—ñ –Ω–∞ –ø–æ–ª—è—Ö.",
                "–í–∏–≤—á–µ–Ω–Ω—è –Ω–æ–≤–æ—ó –Ω–∞–≤–∏—á–∫–∏ –≤–∏–º–∞–≥–∞—î —Ç–µ—Ä–ø—ñ–Ω–Ω—è —Ç–∞ –≤—ñ–¥–¥–∞–Ω–æ—Å—Ç—ñ. –ß–∏ —Ç–æ –≥—Ä–∞ –Ω–∞ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ, –≤–æ–ª–æ–¥—ñ–Ω–Ω—è —ñ–Ω–æ–∑–µ–º–Ω–æ—é –º–æ–≤–æ—é, —á–∏ –æ–ø–∞–Ω—É–≤–∞–Ω–Ω—è —Å–ø–æ—Ä—Ç—É, –ø–æ—Å—Ç—ñ–π–Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–∞ –≤–µ–¥–µ –¥–æ –ø–æ–º—ñ—Ç–Ω–æ–≥–æ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è –∑ —á–∞—Å–æ–º.",
                "–°—Ç–∞—Ä–æ–¥–∞–≤–Ω—è –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ –∑–±–µ—Ä—ñ–≥–∞–ª–∞ –Ω–µ–∑–ª—ñ—á–µ–Ω–Ω—ñ —Ç–∞—î–º–Ω–∏—Ü—ñ —É —Å–≤–æ—ó—Ö –æ–±–≤—ñ—Ç—Ä–µ–Ω–∏—Ö —Å—Ç—ñ–Ω–∞—Ö. –í—á–µ–Ω—ñ –∑ –¥–∞–ª–µ–∫–∏—Ö –∫—Ä–∞—ó–Ω –ø–æ–¥–æ—Ä–æ–∂—É–≤–∞–ª–∏ –º—ñ—Å—è—Ü—è–º–∏, —â–æ–± –ª–∏—à–µ –ø–æ–≥–ª—è–Ω—É—Ç–∏ –Ω–∞ —Ä—ñ–¥–∫—ñ—Å–Ω—ñ —Ä—É–∫–æ–ø–∏—Å–∏, —â–æ –º—ñ—Å—Ç–∏–ª–∏ –∑–Ω–∞–Ω–Ω—è –¥–∞–≤–Ω–æ –∑–∞–±—É—Ç–∏—Ö —Ü–∏–≤—ñ–ª—ñ–∑–∞—Ü—ñ–π.",
                "–°—É—á–∞—Å–Ω—ñ —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó —Ä–µ–≤–æ–ª—é—Ü—ñ–æ–Ω—ñ–∑—É–≤–∞–ª–∏ —Å–ø–æ—Å—ñ–± –Ω–∞—à–æ–≥–æ —Å–ø—ñ–ª–∫—É–≤–∞–Ω–Ω—è. –í—ñ–¥–µ–æ–¥–∑–≤—ñ–Ω–∫–∏ –∑'—î–¥–Ω—É—é—Ç—å –∫–æ–Ω—Ç–∏–Ω–µ–Ω—Ç–∏, –º–∏—Ç—Ç—î–≤—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø–µ—Ä–µ—Ç–∏–Ω–∞—é—Ç—å –æ–∫–µ–∞–Ω–∏, –∞ —Å–æ—Ü—ñ–∞–ª—å–Ω—ñ –º–µ—Ä–µ–∂—ñ –æ–±'—î–¥–Ω—É—é—Ç—å –ª—é–¥–µ–π, —è–∫—ñ —ñ–Ω–∞–∫—à–µ –Ω—ñ–∫–æ–ª–∏ –± –Ω–µ –∑—É—Å—Ç—Ä—ñ–ª–∏—Å—è.",
                "–®–µ—Ñ-–∫—É—Ö–∞—Ä —Ä–µ—Ç–µ–ª—å–Ω–æ –≤—ñ–¥–±–∏—Ä–∞–≤ –∫–æ–∂–µ–Ω —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç –¥–ª—è –≤–µ—á—ñ—Ä–Ω—å–æ—ó —Å—Ç—Ä–∞–≤–∏. –°–≤—ñ–∂—ñ –æ–≤–æ—á—ñ –∑ –º—ñ—Å—Ü–µ–≤–æ–≥–æ —Ä–∏–Ω–∫—É, –∞—Ä–æ–º–∞—Ç–Ω—ñ —Ç—Ä–∞–≤–∏ –∑ —Å–∞–¥—É —Ç–∞ –Ω–∞–π–∫—Ä–∞—â—ñ —Å–ø–µ—Ü—ñ—ó –ø–æ—î–¥–Ω—É–≤–∞–ª–∏—Å—è –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫—É–ª—ñ–Ω–∞—Ä–Ω–æ–≥–æ —à–µ–¥–µ–≤—Ä—É.",
                "–ü—Ä–∏–≥–æ–¥–∏ —á–µ–∫–∞—é—Ç—å –Ω–∞ —Ç–∏—Ö, —Ö—Ç–æ –¥–æ—Å—Ç–∞—Ç–Ω—å–æ —Å–º—ñ–ª–∏–≤–∏–π, —â–æ–± –≤–∏–π—Ç–∏ –∑–∞ –º–µ–∂—ñ –∑–æ–Ω–∏ –∫–æ–º—Ñ–æ—Ä—Ç—É. –ö–æ–∂–Ω–∞ –ø–æ–¥–æ—Ä–æ–∂ –ø–æ—á–∏–Ω–∞—î—Ç—å—Å—è –∑ –æ–¥–Ω–æ–≥–æ –∫—Ä–æ–∫—É, —ñ –∫–æ–∂–Ω–∞ –≤–µ–ª–∏–∫–∞ —ñ—Å—Ç–æ—Ä—ñ—è –ø–æ—á–∏–Ω–∞—î—Ç—å—Å—è –∑ —Ç–æ–≥–æ, —Ö—Ç–æ –≥–æ—Ç–æ–≤–∏–π —Ä–∏–∑–∏–∫–Ω—É—Ç–∏.",
                "–ó–æ—Ä—è–Ω–µ –Ω—ñ—á–Ω–µ –Ω–µ–±–æ –Ω–∞–¥–∏—Ö–∞–ª–æ –ø–æ–µ—Ç—ñ–≤ —ñ –º—Ä—ñ–π–Ω–∏–∫—ñ–≤ –ø—Ä–æ—Ç—è–≥–æ–º —É—Å—ñ—î—ó —ñ—Å—Ç–æ—Ä—ñ—ó –ª—é–¥—Å—Ç–≤–∞. –ù–µ–∑–ª—ñ—á–µ–Ω–Ω—ñ –ø–æ–∫–æ–ª—ñ–Ω–Ω—è –¥–∏–≤–∏–ª–∏—Å—è –≤–≥–æ—Ä—É, —Ä–æ–∑–º—ñ—Ä–∫–æ–≤—É—é—á–∏ –ø—Ä–æ –¥–∞–ª–µ–∫—ñ —Å–≤—ñ—Ç–∏ —Ç–∞ —Ç–∞—î–º–Ω–∏—Ü—ñ, —â–æ –ª–µ–∂–∞—Ç—å –ø–æ–∑–∞ –Ω–∞—à–æ—é –¥–æ—Å—è–∂–Ω—ñ—Å—Ç—é.",
                "–û—Å–≤—ñ—Ç–∞ –≤—ñ–¥–∫—Ä–∏–≤–∞—î –¥–≤–µ—Ä—ñ, —è–∫—ñ —ñ–Ω–∞–∫—à–µ –∑–∞–ª–∏—à–∏–ª–∏—Å—è –± –∑–∞–∫—Ä–∏—Ç–∏–º–∏ –Ω–∞–∑–∞–≤–∂–¥–∏. –ó–Ω–∞–Ω–Ω—è –¥–∞—é—Ç—å –ª—é–¥—è–º –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –ø—Ä–∏–π–º–∞—Ç–∏ –æ–±“ë—Ä—É–Ω—Ç–æ–≤–∞–Ω—ñ —Ä—ñ—à–µ–Ω–Ω—è, —Å–ª—ñ–¥—É–≤–∞—Ç–∏ —Å–≤–æ—ó–º –∑–∞—Ö–æ–ø–ª–µ–Ω–Ω—è–º —Ç–∞ —Ä–æ–±–∏—Ç–∏ –∑–Ω–∞—á—É—â–∏–π –≤–Ω–µ—Å–æ–∫ —É —Å—É—Å–ø—ñ–ª—å—Å—Ç–≤–æ."
            ],
            ru: [
                "–£—Ç—Ä–µ–Ω–Ω–µ–µ —Å–æ–ª–Ω—Ü–µ –±—Ä–æ—Å–∞–ª–æ –∑–æ–ª–æ—Ç—ã–µ –ª—É—á–∏ –Ω–∞ –º–∏—Ä–Ω—É—é –¥–æ–ª–∏–Ω—É, –ø—Ä–æ–±—É–∂–¥–∞—è —Å–ø—è—â—É—é –¥–µ—Ä–µ–≤–Ω—é –≤–Ω–∏–∑—É. –ü—Ç–∏—Ü—ã –Ω–∞—á–∏–Ω–∞–ª–∏ —Å–≤–æ–∏ –≤–µ—Å—ë–ª—ã–µ –ø–µ—Å–Ω–∏, –ø–æ–∫–∞ —Ñ–µ—Ä–º–µ—Ä—ã –≥–æ—Ç–æ–≤–∏–ª–∏—Å—å –∫ –æ—á–µ—Ä–µ–¥–Ω–æ–º—É –¥–Ω—é —á–µ—Å—Ç–Ω–æ–≥–æ —Ç—Ä—É–¥–∞ –Ω–∞ –ø–æ–ª—è—Ö.",
                "–ò–∑—É—á–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –Ω–∞–≤—ã–∫–∞ —Ç—Ä–µ–±—É–µ—Ç —Ç–µ—Ä–ø–µ–Ω–∏—è –∏ –ø—Ä–µ–¥–∞–Ω–Ω–æ—Å—Ç–∏ –¥–µ–ª—É. –ë—É–¥—å —Ç–æ –∏–≥—Ä–∞ –Ω–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–µ, –≤–ª–∞–¥–µ–Ω–∏–µ –∏–Ω–æ—Å—Ç—Ä–∞–Ω–Ω—ã–º —è–∑—ã–∫–æ–º –∏–ª–∏ –æ—Å–≤–æ–µ–Ω–∏–µ —Å–ø–æ—Ä—Ç–∞, –ø–æ—Å—Ç–æ—è–Ω–Ω–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞ –≤–µ–¥—ë—Ç –∫ –∑–∞–º–µ—Ç–Ω–æ–º—É —É–ª—É—á—à–µ–Ω–∏—é —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º.",
                "–î—Ä–µ–≤–Ω—è—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ —Ö—Ä–∞–Ω–∏–ª–∞ –±–µ—Å—á–∏—Å–ª–µ–Ω–Ω—ã–µ —Ç–∞–π–Ω—ã –≤ —Å–≤–æ–∏—Ö –æ–±–≤–µ—Ç—à–∞–ª—ã—Ö —Å—Ç–µ–Ω–∞—Ö. –£—á—ë–Ω—ã–µ –∏–∑ –¥–∞–ª—ë–∫–∏—Ö —Å—Ç—Ä–∞–Ω –ø—É—Ç–µ—à–µ—Å—Ç–≤–æ–≤–∞–ª–∏ –º–µ—Å—è—Ü–∞–º–∏, —á—Ç–æ–±—ã –ª–∏—à—å –≤–∑–≥–ª—è–Ω—É—Ç—å –Ω–∞ —Ä–µ–¥–∫–∏–µ —Ä—É–∫–æ–ø–∏—Å–∏, —Å–æ–¥–µ—Ä–∂–∞—â–∏–µ –∑–Ω–∞–Ω–∏—è –¥–∞–≤–Ω–æ –∑–∞–±—ã—Ç—ã—Ö —Ü–∏–≤–∏–ª–∏–∑–∞—Ü–∏–π.",
                "–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ —Ä–µ–≤–æ–ª—é—Ü–∏–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–ª–∏ —Å–ø–æ—Å–æ–± –Ω–∞—à–µ–≥–æ –æ–±—â–µ–Ω–∏—è –¥—Ä—É–≥ —Å –¥—Ä—É–≥–æ–º. –í–∏–¥–µ–æ–∑–≤–æ–Ω–∫–∏ —Å–æ–µ–¥–∏–Ω—è—é—Ç –∫–æ–Ω—Ç–∏–Ω–µ–Ω—Ç—ã, –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–µ—Ä–µ—Å–µ–∫–∞—é—Ç –æ–∫–µ–∞–Ω—ã, –∞ —Å–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏ –æ–±—ä–µ–¥–∏–Ω—è—é—Ç –ª—é–¥–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –∏–Ω–∞—á–µ –Ω–∏–∫–æ–≥–¥–∞ –±—ã –Ω–µ –≤—Å—Ç—Ä–µ—Ç–∏–ª–∏—Å—å.",
                "–®–µ—Ñ-–ø–æ–≤–∞—Ä —Ç—â–∞—Ç–µ–ª—å–Ω–æ –æ—Ç–±–∏—Ä–∞–ª –∫–∞–∂–¥—ã–π –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç –¥–ª—è –≤–µ—á–µ—Ä–Ω–µ–≥–æ –±–ª—é–¥–∞. –°–≤–µ–∂–∏–µ –æ–≤–æ—â–∏ —Å –º–µ—Å—Ç–Ω–æ–≥–æ —Ä—ã–Ω–∫–∞, –∞—Ä–æ–º–∞—Ç–Ω—ã–µ —Ç—Ä–∞–≤—ã –∏–∑ —Å–∞–¥–∞ –∏ –ª—É—á—à–∏–µ —Å–ø–µ—Ü–∏–∏ —Å–æ–µ–¥–∏–Ω—è–ª–∏—Å—å –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫—É–ª–∏–Ω–∞—Ä–Ω–æ–≥–æ —à–µ–¥–µ–≤—Ä–∞.",
                "–ü—Ä–∏–∫–ª—é—á–µ–Ω–∏—è –∂–¥—É—Ç —Ç–µ—Ö, –∫—Ç–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å–º–µ–ª, —á—Ç–æ–±—ã –≤—ã–π—Ç–∏ –∑–∞ –ø—Ä–µ–¥–µ–ª—ã –∑–æ–Ω—ã –∫–æ–º—Ñ–æ—Ä—Ç–∞. –ö–∞–∂–¥–æ–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –æ–¥–Ω–æ–≥–æ —à–∞–≥–∞, –∏ –∫–∞–∂–¥–∞—è –≤–µ–ª–∏–∫–∞—è –∏—Å—Ç–æ—Ä–∏—è –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å —Ç–æ–≥–æ, –∫—Ç–æ –≥–æ—Ç–æ–≤ —Ä–∏—Å–∫–Ω—É—Ç—å.",
                "–ó–≤—ë–∑–¥–Ω–æ–µ –Ω–æ—á–Ω–æ–µ –Ω–µ–±–æ –≤–¥–æ—Ö–Ω–æ–≤–ª—è–ª–æ –ø–æ—ç—Ç–æ–≤ –∏ –º–µ—á—Ç–∞—Ç–µ–ª–µ–π –Ω–∞ –ø—Ä–æ—Ç—è–∂–µ–Ω–∏–∏ –≤—Å–µ–π –∏—Å—Ç–æ—Ä–∏–∏ —á–µ–ª–æ–≤–µ—á–µ—Å—Ç–≤–∞. –ë–µ—Å—á–∏—Å–ª–µ–Ω–Ω—ã–µ –ø–æ–∫–æ–ª–µ–Ω–∏—è —Å–º–æ—Ç—Ä–µ–ª–∏ –≤–≤–µ—Ä—Ö, —Ä–∞–∑–º—ã—à–ª—è—è –æ –¥–∞–ª—ë–∫–∏—Ö –º–∏—Ä–∞—Ö –∏ —Ç–∞–π–Ω–∞—Ö, –ª–µ–∂–∞—â–∏—Ö –∑–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ –Ω–∞—à–µ–π –¥–æ—Å—è–≥–∞–µ–º–æ—Å—Ç–∏.",
                "–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –¥–≤–µ—Ä–∏, –∫–æ—Ç–æ—Ä—ã–µ –∏–Ω–∞—á–µ –æ—Å—Ç–∞–ª–∏—Å—å –±—ã –∑–∞–∫—Ä—ã—Ç—ã–º–∏ –Ω–∞–≤—Å–µ–≥–¥–∞. –ó–Ω–∞–Ω–∏—è –¥–∞—é—Ç –ª—é–¥—è–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–∏–Ω–∏–º–∞—Ç—å –æ–±–æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è, —Å–ª–µ–¥–æ–≤–∞—Ç—å —Å–≤–æ–∏–º —É–≤–ª–µ—á–µ–Ω–∏—è–º –∏ –≤–Ω–æ—Å–∏—Ç—å –∑–Ω–∞—á–∏–º—ã–π –≤–∫–ª–∞–¥ –≤ –æ–±—â–µ—Å—Ç–≤–æ."
            ],
            de: [
                "Die Morgensonne warf goldene Strahlen √ºber das friedliche Tal und weckte das schlafende Dorf unten. V√∂gel begannen ihre fr√∂hlichen Lieder, w√§hrend die Bauern sich auf einen weiteren Tag ehrlicher Arbeit auf den Feldern vorbereiteten.",
                "Das Erlernen einer neuen F√§higkeit erfordert Geduld und Hingabe. Ob es das Spielen eines Instruments, das Beherrschen einer Fremdsprache oder das Meistern eines Sports ist, konsequentes √úben f√ºhrt mit der Zeit zu bemerkenswerter Verbesserung.",
                "Die alte Bibliothek bewahrte unz√§hlige Geheimnisse in ihren verwitterten Mauern. Gelehrte aus fernen L√§ndern reisten monatelang, nur um einen Blick auf die seltenen Manuskripte zu werfen, die Wissen l√§ngst vergessener Zivilisationen enthielten.",
                "Moderne Technologie hat revolutioniert, wie wir miteinander in Verbindung treten. Videoanrufe √ºberbr√ºcken Kontinente, Sofortnachrichten √ºberqueren Ozeane, und soziale Netzwerke vereinen Menschen, die sich sonst nie getroffen h√§tten.",
                "Der Koch w√§hlte sorgf√§ltig jede Zutat f√ºr das Abendessen aus. Frisches Gem√ºse vom lokalen Markt, aromatische Kr√§uter aus dem Garten und die feinsten Gew√ºrze vereinten sich zu einem kulinarischen Meisterwerk.",
                "Abenteuer erwarten diejenigen, die mutig genug sind, ihre Komfortzone zu verlassen. Jede Reise beginnt mit einem einzigen Schritt, und jede gro√üe Geschichte beginnt mit jemandem, der bereit ist, ein Risiko einzugehen.",
                "Der sternenklare Nachthimmel hat Dichter und Tr√§umer durch die gesamte Menschheitsgeschichte inspiriert. Unz√§hlige Generationen haben nach oben geblickt und √ºber ferne Welten und die Geheimnisse nachgedacht, die jenseits unserer Reichweite liegen.",
                "Bildung √∂ffnet T√ºren, die sonst f√ºr immer verschlossen bleiben w√ºrden. Wissen bef√§higt Menschen, fundierte Entscheidungen zu treffen, ihren Leidenschaften zu folgen und einen bedeutungsvollen Beitrag zur Gesellschaft zu leisten."
            ]
        };

        // Achievements data
        const achievementsData = [
            { id: 'first_test', name: 'First Steps', icon: 'üéØ', description: 'Complete your first test', condition: (stats) => stats.totalTests >= 1 },
            { id: 'speed_demon', name: 'Speed Demon', icon: '‚ö°', description: 'Reach 300 CPM', condition: (stats) => stats.bestCPM >= 300 },
            { id: 'perfectionist', name: 'Perfectionist', icon: 'üíØ', description: '100% accuracy', condition: (stats) => stats.perfectTests >= 1 },
            { id: 'consistent', name: 'Consistent', icon: 'üìà', description: '10 tests completed', condition: (stats) => stats.totalTests >= 10 },
            { id: 'dedicated', name: 'Dedicated', icon: 'üî•', description: '7 day streak', condition: (stats) => stats.maxStreak >= 7 },
            { id: 'polyglot', name: 'Polyglot', icon: 'üåç', description: 'Test in all languages', condition: (stats) => stats.languagesUsed >= 4 },
            { id: 'marathon', name: 'Marathon', icon: 'üèÉ', description: '50 tests completed', condition: (stats) => stats.totalTests >= 50 },
            { id: 'lightning', name: 'Lightning', icon: '‚ö°', description: 'Reach 400 CPM', condition: (stats) => stats.bestCPM >= 400 },
            { id: 'week_warrior', name: 'Week Warrior', icon: 'üóìÔ∏è', description: 'Practice 7 days', condition: (stats) => stats.totalDays >= 7 },
            { id: 'master', name: 'Master', icon: 'üëë', description: '100 tests completed', condition: (stats) => stats.totalTests >= 100 },
            { id: 'streak_master', name: 'Streak Master', icon: 'üî•', description: '30 day streak', condition: (stats) => stats.maxStreak >= 30 },
            { id: 'accuracy_king', name: 'Accuracy King', icon: 'üéØ', description: '95%+ avg accuracy', condition: (stats) => stats.avgAccuracy >= 95 }
        ];

        // App State
        class TypingApp {
            constructor() {
                this.state = this.loadState();
                this.currentText = '';
                this.currentIndex = 0;
                this.errors = 0;
                this.correctChars = 0;
                this.isRunning = false;
                this.timer = null;
                this.timeLeft = 60;
                this.selectedTime = 60;
                this.selectedLang = 'en';
                this.startTime = null;
                this.currentMonth = new Date().getMonth();
                this.currentYear = new Date().getFullYear();
                this.testCompleted = false;

                this.init();
            }

            loadState() {
                const defaultState = {
                    totalPoints: 0,
                    totalStars: 0,
                    streak: 0,
                    maxStreak: 0,
                    lastVisit: null,
                    history: [],
                    dailyVisits: {},
                    achievements: [],
                    languagesUsed: new Set(),
                    perfectTests: 0,
                    totalTests: 0,
                    totalDays: 0,
                    bestCPM: 0,
                    avgCPM: 0,
                    avgAccuracy: 0
                };

                const saved = localStorage.getItem('typingAppState');
                if (saved) {
                    const parsed = JSON.parse(saved);
                    parsed.languagesUsed = new Set(parsed.languagesUsed || []);
                    return { ...defaultState, ...parsed };
                }
                return defaultState;
            }

            saveState() {
                const toSave = {
                    ...this.state,
                    languagesUsed: Array.from(this.state.languagesUsed)
                };
                localStorage.setItem('typingAppState', JSON.stringify(toSave));
            }

            init() {
                this.checkDailyVisit();
                this.bindEvents();
                this.bindKeyboardShortcuts();
                this.updateUI();
                this.generateCalendar();
                this.renderAchievements();
                this.renderHistory();
            }

            checkDailyVisit() {
                const today = new Date().toDateString();
                const lastVisit = this.state.lastVisit;

                if (lastVisit !== today) {
                    const yesterday = new Date();
                    yesterday.setDate(yesterday.getDate() - 1);
                    
                    if (lastVisit === yesterday.toDateString()) {
                        this.state.streak++;
                    } else if (lastVisit) {
                        this.state.streak = 1;
                    } else {
                        this.state.streak = 1;
                    }

                    if (this.state.streak > this.state.maxStreak) {
                        this.state.maxStreak = this.state.streak;
                    }

                    // Award bonus points for streak
                    const bonusPoints = this.state.streak * 10;
                    this.state.totalPoints += bonusPoints;
                    this.state.totalStars++;

                    // Mark today as visited
                    this.state.dailyVisits[today] = {
                        visited: true,
                        tests: 0,
                        bestCPM: 0
                    };

                    if (!this.state.dailyVisits[lastVisit]?.tests) {
                        this.state.totalDays++;
                    }

                    this.state.lastVisit = today;
                    this.saveState();

                    // Show daily bonus
                    this.showDailyBonus(bonusPoints);
                }
            }

            showDailyBonus(points) {
                const bonusDiv = document.getElementById('dailyBonus');
                document.getElementById('visitStreak').textContent = this.state.streak;
                document.getElementById('bonusPoints').textContent = points;
                bonusDiv.style.display = 'block';

                setTimeout(() => {
                    bonusDiv.style.display = 'none';
                }, 5000);
            }

            bindEvents() {
                // Navigation tabs
                document.querySelectorAll('.nav-tab').forEach(tab => {
                    tab.addEventListener('click', () => this.switchTab(tab.dataset.tab));
                });

                // Language buttons
                document.querySelectorAll('.lang-btn').forEach(btn => {
                    btn.addEventListener('click', () => this.selectLanguage(btn.dataset.lang));
                });

                // Timer buttons
                document.querySelectorAll('.timer-btn').forEach(btn => {
                    btn.addEventListener('click', () => this.selectTime(parseInt(btn.dataset.time)));
                });

                // Control buttons
                document.getElementById('startBtn').addEventListener('click', () => this.startTest());
                document.getElementById('resetBtn').addEventListener('click', () => this.resetTest());
                document.getElementById('tryAgainBtn').addEventListener('click', () => this.tryAgain());
                document.getElementById('closeModalBtn').addEventListener('click', () => this.closeModal());

                // Help buttons
                document.getElementById('helpBtn').addEventListener('click', () => this.openHelp());
                document.getElementById('closeHelpBtn').addEventListener('click', () => this.closeHelp());

                // Typing input
                document.getElementById('typingInput').addEventListener('input', (e) => this.handleInput(e));
                document.getElementById('typingInput').addEventListener('keydown', (e) => {
                    if (e.key === 'Tab') e.preventDefault();
                });

                // Calendar navigation
                document.getElementById('prevMonth').addEventListener('click', () => this.changeMonth(-1));
                document.getElementById('nextMonth').addEventListener('click', () => this.changeMonth(1));

                // Close modals on overlay click
                document.getElementById('resultsModal').addEventListener('click', (e) => {
                    if (e.target.id === 'resultsModal') this.closeModal();
                });
                document.getElementById('helpModal').addEventListener('click', (e) => {
                    if (e.target.id === 'helpModal') this.closeHelp();
                });
            }

            bindKeyboardShortcuts() {
                document.addEventListener('keydown', (e) => {
                    // Don't trigger shortcuts when typing in input
                    const isTyping = document.activeElement === document.getElementById('typingInput');
                    const resultsModalOpen = document.getElementById('resultsModal').classList.contains('active');
                    const helpModalOpen = document.getElementById('helpModal').classList.contains('active');

                    // F1 - Help (always available)
                    if (e.key === 'F1') {
                        e.preventDefault();
                        if (helpModalOpen) {
                            this.closeHelp();
                        } else {
                            this.openHelp();
                        }
                        return;
                    }

                    // Escape - Reset/Close
                    if (e.key === 'Escape') {
                        e.preventDefault();
                        if (helpModalOpen) {
                            this.closeHelp();
                        } else if (resultsModalOpen) {
                            this.closeModal();
                        } else {
                            this.resetTest();
                        }
                        return;
                    }

                    // Tab - Try again (only when results modal is open)
                    if (e.key === 'Tab' && resultsModalOpen) {
                        e.preventDefault();
                        this.tryAgain();
                        return;
                    }

                    // Don't process other shortcuts if typing or modal open
                    if (isTyping || helpModalOpen) return;

                    // Enter - Start test (when not running and on test tab)
                    if (e.key === 'Enter' && !this.isRunning && !resultsModalOpen) {
                        e.preventDefault();
                        const testSection = document.getElementById('test-section');
                        if (testSection.classList.contains('active')) {
                            this.startTest();
                        }
                        return;
                    }

                    // Number keys 1-4 for tabs (without Alt)
                    if (!e.altKey && ['1', '2', '3', '4'].includes(e.key) && !resultsModalOpen) {
                        e.preventDefault();
                        const tabs = ['test', 'calendar', 'stats', 'achievements'];
                        this.switchTab(tabs[parseInt(e.key) - 1]);
                        return;
                    }

                    // Alt + Number keys for language selection
                    if (e.altKey && ['1', '2', '3', '4'].includes(e.key)) {
                        e.preventDefault();
                        const langs = ['en', 'uk', 'ru', 'de'];
                        this.selectLanguage(langs[parseInt(e.key) - 1]);
                        return;
                    }
                });
            }

            openHelp() {
                document.getElementById('helpModal').classList.add('active');
            }

            closeHelp() {
                document.getElementById('helpModal').classList.remove('active');
            }

            switchTab(tab) {
                document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
                document.querySelector(`[data-tab="${tab}"]`).classList.add('active');

                document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
                document.getElementById(`${tab}-section`).classList.add('active');

                if (tab === 'calendar') this.generateCalendar();
                if (tab === 'stats') this.updateStats();
                if (tab === 'achievements') this.renderAchievements();
            }

            selectLanguage(lang) {
                this.selectedLang = lang;
                document.querySelectorAll('.lang-btn').forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.lang === lang);
                });
                if (!this.isRunning) {
                    this.resetTest();
                }
            }

            selectTime(time) {
                this.selectedTime = time;
                this.timeLeft = time;
                document.querySelectorAll('.timer-btn').forEach(btn => {
                    btn.classList.toggle('active', parseInt(btn.dataset.time) === time);
                });
                document.getElementById('timerDisplay').textContent = time;
            }

            startTest() {
                if (this.isRunning) return;

                this.isRunning = true;
                this.testCompleted = false;
                this.currentIndex = 0;
                this.errors = 0;
                this.correctChars = 0;
                this.timeLeft = this.selectedTime;
                this.startTime = Date.now();

                // Get random text
                const passages = textPassages[this.selectedLang];
                this.currentText = passages[Math.floor(Math.random() * passages.length)];

                // Display text
                this.renderText();

                // Enable input
                const input = document.getElementById('typingInput');
                input.disabled = false;
                input.value = '';
                input.focus();

                // Update button
                document.getElementById('startBtn').innerHTML = '‚è∏Ô∏è Running...';
                document.getElementById('startBtn').disabled = true;

                // Start timer
                this.timer = setInterval(() => this.updateTimer(), 1000);

                // Track language usage
                this.state.languagesUsed.add(this.selectedLang);
            }

            renderText() {
                const display = document.getElementById('textDisplay');
                display.innerHTML = this.currentText.split('').map((char, i) => {
                    let className = 'char ';
                    if (i < this.currentIndex) {
                        className += this.getCharClass(i);
                    } else if (i === this.currentIndex) {
                        className += 'current';
                    } else {
                        className += 'pending';
                    }
                    return `<span class="${className}">${char === ' ' ? '&nbsp;' : char}</span>`;
                }).join('');
            }

            getCharClass(index) {
                return 'pending';
            }

            handleInput(e) {
                if (!this.isRunning) return;

                const inputValue = e.target.value;
                const inputLength = inputValue.length;

                // Update current index
                this.currentIndex = inputLength;

                // Check characters
                let correct = 0;
                let errors = 0;

                const display = document.getElementById('textDisplay');
                const chars = display.querySelectorAll('.char');

                for (let i = 0; i < this.currentText.length; i++) {
                    chars[i].classList.remove('correct', 'incorrect', 'current', 'pending');
                    
                    if (i < inputLength) {
                        if (inputValue[i] === this.currentText[i]) {
                            chars[i].classList.add('correct');
                            correct++;
                        } else {
                            chars[i].classList.add('incorrect');
                            errors++;
                        }
                    } else if (i === inputLength) {
                        chars[i].classList.add('current');
                    } else {
                        chars[i].classList.add('pending');
                    }
                }

                this.correctChars = correct;
                this.errors = errors;

                // Update live stats
                this.updateLiveStats();

                // Check if completed
                if (inputLength >= this.currentText.length) {
                    this.endTest();
                }
            }

            updateLiveStats() {
                const elapsed = (Date.now() - this.startTime) / 1000 / 60; // minutes
                const cpm = elapsed > 0 ? Math.round(this.correctChars / elapsed) : 0;
                const wpm = Math.round(cpm / 5);
                const accuracy = this.currentIndex > 0 
                    ? Math.round((this.correctChars / this.currentIndex) * 100) 
                    : 100;

                document.getElementById('liveCPM').textContent = cpm;
                document.getElementById('liveWPM').textContent = wpm;
                document.getElementById('liveAccuracy').textContent = accuracy + '%';
                document.getElementById('liveErrors').textContent = this.errors;
            }

            updateTimer() {
                this.timeLeft--;
                document.getElementById('timerDisplay').textContent = this.timeLeft;

                if (this.timeLeft <= 0) {
                    this.endTest();
                }
            }

            endTest() {
                this.isRunning = false;
                this.testCompleted = true;
                clearInterval(this.timer);

                const input = document.getElementById('typingInput');
                input.disabled = true;

                document.getElementById('startBtn').innerHTML = '‚ñ∂Ô∏è Start Test <span class="shortcut">Enter</span>';
                document.getElementById('startBtn').disabled = false;

                // Calculate final stats
                const elapsed = (Date.now() - this.startTime) / 1000 / 60;
                const cpm = elapsed > 0 ? Math.round(this.correctChars / elapsed) : 0;
                const wpm = Math.round(cpm / 5);
                const accuracy = this.currentIndex > 0 
                    ? Math.round((this.correctChars / this.currentIndex) * 100) 
                    : 100;

                // Calculate stars and points
                let stars = 1;
                if (accuracy >= 95 && cpm >= 200) stars = 3;
                else if (accuracy >= 85 && cpm >= 150) stars = 2;

                const points = Math.round((cpm * accuracy / 100) + (stars * 50));

                // Update state
                this.state.totalPoints += points;
                this.state.totalStars += stars;
                this.state.totalTests++;

                if (cpm > this.state.bestCPM) {
                    this.state.bestCPM = cpm;
                }

                if (accuracy === 100) {
                    this.state.perfectTests++;
                }

                // Update daily stats
                const today = new Date().toDateString();
                if (this.state.dailyVisits[today]) {
                    this.state.dailyVisits[today].tests++;
                    if (cpm > this.state.dailyVisits[today].bestCPM) {
                        this.state.dailyVisits[today].bestCPM = cpm;
                    }
                }

                // Add to history
                this.state.history.unshift({
                    date: new Date().toISOString(),
                    cpm,
                    wpm,
                    accuracy,
                    errors: this.errors,
                    language: this.selectedLang,
                    duration: this.selectedTime
                });

                // Keep only last 100 entries
                if (this.state.history.length > 100) {
                    this.state.history = this.state.history.slice(0, 100);
                }

                // Calculate averages
                const totalCPM = this.state.history.reduce((sum, h) => sum + h.cpm, 0);
                const totalAcc = this.state.history.reduce((sum, h) => sum + h.accuracy, 0);
                this.state.avgCPM = Math.round(totalCPM / this.state.history.length);
                this.state.avgAccuracy = Math.round(totalAcc / this.state.history.length);

                this.saveState();
                this.updateUI();
                this.checkAchievements();

                // Show results modal
                this.showResults(cpm, wpm, accuracy, this.errors, stars, points);
            }

            showResults(cpm, wpm, accuracy, errors, stars, points) {
                document.getElementById('finalCPM').textContent = cpm;
                document.getElementById('finalWPM').textContent = wpm;
                document.getElementById('finalAccuracy').textContent = accuracy + '%';
                document.getElementById('finalErrors').textContent = errors;
                document.getElementById('starsEarned').textContent = '‚≠ê'.repeat(stars) + '‚òÜ'.repeat(3 - stars);
                document.getElementById('pointsEarned').textContent = `+${points} points!`;

                document.getElementById('resultsModal').classList.add('active');

                // Confetti animation
                if (stars >= 2) {
                    this.createConfetti();
                }
            }

            createConfetti() {
                const colors = ['#5E60CE', '#48BFE3', '#64DFDF', '#72EFDD', '#80FFDB'];
                for (let i = 0; i < 50; i++) {
                    setTimeout(() => {
                        const confetti = document.createElement('div');
                        confetti.className = 'confetti';
                        confetti.style.left = Math.random() * 100 + 'vw';
                        confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                        confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
                        document.body.appendChild(confetti);

                        setTimeout(() => confetti.remove(), 4000);
                    }, i * 50);
                }
            }

            closeModal() {
                document.getElementById('resultsModal').classList.remove('active');
            }

            tryAgain() {
                this.closeModal();
                this.resetTest();
                setTimeout(() => this.startTest(), 300);
            }

            resetTest() {
                this.isRunning = false;
                this.testCompleted = false;
                clearInterval(this.timer);
                this.currentIndex = 0;
                this.errors = 0;
                this.correctChars = 0;
                this.timeLeft = this.selectedTime;

                document.getElementById('timerDisplay').textContent = this.selectedTime;
                document.getElementById('textDisplay').innerHTML = 'Press <strong>Enter</strong> or click "Start Test" to begin...';
                
                const input = document.getElementById('typingInput');
                input.value = '';
                input.disabled = true;

                document.getElementById('startBtn').innerHTML = '‚ñ∂Ô∏è Start Test <span class="shortcut">Enter</span>';
                document.getElementById('startBtn').disabled = false;

                document.getElementById('liveCPM').textContent = '0';
                document.getElementById('liveWPM').textContent = '0';
                document.getElementById('liveAccuracy').textContent = '100%';
                document.getElementById('liveErrors').textContent = '0';
            }

            updateUI() {
                document.getElementById('streakCount').textContent = this.state.streak;
                document.getElementById('totalStars').textContent = this.state.totalStars;
                document.getElementById('totalPoints').textContent = this.state.totalPoints;
            }

            generateCalendar() {
                const grid = document.getElementById('calendarGrid');
                const title = document.getElementById('calendarTitle');

                const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                    'July', 'August', 'September', 'October', 'November', 'December'];
                const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];

                title.textContent = `${monthNames[this.currentMonth]} ${this.currentYear}`;

                // Clear grid
                grid.innerHTML = '';

                // Add day headers
                dayNames.forEach(day => {
                    const header = document.createElement('div');
                    header.className = 'calendar-day-header';
                    header.textContent = day;
                    grid.appendChild(header);
                });

                // Get first day of month and total days
                const firstDay = new Date(this.currentYear, this.currentMonth, 1).getDay();
                const totalDays = new Date(this.currentYear, this.currentMonth + 1, 0).getDate();
                const today = new Date();

                // Add empty cells for days before first day
                for (let i = 0; i < firstDay; i++) {
                    const cell = document.createElement('div');
                    cell.className = 'calendar-day other-month';
                    grid.appendChild(cell);
                }

                // Add days
                for (let day = 1; day <= totalDays; day++) {
                    const cell = document.createElement('div');
                    cell.className = 'calendar-day';
                    cell.textContent = day;

                    const dateStr = new Date(this.currentYear, this.currentMonth, day).toDateString();
                    
                    // Check if today
                    if (day === today.getDate() && 
                        this.currentMonth === today.getMonth() && 
                        this.currentYear === today.getFullYear()) {
                        cell.classList.add('today');
                    }

                    // Check if has activity
                    if (this.state.dailyVisits[dateStr]) {
                        cell.classList.add('has-activity');
                        if (this.state.dailyVisits[dateStr].tests > 0) {
                            cell.classList.add('streak');
                        }
                    }

                    grid.appendChild(cell);
                }

                // Update monthly progress
                const daysInMonth = totalDays;
                const daysWithActivity = Object.keys(this.state.dailyVisits).filter(date => {
                    const d = new Date(date);
                    return d.getMonth() === this.currentMonth && d.getFullYear() === this.currentYear;
                }).length;

                document.getElementById('monthlyProgress').textContent = `${daysWithActivity}/${daysInMonth}`;
                document.getElementById('monthlyProgressBar').style.width = `${(daysWithActivity / daysInMonth) * 100}%`;
            }

            changeMonth(delta) {
                this.currentMonth += delta;
                if (this.currentMonth > 11) {
                    this.currentMonth = 0;
                    this.currentYear++;
                } else if (this.currentMonth < 0) {
                    this.currentMonth = 11;
                    this.currentYear--;
                }
                this.generateCalendar();
            }

            updateStats() {
                document.getElementById('avgCPM').textContent = this.state.avgCPM || 0;
                document.getElementById('avgAccuracy').textContent = (this.state.avgAccuracy || 0) + '%';
                document.getElementById('bestCPM').textContent = this.state.bestCPM || 0;
                document.getElementById('totalTests').textContent = this.state.totalTests || 0;

                this.renderHistory();
            }

            renderHistory() {
                const list = document.getElementById('historyList');
                list.innerHTML = '';

                const langNames = { en: 'English', uk: 'Ukrainian', ru: 'Russian', de: 'German' };

                this.state.history.slice(0, 20).forEach(item => {
                    const date = new Date(item.date);
                    const div = document.createElement('div');
                    div.className = 'history-item';
                    div.innerHTML = `
                        <div>
                            <div class="history-date">${date.toLocaleDateString()} ${date.toLocaleTimeString()}</div>
                            <div>${langNames[item.language] || 'Unknown'} ‚Ä¢ ${item.duration}s</div>
                        </div>
                        <div class="history-stats">
                            <div class="history-stat">
                                <div class="history-stat-value">${item.cpm}</div>
                                <div class="history-stat-label">CPM</div>
                            </div>
                            <div class="history-stat">
                                <div class="history-stat-value">${item.accuracy}%</div>
                                <div class="history-stat-label">Accuracy</div>
                            </div>
                        </div>
                    `;
                    list.appendChild(div);
                });

                if (this.state.history.length === 0) {
                    list.innerHTML = '<p style="text-align: center; color: var(--text-light);">No tests completed yet. Start typing!</p>';
                }
            }

            renderAchievements() {
                const grid = document.getElementById('achievementsGrid');
                grid.innerHTML = '';

                const stats = {
                    totalTests: this.state.totalTests,
                    bestCPM: this.state.bestCPM,
                    perfectTests: this.state.perfectTests,
                    maxStreak: this.state.maxStreak,
                    languagesUsed: this.state.languagesUsed.size,
                    totalDays: this.state.totalDays,
                    avgAccuracy: this.state.avgAccuracy
                };

                achievementsData.forEach(achievement => {
                    const unlocked = achievement.condition(stats);
                    const div = document.createElement('div');
                    div.className = `achievement ${unlocked ? 'unlocked' : ''}`;
                    div.innerHTML = `
                        <div class="achievement-icon">${achievement.icon}</div>
                        <div class="achievement-name">${achievement.name}</div>
                    `;
                    div.title = achievement.description;
                    grid.appendChild(div);

                    if (unlocked && !this.state.achievements.includes(achievement.id)) {
                        this.state.achievements.push(achievement.id);
                        this.saveState();
                    }
                });
            }

            checkAchievements() {
                const stats = {
                    totalTests: this.state.totalTests,
                    bestCPM: this.state.bestCPM,
                    perfectTests: this.state.perfectTests,
                    maxStreak: this.state.maxStreak,
                    languagesUsed: this.state.languagesUsed.size,
                    totalDays: this.state.totalDays,
                    avgAccuracy: this.state.avgAccuracy
                };

                achievementsData.forEach(achievement => {
                    if (achievement.condition(stats) && !this.state.achievements.includes(achievement.id)) {
                        this.state.achievements.push(achievement.id);
                    }
                });

                this.saveState();
            }
        }

        // Initialize app
        const app = new TypingApp();
    </script>
</body>
</html>
