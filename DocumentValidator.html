<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í–∞–ª—ñ–¥–∞—Ç–æ—Ä –î–æ–∫—É–º–µ–Ω—Ç—ñ–≤ | Document Validator</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Montserrat:wght@600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
    <style>
        :root {
            --primary: #1a73e8;
            --primary-dark: #1557b0;
            --secondary: #34a853;
            --warning: #fbbc04;
            --danger: #ea4335;
            --bg-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --card-bg: rgba(255, 255, 255, 0.95);
            --text-primary: #202124;
            --text-secondary: #5f6368;
            --border-radius: 16px;
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            --shadow-hover: 0 12px 48px rgba(0, 0, 0, 0.15);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background: var(--bg-gradient);
            min-height: 100vh;
            color: var(--text-primary);
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }

        /* Header */
        .header {
            text-align: center;
            padding: 30px 20px;
            color: white;
            position: relative;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 150px;
            height: 150px;
            background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3ClinearGradient id='grad' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%23ffd700'/%3E%3Cstop offset='100%25' style='stop-color:%23ffaa00'/%3E%3C/linearGradient%3E%3C/defs%3E%3Ccircle cx='50' cy='50' r='45' fill='url(%23grad)' opacity='0.2'/%3E%3Cpath d='M30 35 L50 25 L70 35 L70 65 L50 75 L30 65 Z' fill='none' stroke='white' stroke-width='2'/%3E%3Cpath d='M35 45 L45 55 L65 35' fill='none' stroke='%2334a853' stroke-width='3' stroke-linecap='round'/%3E%3C/svg%3E") no-repeat center;
            opacity: 0.3;
            z-index: 0;
        }

        .header h1 {
            font-family: 'Montserrat', sans-serif;
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
            position: relative;
            z-index: 1;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .lang-switch {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 5px;
            background: rgba(255, 255, 255, 0.2);
            padding: 5px;
            border-radius: 25px;
        }

        .lang-btn {
            padding: 8px 16px;
            border: none;
            background: transparent;
            color: white;
            cursor: pointer;
            border-radius: 20px;
            font-weight: 500;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .lang-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .lang-btn.active {
            background: white;
            color: var(--primary);
        }

        /* Main Grid */
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        /* Cards */
        .card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 24px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .card:hover {
            box-shadow: var(--shadow-hover);
            transform: translateY(-2px);
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .card-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .card-icon.upload { background: linear-gradient(135deg, #667eea, #764ba2); }
        .card-icon.whitelist { background: linear-gradient(135deg, #34a853, #0d652d); }
        .card-icon.blacklist { background: linear-gradient(135deg, #ea4335, #b31412); }
        .card-icon.results { background: linear-gradient(135deg, #fbbc04, #f57c00); }

        .card-title {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.3rem;
            color: var(--text-primary);
        }

        /* Upload Zone */
        .upload-zone {
            border: 3px dashed #ccc;
            border-radius: 16px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            position: relative;
            overflow: hidden;
        }

        .upload-zone::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: left 0.5s ease;
        }

        .upload-zone:hover::before {
            left: 100%;
        }

        .upload-zone:hover, .upload-zone.dragover {
            border-color: var(--primary);
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 64px;
            margin-bottom: 15px;
            display: block;
        }

        .upload-text {
            font-size: 1.1rem;
            color: var(--text-secondary);
            margin-bottom: 10px;
        }

        .upload-hint {
            font-size: 0.9rem;
            color: #999;
        }

        .file-input {
            display: none;
        }

        /* Files List */
        .files-list {
            margin-top: 15px;
            max-height: 200px;
            overflow-y: auto;
        }

        .file-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 15px;
            background: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 8px;
            transition: all 0.2s ease;
            border-left: 4px solid var(--primary);
        }

        .file-item:hover {
            background: #e9ecef;
        }

        .file-item.active {
            background: #e3f2fd;
            border-left-color: var(--secondary);
        }

        .file-item-info {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
            cursor: pointer;
        }

        .file-item-icon {
            font-size: 24px;
        }

        .file-item-name {
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 200px;
        }

        .file-item-size {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .file-item-actions {
            display: flex;
            gap: 5px;
        }

        .file-item-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            transition: all 0.2s ease;
            font-size: 16px;
        }

        .file-item-btn:hover {
            background: rgba(0, 0, 0, 0.1);
        }

        .file-item-btn.remove:hover {
            background: #ffebee;
            color: var(--danger);
        }

        .files-counter {
            text-align: center;
            margin-top: 10px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .files-counter .count {
            font-weight: 600;
            color: var(--primary);
        }

        /* Lists */
        .list-container {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 10px;
        }

        .list-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 15px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 8px;
            transition: all 0.2s ease;
        }

        .list-item:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }

        .list-item.whitelist-item {
            border-left: 4px solid var(--secondary);
        }

        .list-item.blacklist-item {
            border-left: 4px solid var(--danger);
        }

        .list-item-text {
            font-weight: 500;
        }

        .remove-btn {
            background: none;
            border: none;
            color: #999;
            cursor: pointer;
            font-size: 18px;
            padding: 5px;
            border-radius: 50%;
            transition: all 0.2s ease;
        }

        .remove-btn:hover {
            background: #ffebee;
            color: var(--danger);
        }

        /* Input Group */
        .input-group {
            display: flex;
            gap: 10px;
        }

        .input-group input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .input-group input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(26, 115, 232, 0.1);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(26, 115, 232, 0.3);
        }

        .btn-success {
            background: var(--secondary);
            color: white;
        }

        .btn-success:hover {
            background: #2d8e47;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #c62828;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }

        .btn-outline:hover {
            background: var(--primary);
            color: white;
        }

        .btn-scan {
            width: 100%;
            padding: 16px;
            font-size: 1.2rem;
            margin-top: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .btn-scan:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .btn-scan:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-clear {
            margin-top: 10px;
            width: 100%;
        }

        /* Results */
        .results-container {
            grid-column: 1 / -1;
        }

        .results-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            color: white;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
        }

        .stat-card.total { background: linear-gradient(135deg, #667eea, #764ba2); }
        .stat-card.whitelisted { background: linear-gradient(135deg, #34a853, #0d652d); }
        .stat-card.blacklisted { background: linear-gradient(135deg, #ea4335, #b31412); }
        .stat-card.unknown { background: linear-gradient(135deg, #fbbc04, #f57c00); }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            font-family: 'Montserrat', sans-serif;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-top: 5px;
        }

        /* Results Table */
        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .results-table th,
        .results-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        .results-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .results-table tr:hover {
            background: #f8f9fa;
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .status-badge.whitelist {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .status-badge.blacklist {
            background: #ffebee;
            color: #c62828;
        }

        .status-badge.unknown {
            background: #fff3e0;
            color: #ef6c00;
        }

        /* File Source Badge */
        .file-badge {
            display: inline-block;
            padding: 3px 8px;
            background: #e3f2fd;
            color: var(--primary);
            border-radius: 12px;
            font-size: 0.75rem;
            margin-left: 8px;
        }

        /* Progress Bar */
        .progress-container {
            margin: 20px 0;
            display: none;
        }

        .progress-container.show {
            display: block;
        }

        .progress-bar {
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 4px;
        }

        .progress-text {
            text-align: center;
            margin-top: 10px;
            color: var(--text-secondary);
        }

        /* Preset Cities */
        .preset-cities {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .preset-title {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 10px;
        }

        .preset-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .preset-tag {
            padding: 6px 12px;
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 20px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .preset-tag:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 30px;
            color: var(--text-secondary);
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 10px;
            opacity: 0.5;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 10px;
            overflow-x: auto;
        }

        .tab-btn {
            padding: 8px 16px;
            border: none;
            background: #f0f0f0;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s ease;
            white-space: nowrap;
        }

        .tab-btn:hover {
            background: #e0e0e0;
        }

        .tab-btn.active {
            background: var(--primary);
            color: white;
        }

        /* Animations */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .scanning .btn-scan {
            animation: pulse 1s infinite;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #a1a1a1;
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }

        .toast {
            padding: 15px 20px;
            background: white;
            border-radius: 10px;
            box-shadow: var(--shadow);
            margin-top: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: slideIn 0.3s ease;
            max-width: 350px;
        }

        .toast.success { border-left: 4px solid var(--secondary); }
        .toast.error { border-left: 4px solid var(--danger); }
        .toast.warning { border-left: 4px solid var(--warning); }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr;
            }

            .results-container {
                grid-column: 1;
            }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8rem;
            }

            .lang-switch {
                position: static;
                justify-content: center;
                margin-top: 15px;
            }

            .card {
                padding: 16px;
            }

            .upload-zone {
                padding: 25px;
            }

            .upload-icon {
                font-size: 48px;
            }

            .stat-number {
                font-size: 2rem;
            }

            .results-table {
                font-size: 0.9rem;
            }

            .results-table th,
            .results-table td {
                padding: 8px 10px;
            }

            .input-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }

            .file-item-name {
                max-width: 120px;
            }
        }

        /* Landscape orientation adjustments */
        @media (orientation: landscape) and (max-height: 600px) {
            .header {
                padding: 15px;
            }

            .header h1 {
                font-size: 1.5rem;
            }

            .container {
                padding: 10px;
            }

            .card {
                padding: 15px;
            }

            .upload-zone {
                padding: 20px;
            }

            .list-container {
                max-height: 150px;
            }

            .files-list {
                max-height: 120px;
            }
        }

        /* Dark mode support */
        @media (prefers-color-scheme: dark) {
            :root {
                --card-bg: rgba(30, 30, 30, 0.95);
                --text-primary: #e0e0e0;
                --text-secondary: #a0a0a0;
            }

            .card {
                background: var(--card-bg);
            }

            .card-header {
                border-bottom-color: #404040;
            }

            .upload-zone {
                background: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%);
                border-color: #555;
            }

            .upload-zone:hover {
                background: linear-gradient(135deg, #3d3d3d 0%, #2a2a2a 100%);
            }

            .list-container {
                border-color: #404040;
            }

            .list-item, .file-item {
                background: #2d2d2d;
            }

            .list-item:hover, .file-item:hover {
                background: #3d3d3d;
            }

            .input-group input {
                background: #2d2d2d;
                border-color: #404040;
                color: var(--text-primary);
            }

            .results-table th {
                background: #2d2d2d;
            }

            .results-table tr:hover {
                background: #2d2d2d;
            }

            .preset-cities {
                background: #2d2d2d;
            }

            .preset-tag {
                background: #3d3d3d;
                border-color: #555;
                color: var(--text-primary);
            }

            .tab-btn {
                background: #3d3d3d;
                color: var(--text-primary);
            }

            .tab-btn:hover {
                background: #4d4d4d;
            }
        }

        /* Print styles */
        @media print {
            body {
                background: white;
            }

            .header, .upload-zone, .input-group, .btn, .lang-switch {
                display: none;
            }

            .card {
                box-shadow: none;
                border: 1px solid #ddd;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="lang-switch">
                <button class="lang-btn active" data-lang="uk">–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</button>
                <button class="lang-btn" data-lang="en">English</button>
            </div>
            <h1 data-i18n="title">üìÑ –í–∞–ª—ñ–¥–∞—Ç–æ—Ä –î–æ–∫—É–º–µ–Ω—Ç—ñ–≤</h1>
            <p data-i18n="subtitle">–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞—Å–µ–ª–µ–Ω–∏—Ö –ø—É–Ω–∫—Ç—ñ–≤ —É –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö DOCX</p>
        </header>

        <div class="main-grid">
            <!-- Upload Card -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon upload">üì§</div>
                    <h2 class="card-title" data-i18n="uploadTitle">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤</h2>
                </div>
                <div class="upload-zone" id="uploadZone">
                    <span class="upload-icon">üìÅ</span>
                    <p class="upload-text" data-i18n="uploadText">–ü–µ—Ä–µ—Ç—è–≥–Ω—ñ—Ç—å —Ñ–∞–π–ª–∏ —Å—é–¥–∏ –∞–±–æ –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å –¥–ª—è –≤–∏–±–æ—Ä—É</p>
                    <p class="upload-hint" data-i18n="uploadHint">–ü—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è —Ñ–æ—Ä–º–∞—Ç .docx (–¥–æ 10 —Ñ–∞–π–ª—ñ–≤)</p>
                    <input type="file" class="file-input" id="fileInput" accept=".docx" multiple>
                </div>
                
                <div class="files-list" id="filesList"></div>
                <div class="files-counter" id="filesCounter" style="display: none;">
                    <span data-i18n="filesLoaded">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ —Ñ–∞–π–ª—ñ–≤:</span> 
                    <span class="count" id="filesCount">0</span>/10
                </div>
                
                <div class="progress-container" id="progressContainer">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <p class="progress-text" id="progressText" data-i18n="scanning">–°–∫–∞–Ω—É–≤–∞–Ω–Ω—è...</p>
                </div>
                <button class="btn btn-primary btn-scan" id="scanBtn" disabled data-i18n="scanBtn">
                    üîç –°–∫–∞–Ω—É–≤–∞—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏
                </button>
                <button class="btn btn-outline btn-clear" id="clearFilesBtn" style="display: none;" data-i18n="clearFiles">
                    üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å—ñ —Ñ–∞–π–ª–∏
                </button>
            </div>

            <!-- Whitelist Card -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon whitelist">‚úÖ</div>
                    <h2 class="card-title" data-i18n="whitelistTitle">–ë—ñ–ª–∏–π —Å–ø–∏—Å–æ–∫</h2>
                </div>
                <div class="list-container" id="whitelistContainer">
                    <div class="empty-state" id="whitelistEmpty">
                        <div class="empty-state-icon">üìã</div>
                        <p data-i18n="emptyWhitelist">–ë—ñ–ª–∏–π —Å–ø–∏—Å–æ–∫ –ø–æ—Ä–æ–∂–Ω—ñ–π</p>
                    </div>
                </div>
                <div class="input-group">
                    <input type="text" id="whitelistInput" data-i18n-placeholder="addCityPlaceholder" placeholder="–í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É –º—ñ—Å—Ç–∞...">
                    <button class="btn btn-success" id="addWhitelistBtn">‚ûï</button>
                </div>
                <div class="preset-cities">
                    <p class="preset-title" data-i18n="popularCities">–ü–æ–ø—É–ª—è—Ä–Ω—ñ –º—ñ—Å—Ç–∞:</p>
                    <div class="preset-tags" id="whitelistPresets">
                        <span class="preset-tag" data-city="–ö–∏—ó–≤">–ö–∏—ó–≤</span>
                        <span class="preset-tag" data-city="–õ—å–≤—ñ–≤">–õ—å–≤—ñ–≤</span>
                        <span class="preset-tag" data-city="–û–¥–µ—Å–∞">–û–¥–µ—Å–∞</span>
                        <span class="preset-tag" data-city="–•–∞—Ä–∫—ñ–≤">–•–∞—Ä–∫—ñ–≤</span>
                        <span class="preset-tag" data-city="–î–Ω—ñ–ø—Ä–æ">–î–Ω—ñ–ø—Ä–æ</span>
                    </div>
                </div>
            </div>

            <!-- Blacklist Card -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon blacklist">üö´</div>
                    <h2 class="card-title" data-i18n="blacklistTitle">–ß–æ—Ä–Ω–∏–π —Å–ø–∏—Å–æ–∫</h2>
                </div>
                <div class="list-container" id="blacklistContainer">
                    <div class="empty-state" id="blacklistEmpty">
                        <div class="empty-state-icon">üìã</div>
                        <p data-i18n="emptyBlacklist">–ß–æ—Ä–Ω–∏–π —Å–ø–∏—Å–æ–∫ –ø–æ—Ä–æ–∂–Ω—ñ–π</p>
                    </div>
                </div>
                <div class="input-group">
                    <input type="text" id="blacklistInput" data-i18n-placeholder="addCityPlaceholder" placeholder="–í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É –º—ñ—Å—Ç–∞...">
                    <button class="btn btn-danger" id="addBlacklistBtn">‚ûï</button>
                </div>
                <div class="preset-cities">
                    <p class="preset-title" data-i18n="occupiedTerritories">–û–∫—É–ø–æ–≤–∞–Ω—ñ —Ç–µ—Ä–∏—Ç–æ—Ä—ñ—ó:</p>
                    <div class="preset-tags" id="blacklistPresets">
                        <span class="preset-tag" data-city="–°—ñ–º—Ñ–µ—Ä–æ–ø–æ–ª—å">–°—ñ–º—Ñ–µ—Ä–æ–ø–æ–ª—å</span>
                        <span class="preset-tag" data-city="–°–µ–≤–∞—Å—Ç–æ–ø–æ–ª—å">–°–µ–≤–∞—Å—Ç–æ–ø–æ–ª—å</span>
                        <span class="preset-tag" data-city="–î–æ–Ω–µ—Ü—å–∫">–î–æ–Ω–µ—Ü—å–∫</span>
                        <span class="preset-tag" data-city="–õ—É–≥–∞–Ω—Å—å–∫">–õ—É–≥–∞–Ω—Å—å–∫</span>
                        <span class="preset-tag" data-city="–ú–∞—Ä—ñ—É–ø–æ–ª—å">–ú–∞—Ä—ñ—É–ø–æ–ª—å</span>
                    </div>
                </div>
            </div>

            <!-- Document Preview Card -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon results">üìù</div>
                    <h2 class="card-title" data-i18n="previewTitle">–¢–µ–∫—Å—Ç –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤</h2>
                </div>
                <div class="tabs" id="documentTabs"></div>
                <div class="list-container" id="documentPreview" style="max-height: 350px; font-size: 0.9rem; line-height: 1.6;">
                    <div class="empty-state">
                        <div class="empty-state-icon">üìÑ</div>
                        <p data-i18n="noDocument">–î–æ–∫—É–º–µ–Ω—Ç–∏ –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ</p>
                    </div>
                </div>
            </div>

            <!-- Results Card -->
            <div class="card results-container" id="resultsCard" style="display: none;">
                <div class="card-header">
                    <div class="card-icon results">üìä</div>
                    <h2 class="card-title" data-i18n="resultsTitle">–†–µ–∑—É–ª—å—Ç–∞—Ç–∏ —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è</h2>
                </div>
                <div class="results-summary">
                    <div class="stat-card total">
                        <div class="stat-number" id="totalCount">0</div>
                        <div class="stat-label" data-i18n="totalFound">–í—Å—å–æ–≥–æ –∑–Ω–∞–π–¥–µ–Ω–æ</div>
                    </div>
                    <div class="stat-card whitelisted">
                        <div class="stat-number" id="whitelistedCount">0</div>
                        <div class="stat-label" data-i18n="inWhitelist">–£ –±—ñ–ª–æ–º—É —Å–ø–∏—Å–∫—É</div>
                    </div>
                    <div class="stat-card blacklisted">
                        <div class="stat-number" id="blacklistedCount">0</div>
                        <div class="stat-label" data-i18n="inBlacklist">–£ —á–æ—Ä–Ω–æ–º—É —Å–ø–∏—Å–∫—É</div>
                    </div>
                    <div class="stat-card unknown">
                        <div class="stat-number" id="unknownCount">0</div>
                        <div class="stat-label" data-i18n="unknown">–ù–µ–≤—ñ–¥–æ–º—ñ</div>
                    </div>
                </div>
                <div style="overflow-x: auto;">
                    <table class="results-table">
                        <thead>
                            <tr>
                                <th data-i18n="cityName">–ù–∞–∑–≤–∞ –º—ñ—Å—Ç–∞</th>
                                <th data-i18n="occurrences">–ö—ñ–ª—å–∫—ñ—Å—Ç—å</th>
                                <th data-i18n="foundIn">–ó–Ω–∞–π–¥–µ–Ω–æ —É</th>
                                <th data-i18n="status">–°—Ç–∞—Ç—É—Å</th>
                                <th data-i18n="actions">–î—ñ—ó</th>
                            </tr>
                        </thead>
                        <tbody id="resultsBody">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div class="toast-container" id="toastContainer"></div>

    <script>
        // Internationalization
        const i18n = {
            uk: {
                title: 'üìÑ –í–∞–ª—ñ–¥–∞—Ç–æ—Ä –î–æ–∫—É–º–µ–Ω—Ç—ñ–≤',
                subtitle: '–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞—Å–µ–ª–µ–Ω–∏—Ö –ø—É–Ω–∫—Ç—ñ–≤ —É –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö DOCX',
                uploadTitle: '–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤',
                uploadText: '–ü–µ—Ä–µ—Ç—è–≥–Ω—ñ—Ç—å —Ñ–∞–π–ª–∏ —Å—é–¥–∏ –∞–±–æ –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å –¥–ª—è –≤–∏–±–æ—Ä—É',
                uploadHint: '–ü—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è —Ñ–æ—Ä–º–∞—Ç .docx (–¥–æ 10 —Ñ–∞–π–ª—ñ–≤)',
                filesLoaded: '–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ —Ñ–∞–π–ª—ñ–≤:',
                scanning: '–°–∫–∞–Ω—É–≤–∞–Ω–Ω—è...',
                scanBtn: 'üîç –°–∫–∞–Ω—É–≤–∞—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏',
                clearFiles: 'üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å—ñ —Ñ–∞–π–ª–∏',
                whitelistTitle: '–ë—ñ–ª–∏–π —Å–ø–∏—Å–æ–∫',
                blacklistTitle: '–ß–æ—Ä–Ω–∏–π —Å–ø–∏—Å–æ–∫',
                emptyWhitelist: '–ë—ñ–ª–∏–π —Å–ø–∏—Å–æ–∫ –ø–æ—Ä–æ–∂–Ω—ñ–π',
                emptyBlacklist: '–ß–æ—Ä–Ω–∏–π —Å–ø–∏—Å–æ–∫ –ø–æ—Ä–æ–∂–Ω—ñ–π',
                addCityPlaceholder: '–í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É –º—ñ—Å—Ç–∞...',
                popularCities: '–ü–æ–ø—É–ª—è—Ä–Ω—ñ –º—ñ—Å—Ç–∞:',
                occupiedTerritories: '–û–∫—É–ø–æ–≤–∞–Ω—ñ —Ç–µ—Ä–∏—Ç–æ—Ä—ñ—ó:',
                previewTitle: '–¢–µ–∫—Å—Ç –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤',
                noDocument: '–î–æ–∫—É–º–µ–Ω—Ç–∏ –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ',
                resultsTitle: '–†–µ–∑—É–ª—å—Ç–∞—Ç–∏ —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è',
                totalFound: '–í—Å—å–æ–≥–æ –∑–Ω–∞–π–¥–µ–Ω–æ',
                inWhitelist: '–£ –±—ñ–ª–æ–º—É —Å–ø–∏—Å–∫—É',
                inBlacklist: '–£ —á–æ—Ä–Ω–æ–º—É —Å–ø–∏—Å–∫—É',
                unknown: '–ù–µ–≤—ñ–¥–æ–º—ñ',
                cityName: '–ù–∞–∑–≤–∞ –º—ñ—Å—Ç–∞',
                occurrences: '–ö—ñ–ª—å–∫—ñ—Å—Ç—å',
                foundIn: '–ó–Ω–∞–π–¥–µ–Ω–æ —É',
                status: '–°—Ç–∞—Ç—É—Å',
                actions: '–î—ñ—ó',
                whitelist: '–ë—ñ–ª–∏–π —Å–ø–∏—Å–æ–∫',
                blacklist: '–ß–æ—Ä–Ω–∏–π —Å–ø–∏—Å–æ–∫',
                unknownStatus: '–ù–µ–≤—ñ–¥–æ–º–æ',
                addToWhitelist: '–î–æ –±—ñ–ª–æ–≥–æ',
                addToBlacklist: '–î–æ —á–æ—Ä–Ω–æ–≥–æ',
                fileLoaded: '–§–∞–π–ª —É—Å–ø—ñ—à–Ω–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ',
                filesLoaded2: '–§–∞–π–ª–∏ —É—Å–ø—ñ—à–Ω–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ',
                scanComplete: '–°–∫–∞–Ω—É–≤–∞–Ω–Ω—è –∑–∞–≤–µ—Ä—à–µ–Ω–æ',
                cityAdded: '–ú—ñ—Å—Ç–æ –¥–æ–¥–∞–Ω–æ –¥–æ —Å–ø–∏—Å–∫—É',
                cityRemoved: '–ú—ñ—Å—Ç–æ –≤–∏–¥–∞–ª–µ–Ω–æ –∑—ñ —Å–ø–∏—Å–∫—É',
                cityExists: '–ú—ñ—Å—Ç–æ –≤–∂–µ —î —É —Å–ø–∏—Å–∫—É',
                enterCityName: '–í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É –º—ñ—Å—Ç–∞',
                invalidFile: '–ù–µ–≤—ñ—Ä–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª—É',
                errorReading: '–ü–æ–º–∏–ª–∫–∞ —á–∏—Ç–∞–Ω–Ω—è —Ñ–∞–π–ª—É',
                maxFilesReached: '–ú–∞–∫—Å–∏–º—É–º 10 —Ñ–∞–π–ª—ñ–≤',
                fileRemoved: '–§–∞–π–ª –≤–∏–¥–∞–ª–µ–Ω–æ',
                allFilesCleared: '–í—Å—ñ —Ñ–∞–π–ª–∏ –æ—á–∏—â–µ–Ω–æ',
                allDocuments: '–í—Å—ñ –¥–æ–∫—É–º–µ–Ω—Ç–∏',
                files: '—Ñ–∞–π–ª—ñ–≤'
            },
            en: {
                title: 'üìÑ Document Validator',
                subtitle: 'Check cities and towns in DOCX documents',
                uploadTitle: 'File Upload',
                uploadText: 'Drag files here or click to select',
                uploadHint: 'Supports .docx format (up to 10 files)',
                filesLoaded: 'Files loaded:',
                scanning: 'Scanning...',
                scanBtn: 'üîç Scan Documents',
                clearFiles: 'üóëÔ∏è Clear All Files',
                whitelistTitle: 'Whitelist',
                blacklistTitle: 'Blacklist',
                emptyWhitelist: 'Whitelist is empty',
                emptyBlacklist: 'Blacklist is empty',
                addCityPlaceholder: 'Enter city name...',
                popularCities: 'Popular cities:',
                occupiedTerritories: 'Occupied territories:',
                previewTitle: 'Document Text',
                noDocument: 'No documents loaded',
                resultsTitle: 'Scan Results',
                totalFound: 'Total found',
                inWhitelist: 'In whitelist',
                inBlacklist: 'In blacklist',
                unknown: 'Unknown',
                cityName: 'City Name',
                occurrences: 'Count',
                foundIn: 'Found in',
                status: 'Status',
                actions: 'Actions',
                whitelist: 'Whitelist',
                blacklist: 'Blacklist',
                unknownStatus: 'Unknown',
                addToWhitelist: 'To whitelist',
                addToBlacklist: 'To blacklist',
                fileLoaded: 'File loaded successfully',
                filesLoaded2: 'Files loaded successfully',
                scanComplete: 'Scan complete',
                cityAdded: 'City added to list',
                cityRemoved: 'City removed from list',
                cityExists: 'City already in list',
                enterCityName: 'Enter city name',
                invalidFile: 'Invalid file format',
                errorReading: 'Error reading file',
                maxFilesReached: 'Maximum 10 files',
                fileRemoved: 'File removed',
                allFilesCleared: 'All files cleared',
                allDocuments: 'All documents',
                files: 'files'
            }
        };

        // Ukrainian cities database for detection
        const ukrainianCities = [
            '–ö–∏—ó–≤', '–•–∞—Ä–∫—ñ–≤', '–û–¥–µ—Å–∞', '–î–Ω—ñ–ø—Ä–æ', '–î–æ–Ω–µ—Ü—å–∫', '–ó–∞–ø–æ—Ä—ñ–∂–∂—è', '–õ—å–≤—ñ–≤',
            '–ö—Ä–∏–≤–∏–π –†—ñ–≥', '–ú–∏–∫–æ–ª–∞—ó–≤', '–ú–∞—Ä—ñ—É–ø–æ–ª—å', '–õ—É–≥–∞–Ω—Å—å–∫', '–í—ñ–Ω–Ω–∏—Ü—è', '–•–µ—Ä—Å–æ–Ω',
            '–ü–æ–ª—Ç–∞–≤–∞', '–ß–µ—Ä–Ω—ñ–≥—ñ–≤', '–ß–µ—Ä–∫–∞—Å–∏', '–ñ–∏—Ç–æ–º–∏—Ä', '–°—É–º–∏', '–•–º–µ–ª—å–Ω–∏—Ü—å–∫–∏–π',
            '–†—ñ–≤–Ω–µ', '–Ü–≤–∞–Ω–æ-–§—Ä–∞–Ω–∫—ñ–≤—Å—å–∫', '–¢–µ—Ä–Ω–æ–ø—ñ–ª—å', '–õ—É—Ü—å–∫', '–£–∂–≥–æ—Ä–æ–¥', '–ß–µ—Ä–Ω—ñ–≤—Ü—ñ',
            '–ë—ñ–ª–∞ –¶–µ—Ä–∫–≤–∞', '–ö—Ä–µ–º–µ–Ω—á—É–∫', '–ö—Ä–∞–º–∞—Ç–æ—Ä—Å—å–∫', '–ú–µ–ª—ñ—Ç–æ–ø–æ–ª—å', '–ù—ñ–∫–æ–ø–æ–ª—å',
            '–ë–µ—Ä–¥—è–Ω—Å—å–∫', '–ü–∞–≤–ª–æ–≥—Ä–∞–¥', '–ö–∞–º\'—è–Ω—Å—å–∫–µ', '–°–ª–æ–≤\'—è–Ω—Å—å–∫', '–£–∂–≥–æ—Ä–æ–¥',
            '–°—î–≤—î—Ä–æ–¥–æ–Ω–µ—Ü—å–∫', '–õ–∏—Å–∏—á–∞–Ω—Å—å–∫', '–ê–ª—á–µ–≤—Å—å–∫', '–ë—Ä–æ–≤–∞—Ä–∏', '–ö–æ–Ω–æ—Ç–æ–ø',
            '–£–º–∞–Ω—å', '–®–æ—Å—Ç–∫–∞', '–ö–æ—Ä–æ—Å—Ç–µ–Ω—å', '–ö–æ–≤–µ–ª—å', '–î—Ä–æ–≥–æ–±–∏—á', '–°—Ç—Ä–∏–π',
            '–ß–µ—Ä–≤–æ–Ω–æ–≥—Ä–∞–¥', '–ú—É–∫–∞—á–µ–≤–æ', '–ö–æ–ª–æ–º–∏—è', '–ö–∞–ª—É—à', '–ë–æ—Ä–∏—Å–ø—ñ–ª—å',
            '–§–∞—Å—Ç—ñ–≤', '–Ü—Ä–ø—ñ–Ω—å', '–ë—É—á–∞', '–í–∏—à–≥–æ—Ä–æ–¥', '–û–±—É—Ö—ñ–≤', '–í–∞—Å–∏–ª—å–∫—ñ–≤',
            '–°—ñ–º—Ñ–µ—Ä–æ–ø–æ–ª—å', '–°–µ–≤–∞—Å—Ç–æ–ø–æ–ª—å', '–ö–µ—Ä—á', '–Ñ–≤–ø–∞—Ç–æ—Ä—ñ—è', '–Ø–ª—Ç–∞', '–§–µ–æ–¥–æ—Å—ñ—è',
            '–î–∂–∞–Ω–∫–æ–π', '–ê–ª—É—à—Ç–∞', '–ë–∞—Ö—á–∏—Å–∞—Ä–∞–π', '–°—É–¥–∞–∫',
            '–ù–æ–≤–æ–º–æ—Å–∫–æ–≤—Å—å–∫', '–û–ª–µ–∫—Å–∞–Ω–¥—Ä—ñ—è', '–ï–Ω–µ—Ä–≥–æ–¥–∞—Ä', '–ù–æ–≤–æ–≤–æ–ª–∏–Ω—Å—å–∫',
            '–Æ–∂–Ω–æ—É–∫—Ä–∞—ó–Ω—Å—å–∫', '–ü–µ—Ä–≤–æ–º–∞–π—Å—å–∫', '–õ–æ–∑–æ–≤–∞', '–Ü–∑—é–º', '–ö—É–ø\'—è–Ω—Å—å–∫',
            '–ë–∞–ª–∞–∫–ª—ñ—è', '–ß—É–≥—É—ó–≤', '–í–æ–≤—á–∞–Ω—Å—å–∫', '–ö—Ä–∞—Å–Ω–æ–≥—Ä–∞–¥', '–¢–æ–∫–º–∞–∫',
            '–ë–µ—Ä–¥–∏—á—ñ–≤', '–ù–æ–≤–æ–≥—Ä–∞–¥-–í–æ–ª–∏–Ω—Å—å–∫–∏–π', '–ö–æ–∑—è—Ç–∏–Ω', '–ñ–º–µ—Ä–∏–Ω–∫–∞',
            '–ú–æ–≥–∏–ª—ñ–≤-–ü–æ–¥—ñ–ª—å—Å—å–∫–∏–π', '–õ–∞–¥–∏–∂–∏–Ω', '–ì–∞–π—Å–∏–Ω', '–¢—É–ª—å—á–∏–Ω',
            '–ü—Ä–∏–ª—É–∫–∏', '–ù—ñ–∂–∏–Ω', '–ë–∞—Ö–º–∞—á', '–ù–æ—Å—ñ–≤–∫–∞', '–ì–æ—Ä–æ–¥–Ω—è',
            '–õ—É–±–Ω–∏', '–ú–∏—Ä–≥–æ—Ä–æ–¥', '–ì–∞–¥—è—á', '–ì–æ—Ä—ñ—à–Ω—ñ –ü–ª–∞–≤–Ω—ñ',
            '–ö—Ä–æ–ø–∏–≤–Ω–∏—Ü—å–∫–∏–π', '–°–≤—ñ—Ç–ª–æ–≤–æ–¥—Å—å–∫', '–ó–Ω–∞–º\'—è–Ω–∫–∞', '–î–æ–ª–∏–Ω—Å—å–∫–∞',
            '–Ü–∑–º–∞—ó–ª', '–ë—ñ–ª–≥–æ—Ä–æ–¥-–î–Ω—ñ—Å—Ç—Ä–æ–≤—Å—å–∫–∏–π', '–Æ–∂–Ω–µ', '–¢–µ–ø–ª–æ–¥–∞—Ä', '–ö–æ—Ç–æ–≤—Å—å–∫',
            '–ù–æ–≤–∞ –ö–∞—Ö–æ–≤–∫–∞', '–ö–∞—Ö–æ–≤–∫–∞', '–ì–µ–Ω—ñ—á–µ—Å—å–∫', '–°–∫–∞–¥–æ–≤—Å—å–∫', '–¶—é—Ä—É–ø–∏–Ω—Å—å–∫',
            '–û—á–∞–∫—ñ–≤', '–í–æ–∑–Ω–µ—Å–µ–Ω—Å—å–∫', '–ü–µ—Ä–≤–æ–º–∞–π—Å—å–∫', '–Æ–∂–Ω–æ—É–∫—Ä–∞—ó–Ω—Å—å–∫',
            '–ì–æ—Ä–ª—ñ–≤–∫–∞', '–ú–∞–∫—ñ—ó–≤–∫–∞', '–Ñ–Ω–∞–∫—ñ—î–≤–µ', '–¢–æ—Ä–µ—Ü—å–∫', '–ü–æ–∫—Ä–æ–≤—Å—å–∫',
            '–ú–∏—Ä–Ω–æ–≥—Ä–∞–¥', '–î–æ–±—Ä–æ–ø—ñ–ª–ª—è', '–°–µ–ª–∏–¥–æ–≤–µ', '–í—É–≥–ª–µ–¥–∞—Ä', '–ö—É—Ä–∞—Ö–æ–≤–µ'
        ];

        // Application State
        class AppState {
            constructor() {
                this.whitelist = [];
                this.blacklist = [];
                this.documents = []; // Array of {id, name, text, size}
                this.activeDocumentId = null;
                this.results = [];
                this.language = 'uk';
                this.load();
            }

            save() {
                const state = {
                    whitelist: this.whitelist,
                    blacklist: this.blacklist,
                    documents: this.documents,
                    activeDocumentId: this.activeDocumentId,
                    results: this.results,
                    language: this.language
                };
                localStorage.setItem('docValidatorState', JSON.stringify(state));
            }

            load() {
                try {
                    const saved = localStorage.getItem('docValidatorState');
                    if (saved) {
                        const state = JSON.parse(saved);
                        this.whitelist = state.whitelist || [];
                        this.blacklist = state.blacklist || [];
                        this.documents = state.documents || [];
                        this.activeDocumentId = state.activeDocumentId || null;
                        this.results = state.results || [];
                        this.language = state.language || 'uk';
                    }
                } catch (e) {
                    console.error('Error loading state:', e);
                }
            }

            addDocument(name, text, size) {
                if (this.documents.length >= 10) return false;
                const id = Date.now().toString() + Math.random().toString(36).substr(2, 9);
                this.documents.push({ id, name, text, size });
                if (!this.activeDocumentId) {
                    this.activeDocumentId = id;
                }
                this.save();
                return true;
            }

            removeDocument(id) {
                this.documents = this.documents.filter(d => d.id !== id);
                if (this.activeDocumentId === id) {
                    this.activeDocumentId = this.documents.length > 0 ? this.documents[0].id : null;
                }
                this.save();
            }

            clearAllDocuments() {
                this.documents = [];
                this.activeDocumentId = null;
                this.results = [];
                this.save();
            }

            setActiveDocument(id) {
                this.activeDocumentId = id;
                this.save();
            }

            getActiveDocument() {
                return this.documents.find(d => d.id === this.activeDocumentId);
            }

            getAllText() {
                return this.documents.map(d => d.text).join('\n\n');
            }

            addToWhitelist(city) {
                city = city.trim();
                if (!city) return false;
                if (this.whitelist.includes(city)) return false;
                this.blacklist = this.blacklist.filter(c => c !== city);
                this.whitelist.push(city);
                this.save();
                return true;
            }

            addToBlacklist(city) {
                city = city.trim();
                if (!city) return false;
                if (this.blacklist.includes(city)) return false;
                this.whitelist = this.whitelist.filter(c => c !== city);
                this.blacklist.push(city);
                this.save();
                return true;
            }

            removeFromWhitelist(city) {
                this.whitelist = this.whitelist.filter(c => c !== city);
                this.save();
            }

            removeFromBlacklist(city) {
                this.blacklist = this.blacklist.filter(c => c !== city);
                this.save();
            }

            setResults(results) {
                this.results = results;
                this.save();
            }

            setLanguage(lang) {
                this.language = lang;
                this.save();
            }
        }

        // Initialize state
        const state = new AppState();

        // DOM Elements
        const uploadZone = document.getElementById('uploadZone');
        const fileInput = document.getElementById('fileInput');
        const filesList = document.getElementById('filesList');
        const filesCounter = document.getElementById('filesCounter');
        const filesCount = document.getElementById('filesCount');
        const scanBtn = document.getElementById('scanBtn');
        const clearFilesBtn = document.getElementById('clearFilesBtn');
        const progressContainer = document.getElementById('progressContainer');
        const progressFill = document.getElementById('progressFill');
        const progressText = document.getElementById('progressText');
        const whitelistContainer = document.getElementById('whitelistContainer');
        const blacklistContainer = document.getElementById('blacklistContainer');
        const whitelistInput = document.getElementById('whitelistInput');
        const blacklistInput = document.getElementById('blacklistInput');
        const addWhitelistBtn = document.getElementById('addWhitelistBtn');
        const addBlacklistBtn = document.getElementById('addBlacklistBtn');
        const documentTabs = document.getElementById('documentTabs');
        const documentPreview = document.getElementById('documentPreview');
        const resultsCard = document.getElementById('resultsCard');
        const resultsBody = document.getElementById('resultsBody');
        const toastContainer = document.getElementById('toastContainer');

        // Language Functions
        function setLanguage(lang) {
            state.setLanguage(lang);
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (i18n[lang][key]) {
                    el.textContent = i18n[lang][key];
                }
            });
            document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
                const key = el.getAttribute('data-i18n-placeholder');
                if (i18n[lang][key]) {
                    el.placeholder = i18n[lang][key];
                }
            });
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.lang === lang);
            });
            // Re-render components that depend on language
            renderDocumentTabs();
            renderResults();
        }

        // Toast Notifications
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <span>${type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ö†Ô∏è'}</span>
                <span>${message}</span>
            `;
            toastContainer.appendChild(toast);
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateX(100px)';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // Format file size
        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
            return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
        }

        // Render Files List
        function renderFilesList() {
            if (state.documents.length === 0) {
                filesList.innerHTML = '';
                filesCounter.style.display = 'none';
                clearFilesBtn.style.display = 'none';
                scanBtn.disabled = true;
                return;
            }

            filesCounter.style.display = 'block';
            clearFilesBtn.style.display = 'block';
            filesCount.textContent = state.documents.length;
            scanBtn.disabled = false;

            filesList.innerHTML = state.documents.map(doc => `
                <div class="file-item ${doc.id === state.activeDocumentId ? 'active' : ''}" data-id="${doc.id}">
                    <div class="file-item-info" onclick="selectDocument('${doc.id}')">
                        <span class="file-item-icon">üìÑ</span>
                        <div>
                            <div class="file-item-name">${doc.name}</div>
                            <div class="file-item-size">${formatFileSize(doc.size)}</div>
                        </div>
                    </div>
                    <div class="file-item-actions">
                        <button class="file-item-btn remove" onclick="removeDocument('${doc.id}')" title="Remove">‚úï</button>
                    </div>
                </div>
            `).join('');
        }

        // Render Lists
        function renderWhitelist() {
            const emptyState = document.getElementById('whitelistEmpty');
            if (state.whitelist.length === 0) {
                whitelistContainer.innerHTML = '';
                const empty = document.createElement('div');
                empty.className = 'empty-state';
                empty.id = 'whitelistEmpty';
                empty.innerHTML = `
                    <div class="empty-state-icon">üìã</div>
                    <p data-i18n="emptyWhitelist">${i18n[state.language].emptyWhitelist}</p>
                `;
                whitelistContainer.appendChild(empty);
                return;
            }
            
            whitelistContainer.innerHTML = state.whitelist.map(city => `
                <div class="list-item whitelist-item">
                    <span class="list-item-text">‚úÖ ${city}</span>
                    <button class="remove-btn" data-city="${city}" data-list="whitelist">‚úï</button>
                </div>
            `).join('');
        }

        function renderBlacklist() {
            if (state.blacklist.length === 0) {
                blacklistContainer.innerHTML = '';
                const empty = document.createElement('div');
                empty.className = 'empty-state';
                empty.id = 'blacklistEmpty';
                empty.innerHTML = `
                    <div class="empty-state-icon">üìã</div>
                    <p data-i18n="emptyBlacklist">${i18n[state.language].emptyBlacklist}</p>
                `;
                blacklistContainer.appendChild(empty);
                return;
            }
            
            blacklistContainer.innerHTML = state.blacklist.map(city => `
                <div class="list-item blacklist-item">
                    <span class="list-item-text">üö´ ${city}</span>
                    <button class="remove-btn" data-city="${city}" data-list="blacklist">‚úï</button>
                </div>
            `).join('');
        }

        function renderDocumentTabs() {
            if (state.documents.length === 0) {
                documentTabs.innerHTML = '';
                documentTabs.style.display = 'none';
                return;
            }

            documentTabs.style.display = 'flex';
            const lang = state.language;
            
            let tabsHtml = '';
            if (state.documents.length > 1) {
                tabsHtml += `<button class="tab-btn ${state.activeDocumentId === 'all' ? 'active' : ''}" 
                             onclick="selectDocument('all')">${i18n[lang].allDocuments}</button>`;
            }
            
            tabsHtml += state.documents.map(doc => `
                <button class="tab-btn ${doc.id === state.activeDocumentId ? 'active' : ''}" 
                        onclick="selectDocument('${doc.id}')">${doc.name}</button>
            `).join('');
            
            documentTabs.innerHTML = tabsHtml;
        }

        function renderDocumentPreview() {
            if (state.documents.length === 0) {
                documentPreview.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìÑ</div>
                        <p data-i18n="noDocument">${i18n[state.language].noDocument}</p>
                    </div>
                `;
                return;
            }
            
            let text = '';
            if (state.activeDocumentId === 'all') {
                text = state.getAllText();
            } else {
                const doc = state.getActiveDocument();
                text = doc ? doc.text : '';
            }
            
            let highlightedText = escapeHtml(text);
            
            // Highlight cities from whitelist (green)
            state.whitelist.forEach(city => {
                const regex = new RegExp(`(${escapeRegex(city)})`, 'gi');
                highlightedText = highlightedText.replace(regex, 
                    '<span style="background: #c8e6c9; padding: 2px 4px; border-radius: 3px;">$1</span>');
            });
            
            // Highlight cities from blacklist (red)
            state.blacklist.forEach(city => {
                const regex = new RegExp(`(${escapeRegex(city)})`, 'gi');
                highlightedText = highlightedText.replace(regex, 
                    '<span style="background: #ffcdd2; padding: 2px 4px; border-radius: 3px;">$1</span>');
            });
            
            documentPreview.innerHTML = `<div style="white-space: pre-wrap;">${highlightedText}</div>`;
        }

        function renderResults() {
            if (state.results.length === 0) {
                resultsCard.style.display = 'none';
                return;
            }
            
            resultsCard.style.display = 'block';
            
            const total = state.results.length;
            const whitelisted = state.results.filter(r => r.status === 'whitelist').length;
            const blacklisted = state.results.filter(r => r.status === 'blacklist').length;
            const unknown = state.results.filter(r => r.status === 'unknown').length;
            
            document.getElementById('totalCount').textContent = total;
            document.getElementById('whitelistedCount').textContent = whitelisted;
            document.getElementById('blacklistedCount').textContent = blacklisted;
            document.getElementById('unknownCount').textContent = unknown;
            
            const lang = state.language;
            resultsBody.innerHTML = state.results.map(result => `
                <tr>
                    <td><strong>${result.city}</strong></td>
                    <td>${result.count}</td>
                    <td>
                        ${result.files.map(f => `<span class="file-badge">${f}</span>`).join(' ')}
                    </td>
                    <td>
                        <span class="status-badge ${result.status}">
                            ${result.status === 'whitelist' ? i18n[lang].whitelist : 
                              result.status === 'blacklist' ? i18n[lang].blacklist : 
                              i18n[lang].unknownStatus}
                        </span>
                    </td>
                    <td>
                        ${result.status === 'unknown' ? `
                            <button class="btn btn-success" style="padding: 6px 12px; font-size: 0.8rem;" 
                                    onclick="addCityToList('${escapeHtml(result.city)}', 'whitelist')">
                                ${i18n[lang].addToWhitelist}
                            </button>
                            <button class="btn btn-danger" style="padding: 6px 12px; font-size: 0.8rem; margin-left: 5px;" 
                                    onclick="addCityToList('${escapeHtml(result.city)}', 'blacklist')">
                                ${i18n[lang].addToBlacklist}
                            </button>
                        ` : '‚Äî'}
                    </td>
                </tr>
            `).join('');
        }

        // Utility Functions
        function escapeRegex(string) {
            return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function selectDocument(id) {
            state.setActiveDocument(id);
            renderFilesList();
            renderDocumentTabs();
            renderDocumentPreview();
        }

        function removeDocument(id) {
            state.removeDocument(id);
            renderFilesList();
            renderDocumentTabs();
            renderDocumentPreview();
            showToast(i18n[state.language].fileRemoved);
        }

        function addCityToList(city, list) {
            if (list === 'whitelist') {
                if (state.addToWhitelist(city)) {
                    showToast(i18n[state.language].cityAdded);
                }
            } else {
                if (state.addToBlacklist(city)) {
                    showToast(i18n[state.language].cityAdded);
                }
            }
            renderWhitelist();
            renderBlacklist();
            if (state.documents.length > 0) {
                scanDocument();
            }
        }

        // File Handling
        async function handleFiles(files) {
            const validFiles = Array.from(files).filter(f => f.name.endsWith('.docx'));
            
            if (validFiles.length === 0) {
                showToast(i18n[state.language].invalidFile, 'error');
                return;
            }

            const remainingSlots = 10 - state.documents.length;
            if (remainingSlots <= 0) {
                showToast(i18n[state.language].maxFilesReached, 'warning');
                return;
            }

            const filesToProcess = validFiles.slice(0, remainingSlots);
            let successCount = 0;

            for (const file of filesToProcess) {
                try {
                    const arrayBuffer = await file.arrayBuffer();
                    const result = await mammoth.extractRawText({ arrayBuffer });
                    if (state.addDocument(file.name, result.value, file.size)) {
                        successCount++;
                    }
                } catch (error) {
                    console.error('Error reading file:', error);
                    showToast(`${i18n[state.language].errorReading}: ${file.name}`, 'error');
                }
            }

            if (successCount > 0) {
                renderFilesList();
                renderDocumentTabs();
                renderDocumentPreview();
                showToast(successCount === 1 ? 
                    i18n[state.language].fileLoaded : 
                    `${successCount} ${i18n[state.language].files} ${i18n[state.language].filesLoaded2}`);
            }

            if (validFiles.length > remainingSlots) {
                showToast(i18n[state.language].maxFilesReached, 'warning');
            }
        }

        // Scan Document
        async function scanDocument() {
            if (state.documents.length === 0) return;
            
            progressContainer.classList.add('show');
            scanBtn.disabled = true;
            document.body.classList.add('scanning');
            
            const foundCities = new Map();
            
            // Combine all known cities
            const allCities = [...new Set([...ukrainianCities, ...state.whitelist, ...state.blacklist])];
            
            let progress = 0;
            const totalSteps = allCities.length * state.documents.length;
            
            for (const doc of state.documents) {
                for (const city of allCities) {
                    const regex = new RegExp(`\\b${escapeRegex(city)}\\b`, 'gi');
                    const matches = doc.text.match(regex);
                    if (matches) {
                        if (!foundCities.has(city)) {
                            foundCities.set(city, { count: 0, files: new Set() });
                        }
                        const data = foundCities.get(city);
                        data.count += matches.length;
                        data.files.add(doc.name);
                    }
                    
                    progress++;
                    progressFill.style.width = `${(progress / totalSteps) * 100}%`;
                    
                    if (progress % 100 === 0) {
                        await new Promise(resolve => setTimeout(resolve, 5));
                    }
                }
            }
            
            // Build results
            const results = [];
            foundCities.forEach((data, city) => {
                let status = 'unknown';
                if (state.whitelist.includes(city)) {
                    status = 'whitelist';
                } else if (state.blacklist.includes(city)) {
                    status = 'blacklist';
                }
                results.push({ 
                    city, 
                    count: data.count, 
                    files: Array.from(data.files),
                    status 
                });
            });
            
            // Sort by count descending
            results.sort((a, b) => b.count - a.count);
            
            state.setResults(results);
            
            setTimeout(() => {
                progressContainer.classList.remove('show');
                scanBtn.disabled = false;
                document.body.classList.remove('scanning');
                progressFill.style.width = '0%';
                
                renderResults();
                renderDocumentPreview();
                showToast(i18n[state.language].scanComplete);
            }, 500);
        }

        // Event Listeners
        uploadZone.addEventListener('click', () => fileInput.click());
        
        uploadZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadZone.classList.add('dragover');
        });
        
        uploadZone.addEventListener('dragleave', () => {
            uploadZone.classList.remove('dragover');
        });
        
        uploadZone.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadZone.classList.remove('dragover');
            handleFiles(e.dataTransfer.files);
        });
        
        fileInput.addEventListener('change', (e) => {
            handleFiles(e.target.files);
            fileInput.value = '';
        });
        
        scanBtn.addEventListener('click', scanDocument);
        
        clearFilesBtn.addEventListener('click', () => {
            state.clearAllDocuments();
            renderFilesList();
            renderDocumentTabs();
            renderDocumentPreview();
            renderResults();
            showToast(i18n[state.language].allFilesCleared);
        });
        
        // Add to lists
        addWhitelistBtn.addEventListener('click', () => {
            const city = whitelistInput.value.trim();
            if (!city) {
                showToast(i18n[state.language].enterCityName, 'warning');
                return;
            }
            if (state.addToWhitelist(city)) {
                showToast(i18n[state.language].cityAdded);
                whitelistInput.value = '';
                renderWhitelist();
                renderBlacklist();
                if (state.documents.length > 0) renderDocumentPreview();
            } else {
                showToast(i18n[state.language].cityExists, 'warning');
            }
        });
        
        addBlacklistBtn.addEventListener('click', () => {
            const city = blacklistInput.value.trim();
            if (!city) {
                showToast(i18n[state.language].enterCityName, 'warning');
                return;
            }
            if (state.addToBlacklist(city)) {
                showToast(i18n[state.language].cityAdded);
                blacklistInput.value = '';
                renderWhitelist();
                renderBlacklist();
                if (state.documents.length > 0) renderDocumentPreview();
            } else {
                showToast(i18n[state.language].cityExists, 'warning');
            }
        });
        
        // Enter key support
        whitelistInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') addWhitelistBtn.click();
        });
        
        blacklistInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') addBlacklistBtn.click();
        });
        
        // Remove from lists
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('remove-btn')) {
                const city = e.target.dataset.city;
                const list = e.target.dataset.list;
                if (list === 'whitelist') {
                    state.removeFromWhitelist(city);
                } else {
                    state.removeFromBlacklist(city);
                }
                showToast(i18n[state.language].cityRemoved);
                renderWhitelist();
                renderBlacklist();
                if (state.documents.length > 0) renderDocumentPreview();
            }
        });
        
        // Preset tags
        document.getElementById('whitelistPresets').addEventListener('click', (e) => {
            if (e.target.classList.contains('preset-tag')) {
                const city = e.target.dataset.city;
                if (state.addToWhitelist(city)) {
                    showToast(i18n[state.language].cityAdded);
                    renderWhitelist();
                    renderBlacklist();
                    if (state.documents.length > 0) renderDocumentPreview();
                }
            }
        });
        
        document.getElementById('blacklistPresets').addEventListener('click', (e) => {
            if (e.target.classList.contains('preset-tag')) {
                const city = e.target.dataset.city;
                if (state.addToBlacklist(city)) {
                    showToast(i18n[state.language].cityAdded);
                    renderWhitelist();
                    renderBlacklist();
                    if (state.documents.length > 0) renderDocumentPreview();
                }
            }
        });
        
        // Language switch
        document.querySelectorAll('.lang-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                setLanguage(btn.dataset.lang);
            });
        });
        
        // Initialize
        function init() {
            setLanguage(state.language);
            renderWhitelist();
            renderBlacklist();
            renderFilesList();
            renderDocumentTabs();
            renderDocumentPreview();
            renderResults();
        }
        
        // Handle orientation change
        window.addEventListener('orientationchange', () => {
            setTimeout(() => {
                window.scrollTo(0, 0);
            }, 100);
        });
        
        // Handle resize
        let resizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                // Adjust UI if needed
            }, 250);
        });
        
        // Start application
        init();
    </script>
</body>
</html>
