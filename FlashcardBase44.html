<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>–§–ª–µ—à–∫–∞—Ä—Ç–∫–∏ - –í–∏–≤—á–µ–Ω–Ω—è –ê–Ω–≥–ª—ñ–π—Å—å–∫–æ—ó</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #6C5CE7;
            --primary-light: #A29BFE;
            --primary-dark: #5A4BD1;
            --secondary: #00CEC9;
            --accent: #FD79A8;
            --success: #00B894;
            --warning: #FDCB6E;
            --danger: #E17055;
            --bg: #0F0F1A;
            --bg-card: #1A1A2E;
            --bg-elevated: #222240;
            --text: #EEEEF0;
            --text-secondary: #9999AA;
            --border: #333355;
            --shadow: rgba(0, 0, 0, 0.3);
            --glow: rgba(108, 92, 231, 0.3);
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(ellipse at 20% 20%, rgba(108, 92, 231, 0.08) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(0, 206, 201, 0.06) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 50%, rgba(253, 121, 168, 0.04) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        .app-container {
            position: relative;
            z-index: 1;
            max-width: 1200px;
            margin: 0 auto;
            padding: 16px;
            min-height: 100vh;
        }

        /* Header */
        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 20px;
            background: var(--bg-card);
            border-radius: 16px;
            border: 1px solid var(--border);
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 12px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.4em;
            font-weight: 800;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .logo-text {
            background: linear-gradient(135deg, var(--primary-light), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-stats {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
        }

        .stat-badge {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 14px;
            background: var(--bg-elevated);
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 500;
        }

        .stat-badge .stat-icon {
            font-size: 1.1em;
        }

        .stat-badge .stat-value {
            color: var(--primary-light);
            font-weight: 700;
        }

        /* Navigation */
        .nav-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            overflow-x: auto;
            padding-bottom: 4px;
        }

        .nav-tab {
            padding: 10px 20px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 500;
            transition: all 0.3s;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-tab:hover {
            border-color: var(--primary);
            color: var(--text);
        }

        .nav-tab.active {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-color: var(--primary);
            color: white;
            box-shadow: 0 4px 15px var(--glow);
        }

        /* Page sections */
        .page {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Decks Grid */
        .decks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }

        .deck-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .deck-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            border-radius: 16px 16px 0 0;
        }

        .deck-card.level-b1::before { background: linear-gradient(90deg, var(--success), #55EFC4); }
        .deck-card.level-b2::before { background: linear-gradient(90deg, var(--warning), #F9CA24); }
        .deck-card.level-c1::before { background: linear-gradient(90deg, var(--danger), #FF7675); }
        .deck-card.custom::before { background: linear-gradient(90deg, var(--primary), var(--secondary)); }

        .deck-card:hover {
            transform: translateY(-4px);
            border-color: var(--primary);
            box-shadow: 0 8px 30px var(--shadow);
        }

        .deck-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .deck-title {
            font-size: 1.1em;
            font-weight: 700;
        }

        .deck-level {
            padding: 3px 10px;
            border-radius: 8px;
            font-size: 0.75em;
            font-weight: 700;
            text-transform: uppercase;
        }

        .level-b1 .deck-level { background: rgba(0, 184, 148, 0.2); color: var(--success); }
        .level-b2 .deck-level { background: rgba(253, 203, 110, 0.2); color: var(--warning); }
        .level-c1 .deck-level { background: rgba(225, 112, 85, 0.2); color: var(--danger); }
        .custom .deck-level { background: rgba(108, 92, 231, 0.2); color: var(--primary-light); }

        .deck-description {
            color: var(--text-secondary);
            font-size: 0.85em;
            margin-bottom: 16px;
            line-height: 1.4;
        }

        .deck-progress {
            margin-bottom: 12px;
        }

        .progress-bar {
            height: 6px;
            background: var(--bg-elevated);
            border-radius: 3px;
            overflow: hidden;
            margin-top: 6px;
        }

        .progress-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.5s ease;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
        }

        .progress-text {
            display: flex;
            justify-content: space-between;
            font-size: 0.8em;
            color: var(--text-secondary);
        }

        .deck-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .deck-count {
            font-size: 0.85em;
            color: var(--text-secondary);
        }

        .deck-actions {
            display: flex;
            gap: 8px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-family: 'Inter', sans-serif;
            font-size: 0.85em;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            box-shadow: 0 4px 12px var(--glow);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px var(--glow);
        }

        .btn-secondary {
            background: var(--bg-elevated);
            color: var(--text);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            border-color: var(--primary);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success), #55EFC4);
            color: #1A1A2E;
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #FF7675);
            color: white;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 0.8em;
        }

        .btn-icon {
            width: 36px;
            height: 36px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
        }

        /* Flashcard Study Area */
        .study-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px 0;
        }

        .study-header {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .study-title {
            font-size: 1.2em;
            font-weight: 700;
        }

        .study-progress-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .card-counter {
            font-size: 0.9em;
            color: var(--text-secondary);
        }

        .flashcard-container {
            perspective: 1200px;
            width: 100%;
            max-width: 500px;
            height: 320px;
            margin-bottom: 24px;
            cursor: pointer;
        }

        .flashcard {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .flashcard.flipped {
            transform: rotateY(180deg);
        }

        .flashcard-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 30px;
            text-align: center;
            border: 1px solid var(--border);
        }

        .flashcard-front {
            background: linear-gradient(145deg, var(--bg-card), var(--bg-elevated));
            box-shadow: 0 10px 40px var(--shadow);
        }

        .flashcard-back {
            background: linear-gradient(145deg, #1E1E3A, #2A2A4A);
            transform: rotateY(180deg);
            box-shadow: 0 10px 40px var(--shadow);
        }

        .flashcard-word {
            font-size: 2em;
            font-weight: 800;
            margin-bottom: 12px;
            background: linear-gradient(135deg, var(--text), var(--primary-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .flashcard-phonetic {
            font-size: 0.95em;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .flashcard-hint {
            font-size: 0.85em;
            color: var(--primary-light);
            margin-top: 16px;
        }

        .flashcard-translation {
            font-size: 1.8em;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--secondary);
        }

        .flashcard-example {
            font-size: 0.9em;
            color: var(--text-secondary);
            line-height: 1.5;
            font-style: italic;
        }

        .flip-indicator {
            font-size: 0.8em;
            color: var(--text-secondary);
            margin-top: auto;
            display: flex;
            align-items: center;
            gap: 6px;
            opacity: 0.7;
        }

        /* Rating buttons */
        .rating-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 20px;
        }

        .rating-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-family: 'Inter', sans-serif;
            font-size: 0.85em;
            font-weight: 600;
            transition: all 0.3s;
            min-width: 100px;
        }

        .rating-btn.again {
            background: linear-gradient(135deg, #E17055, #D63031);
            color: white;
        }

        .rating-btn.hard {
            background: linear-gradient(135deg, #FDCB6E, #E17055);
            color: #1A1A2E;
        }

        .rating-btn.good {
            background: linear-gradient(135deg, #00B894, #00CEC9);
            color: #1A1A2E;
        }

        .rating-btn.easy {
            background: linear-gradient(135deg, #6C5CE7, #A29BFE);
            color: white;
        }

        .rating-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px var(--shadow);
        }

        .rating-btn .rating-label {
            display: block;
            font-size: 0.75em;
            opacity: 0.8;
            margin-top: 2px;
        }

        /* Stats Page */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
        }

        .stat-card-icon {
            font-size: 2em;
            margin-bottom: 8px;
        }

        .stat-card-value {
            font-size: 2em;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary-light), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-card-label {
            font-size: 0.85em;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        /* Word list */
        .word-list {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            overflow: hidden;
        }

        .word-list-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .word-list-title {
            font-weight: 700;
            font-size: 1.1em;
        }

        .filter-group {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 5px 12px;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: transparent;
            color: var(--text-secondary);
            cursor: pointer;
            font-family: 'Inter', sans-serif;
            font-size: 0.8em;
            transition: all 0.3s;
        }

        .filter-btn.active {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        .word-item {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            border-bottom: 1px solid rgba(51, 51, 85, 0.5);
            transition: background 0.2s;
        }

        .word-item:hover {
            background: var(--bg-elevated);
        }

        .word-item:last-child {
            border-bottom: none;
        }

        .word-english {
            font-weight: 600;
            min-width: 140px;
        }

        .word-translation {
            color: var(--text-secondary);
            flex: 1;
        }

        .word-level-badge {
            padding: 2px 8px;
            border-radius: 6px;
            font-size: 0.7em;
            font-weight: 700;
            margin-right: 12px;
        }

        .word-level-badge.b1 { background: rgba(0, 184, 148, 0.2); color: var(--success); }
        .word-level-badge.b2 { background: rgba(253, 203, 110, 0.2); color: var(--warning); }
        .word-level-badge.c1 { background: rgba(225, 112, 85, 0.2); color: var(--danger); }

        .word-mastery {
            display: flex;
            align-items: center;
            gap: 6px;
            min-width: 80px;
            justify-content: flex-end;
        }

        .mastery-dots {
            display: flex;
            gap: 3px;
        }

        .mastery-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--bg-elevated);
        }

        .mastery-dot.filled {
            background: var(--success);
        }

        /* Create Deck Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
            backdrop-filter: blur(4px);
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 28px;
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalIn 0.3s ease;
        }

        @keyframes modalIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        .modal-title {
            font-size: 1.3em;
            font-weight: 700;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            font-size: 0.85em;
            font-weight: 600;
            margin-bottom: 6px;
            color: var(--text-secondary);
        }

        .form-input, .form-textarea, .form-select {
            width: 100%;
            padding: 10px 14px;
            background: var(--bg-elevated);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text);
            font-family: 'Inter', sans-serif;
            font-size: 0.9em;
            transition: border-color 0.3s;
        }

        .form-input:focus, .form-textarea:focus, .form-select:focus {
            outline: none;
            border-color: var(--primary);
        }

        .form-textarea {
            min-height: 80px;
            resize: vertical;
        }

        .form-select {
            cursor: pointer;
        }

        .form-select option {
            background: var(--bg-card);
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }

        /* Session Complete */
        .session-complete {
            text-align: center;
            padding: 40px 20px;
        }

        .session-complete-icon {
            font-size: 4em;
            margin-bottom: 16px;
        }

        .session-complete h2 {
            font-size: 1.5em;
            margin-bottom: 8px;
        }

        .session-complete p {
            color: var(--text-secondary);
            margin-bottom: 24px;
        }

        .session-stats {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }

        .session-stat {
            text-align: center;
        }

        .session-stat-value {
            font-size: 1.8em;
            font-weight: 800;
            color: var(--primary-light);
        }

        .session-stat-label {
            font-size: 0.8em;
            color: var(--text-secondary);
        }

        /* Streak calendar */
        .streak-section {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .streak-title {
            font-weight: 700;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .streak-days {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }

        .streak-day {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            background: var(--bg-elevated);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7em;
            color: var(--text-secondary);
        }

        .streak-day.active {
            background: var(--primary);
            color: white;
        }

        .streak-day.today {
            border: 2px solid var(--secondary);
        }

        /* Empty state */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .empty-state-icon {
            font-size: 3em;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 3px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .app-container {
                padding: 10px;
            }

            .header {
                padding: 12px 16px;
            }

            .logo {
                font-size: 1.1em;
            }

            .flashcard-container {
                height: 280px;
            }

            .flashcard-word {
                font-size: 1.6em;
            }

            .flashcard-translation {
                font-size: 1.4em;
            }

            .rating-buttons {
                gap: 6px;
            }

            .rating-btn {
                padding: 10px 14px;
                min-width: 75px;
                font-size: 0.8em;
            }

            .word-item {
                flex-wrap: wrap;
                gap: 4px;
            }

            .word-english {
                min-width: 120px;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 480px) {
            .header-stats {
                width: 100%;
                justify-content: center;
            }

            .nav-tabs {
                gap: 6px;
            }

            .nav-tab {
                padding: 8px 14px;
                font-size: 0.8em;
            }

            .decks-grid {
                grid-template-columns: 1fr;
            }

            .flashcard-container {
                height: 260px;
            }
        }

        /* Landscape adjustments */
        @media (orientation: landscape) and (max-height: 500px) {
            .flashcard-container {
                height: 220px;
            }

            .flashcard-word {
                font-size: 1.4em;
            }

            .flashcard-translation {
                font-size: 1.2em;
            }

            .study-area {
                padding: 10px 0;
            }

            .rating-buttons {
                margin-bottom: 10px;
            }
        }

        /* Toast notification */
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--bg-elevated);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 12px 24px;
            font-size: 0.9em;
            font-weight: 500;
            z-index: 2000;
            transition: transform 0.3s ease;
            box-shadow: 0 8px 30px var(--shadow);
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
        }

        /* Delete button */
        .delete-deck-btn {
            position: absolute;
            top: 12px;
            right: 12px;
            width: 28px;
            height: 28px;
            border-radius: 8px;
            border: none;
            background: rgba(225, 112, 85, 0.2);
            color: var(--danger);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9em;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 5;
        }

        .deck-card:hover .delete-deck-btn {
            opacity: 1;
        }

        .delete-deck-btn:hover {
            background: var(--danger);
            color: white;
        }

        /* Card add form in study */
        .add-card-inline {
            width: 100%;
            max-width: 500px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .no-cards-msg {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
        }

        .no-cards-msg .emoji {
            font-size: 3em;
            margin-bottom: 12px;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <div class="header">
            <div class="logo">
                <div class="logo-icon">üìö</div>
                <span class="logo-text">FlashLearn</span>
            </div>
            <div class="header-stats">
                <div class="stat-badge">
                    <span class="stat-icon">üî•</span>
                    <span>–°–µ—Ä—ñ—è:</span>
                    <span class="stat-value" id="streakCount">0</span>
                </div>
                <div class="stat-badge">
                    <span class="stat-icon">üìñ</span>
                    <span>–í–∏–≤—á–µ–Ω–æ:</span>
                    <span class="stat-value" id="learnedCount">0</span>
                </div>
                <div class="stat-badge">
                    <span class="stat-icon">‚≠ê</span>
                    <span>–°—å–æ–≥–æ–¥–Ω—ñ:</span>
                    <span class="stat-value" id="todayCount">0</span>
                </div>
            </div>
        </div>

        <!-- Navigation -->
        <div class="nav-tabs">
            <div class="nav-tab active" data-page="decks">üìö –ö–æ–ª–æ–¥–∏</div>
            <div class="nav-tab" data-page="study">üéØ –ù–∞–≤—á–∞–Ω–Ω—è</div>
            <div class="nav-tab" data-page="words">üìù –°–ª–æ–≤–∞</div>
            <div class="nav-tab" data-page="stats">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
        </div>

        <!-- Decks Page -->
        <div class="page active" id="page-decks">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;flex-wrap:wrap;gap:10px;">
                <h2>üìö –ú–æ—ó –∫–æ–ª–æ–¥–∏</h2>
                <button class="btn btn-primary" onclick="showCreateDeckModal()">
                    ‚ûï –ù–æ–≤–∞ –∫–æ–ª–æ–¥–∞
                </button>
            </div>
            <div class="decks-grid" id="decksGrid"></div>
        </div>

        <!-- Study Page -->
        <div class="page" id="page-study">
            <div id="studyContent"></div>
        </div>

        <!-- Words Page -->
        <div class="page" id="page-words">
            <div class="word-list">
                <div class="word-list-header">
                    <div class="word-list-title">üìù –í—Å—ñ —Å–ª–æ–≤–∞</div>
                    <div class="filter-group">
                        <button class="filter-btn active" data-filter="all">–í—Å—ñ</button>
                        <button class="filter-btn" data-filter="b1">B1</button>
                        <button class="filter-btn" data-filter="b2">B2</button>
                        <button class="filter-btn" data-filter="c1">C1</button>
                    </div>
                </div>
                <div id="wordListContent"></div>
            </div>
        </div>

        <!-- Stats Page -->
        <div class="page" id="page-stats">
            <h2 style="margin-bottom:16px;">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
            <div class="stats-grid" id="statsGrid"></div>
            <div class="streak-section">
                <div class="streak-title">üî• –°–µ—Ä—ñ—è –Ω–∞–≤—á–∞–Ω–Ω—è</div>
                <div class="streak-days" id="streakDays"></div>
            </div>
            <div class="word-list" style="margin-top:20px;">
                <div class="word-list-header">
                    <div class="word-list-title">üèÜ –ü—Ä–æ–≥—Ä–µ—Å –ø–æ —Ä—ñ–≤–Ω—è—Ö</div>
                </div>
                <div id="levelProgress"></div>
            </div>
        </div>
    </div>

    <!-- Create Deck Modal -->
    <div class="modal-overlay" id="createDeckModal">
        <div class="modal">
            <div class="modal-title">üìö –°—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤—É –∫–æ–ª–æ–¥—É</div>
            <div class="form-group">
                <label class="form-label">–ù–∞–∑–≤–∞ –∫–æ–ª–æ–¥–∏</label>
                <input type="text" class="form-input" id="deckName" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: –ë—ñ–∑–Ω–µ—Å –ª–µ–∫—Å–∏–∫–∞">
            </div>
            <div class="form-group">
                <label class="form-label">–û–ø–∏—Å</label>
                <textarea class="form-textarea" id="deckDescription" placeholder="–û–ø–∏—Å –∫–æ–ª–æ–¥–∏..."></textarea>
            </div>
            <div class="form-group">
                <label class="form-label">–†—ñ–≤–µ–Ω—å</label>
                <select class="form-select" id="deckLevel">
                    <option value="b1">B1 - –°–µ—Ä–µ–¥–Ω—ñ–π</option>
                    <option value="b2">B2 - –í–∏—â–µ —Å–µ—Ä–µ–¥–Ω—å–æ–≥–æ</option>
                    <option value="c1">C1 - –ü—Ä–æ—Å—É–Ω—É—Ç–∏–π</option>
                    <option value="custom">–í–ª–∞—Å–Ω–∏–π</option>
                </select>
            </div>
            <div id="customCardsSection">
                <div class="form-group">
                    <label class="form-label">–ö–∞—Ä—Ç–∫–∏ (–æ–¥–Ω–∞ –Ω–∞ —Ä—è–¥–æ–∫: –∞–Ω–≥–ª—ñ–π—Å—å–∫–∞ | –ø–µ—Ä–µ–∫–ª–∞–¥)</label>
                    <textarea class="form-textarea" id="deckCards" rows="6" placeholder="hello | –ø—Ä–∏–≤—ñ—Ç&#10;world | —Å–≤—ñ—Ç&#10;book | –∫–Ω–∏–≥–∞"></textarea>
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeCreateDeckModal()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
                <button class="btn btn-primary" onclick="createDeck()">–°—Ç–≤–æ—Ä–∏—Ç–∏</button>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <script>
        // ==================== DATA ====================
        const defaultWords = [
            // B1 - 50 words
            { en: "achieve", ua: "–¥–æ—Å—è–≥–∞—Ç–∏", level: "b1", example: "She achieved her goal." },
            { en: "advantage", ua: "–ø–µ—Ä–µ–≤–∞–≥–∞", level: "b1", example: "This gives us an advantage." },
            { en: "afford", ua: "–¥–æ–∑–≤–æ–ª–∏—Ç–∏ —Å–æ–±—ñ", level: "b1", example: "I can't afford a new car." },
            { en: "ancient", ua: "—Å—Ç–∞—Ä–æ–¥–∞–≤–Ω—ñ–π", level: "b1", example: "An ancient civilization." },
            { en: "approach", ua: "–ø—ñ–¥—Ö—ñ–¥, –Ω–∞–±–ª–∏–∂–∞—Ç–∏—Å—è", level: "b1", example: "We need a new approach." },
            { en: "attempt", ua: "—Å–ø—Ä–æ–±–∞, –Ω–∞–º–∞–≥–∞—Ç–∏—Å—è", level: "b1", example: "He attempted to climb the wall." },
            { en: "audience", ua: "–∞—É–¥–∏—Ç–æ—Ä—ñ—è", level: "b1", example: "The audience applauded." },
            { en: "behavior", ua: "–ø–æ–≤–µ–¥—ñ–Ω–∫–∞", level: "b1", example: "His behavior was strange." },
            { en: "benefit", ua: "–∫–æ—Ä–∏—Å—Ç—å, –≤–∏–≥–æ–¥–∞", level: "b1", example: "Exercise has many benefits." },
            { en: "border", ua: "–∫–æ—Ä–¥–æ–Ω", level: "b1", example: "We crossed the border." },
            { en: "celebrate", ua: "—Å–≤—è—Ç–∫—É–≤–∞—Ç–∏", level: "b1", example: "Let's celebrate your birthday!" },
            { en: "challenge", ua: "–≤–∏–∫–ª–∏–∫, –≤–∏–ø—Ä–æ–±—É–≤–∞–Ω–Ω—è", level: "b1", example: "It was a big challenge." },
            { en: "comfortable", ua: "–∑—Ä—É—á–Ω–∏–π", level: "b1", example: "This chair is comfortable." },
            { en: "communicate", ua: "—Å–ø—ñ–ª–∫—É–≤–∞—Ç–∏—Å—è", level: "b1", example: "We communicate by email." },
            { en: "community", ua: "—Å–ø—ñ–ª—å–Ω–æ—Ç–∞", level: "b1", example: "A strong community." },
            { en: "compare", ua: "–ø–æ—Ä—ñ–≤–Ω—é–≤–∞—Ç–∏", level: "b1", example: "Compare these two options." },
            { en: "complaint", ua: "—Å–∫–∞—Ä–≥–∞", level: "b1", example: "I have a complaint." },
            { en: "confident", ua: "–≤–ø–µ–≤–Ω–µ–Ω–∏–π", level: "b1", example: "She felt confident." },
            { en: "consider", ua: "—Ä–æ–∑–≥–ª—è–¥–∞—Ç–∏", level: "b1", example: "Consider all the options." },
            { en: "contain", ua: "–º—ñ—Å—Ç–∏—Ç–∏", level: "b1", example: "This box contains books." },
            { en: "contribute", ua: "—Å–ø—Ä–∏—è—Ç–∏, —Ä–æ–±–∏—Ç–∏ –≤–Ω–µ—Å–æ–∫", level: "b1", example: "Everyone should contribute." },
            { en: "convince", ua: "–ø–µ—Ä–µ–∫–æ–Ω—É–≤–∞—Ç–∏", level: "b1", example: "He convinced me to go." },
            { en: "courage", ua: "–º—É–∂–Ω—ñ—Å—Ç—å, —Å–º—ñ–ª–∏–≤—ñ—Å—Ç—å", level: "b1", example: "It takes courage to speak up." },
            { en: "curious", ua: "–¥–æ–ø–∏—Ç–ª–∏–≤–∏–π", level: "b1", example: "Children are naturally curious." },
            { en: "damage", ua: "–ø–æ—à–∫–æ–¥–∂–µ–Ω–Ω—è, —à–∫–æ–¥–∞", level: "b1", example: "The storm caused damage." },
            { en: "decrease", ua: "–∑–º–µ–Ω—à—É–≤–∞—Ç–∏(—Å—è)", level: "b1", example: "Sales decreased last month." },
            { en: "deliver", ua: "–¥–æ—Å—Ç–∞–≤–ª—è—Ç–∏", level: "b1", example: "They deliver packages daily." },
            { en: "demand", ua: "–≤–∏–º–æ–≥–∞, –ø–æ–ø–∏—Ç", level: "b1", example: "There is high demand." },
            { en: "depend", ua: "–∑–∞–ª–µ–∂–∞—Ç–∏", level: "b1", example: "It depends on the weather." },
            { en: "describe", ua: "–æ–ø–∏—Å—É–≤–∞—Ç–∏", level: "b1", example: "Describe what you see." },
            { en: "despite", ua: "–Ω–µ–∑–≤–∞–∂–∞—é—á–∏ –Ω–∞", level: "b1", example: "Despite the rain, we went out." },
            { en: "develop", ua: "—Ä–æ–∑–≤–∏–≤–∞—Ç–∏", level: "b1", example: "We need to develop new skills." },
            { en: "disappointed", ua: "—Ä–æ–∑—á–∞—Ä–æ–≤–∞–Ω–∏–π", level: "b1", example: "I was disappointed." },
            { en: "discover", ua: "–≤—ñ–¥–∫—Ä–∏–≤–∞—Ç–∏", level: "b1", example: "They discovered a new species." },
            { en: "distance", ua: "–≤—ñ–¥—Å—Ç–∞–Ω—å", level: "b1", example: "The distance is 10 km." },
            { en: "encourage", ua: "–∑–∞–æ—Ö–æ—á—É–≤–∞—Ç–∏", level: "b1", example: "Teachers encourage students." },
            { en: "enormous", ua: "–≤–µ–ª–∏—á–µ–∑–Ω–∏–π", level: "b1", example: "An enormous building." },
            { en: "environment", ua: "—Å–µ—Ä–µ–¥–æ–≤–∏—â–µ, –¥–æ–≤–∫—ñ–ª–ª—è", level: "b1", example: "Protect the environment." },
            { en: "equipment", ua: "–æ–±–ª–∞–¥–Ω–∞–Ω–Ω—è", level: "b1", example: "Sports equipment." },
            { en: "essential", ua: "–Ω–µ–æ–±—Ö—ñ–¥–Ω–∏–π, —Å—É—Ç—Ç—î–≤–∏–π", level: "b1", example: "Water is essential for life." },
            { en: "establish", ua: "–∑–∞—Å–Ω–æ–≤—É–≤–∞—Ç–∏", level: "b1", example: "The company was established in 1990." },
            { en: "evidence", ua: "–¥–æ–∫–∞–∑", level: "b1", example: "There is no evidence." },
            { en: "excellent", ua: "—á—É–¥–æ–≤–∏–π", level: "b1", example: "Excellent work!" },
            { en: "exchange", ua: "–æ–±–º—ñ–Ω, –æ–±–º—ñ–Ω—é–≤–∞—Ç–∏", level: "b1", example: "Let's exchange phone numbers." },
            { en: "experience", ua: "–¥–æ—Å–≤—ñ–¥", level: "b1", example: "She has a lot of experience." },
            { en: "experiment", ua: "–µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç", level: "b1", example: "A scientific experiment." },
            { en: "familiar", ua: "–∑–Ω–∞–π–æ–º–∏–π", level: "b1", example: "This place looks familiar." },
            { en: "feature", ua: "–æ—Å–æ–±–ª–∏–≤—ñ—Å—Ç—å, —Ä–∏—Å–∞", level: "b1", example: "A key feature of the product." },
            { en: "generous", ua: "—â–µ–¥—Ä–∏–π", level: "b1", example: "She is very generous." },
            { en: "grateful", ua: "–≤–¥—è—á–Ω–∏–π", level: "b1", example: "I'm grateful for your help." },

            // B2 - 50 words
            { en: "abandon", ua: "–∑–∞–ª–∏—à–∞—Ç–∏, –ø–æ–∫–∏–¥–∞—Ç–∏", level: "b2", example: "They abandoned the project." },
            { en: "abstract", ua: "–∞–±—Å—Ç—Ä–∞–∫—Ç–Ω–∏–π", level: "b2", example: "An abstract concept." },
            { en: "accommodate", ua: "–≤–º—ñ—â—É–≤–∞—Ç–∏, –ø—Ä–∏—Å—Ç–æ—Å–æ–≤—É–≤–∞—Ç–∏", level: "b2", example: "The hotel can accommodate 200 guests." },
            { en: "accumulate", ua: "–Ω–∞–∫–æ–ø–∏—á—É–≤–∞—Ç–∏", level: "b2", example: "Dust accumulates quickly." },
            { en: "acknowledge", ua: "–≤–∏–∑–Ω–∞–≤–∞—Ç–∏", level: "b2", example: "He acknowledged his mistake." },
            { en: "adequate", ua: "–¥–æ—Å—Ç–∞—Ç–Ω—ñ–π, –Ω–∞–ª–µ–∂–Ω–∏–π", level: "b2", example: "Adequate preparation is needed." },
            { en: "advocate", ua: "–∑–∞—Ö–∏—Å–Ω–∏–∫, –≤–∏—Å—Ç—É–ø–∞—Ç–∏ –∑–∞", level: "b2", example: "She advocates for human rights." },
            { en: "allocate", ua: "—Ä–æ–∑–ø–æ–¥—ñ–ª—è—Ç–∏, –≤–∏–¥—ñ–ª—è—Ç–∏", level: "b2", example: "Allocate resources wisely." },
            { en: "ambiguous", ua: "–Ω–µ–æ–¥–Ω–æ–∑–Ω–∞—á–Ω–∏–π", level: "b2", example: "An ambiguous statement." },
            { en: "anticipate", ua: "–ø–µ—Ä–µ–¥–±–∞—á–∞—Ç–∏, –æ—á—ñ–∫—É–≤–∞—Ç–∏", level: "b2", example: "We anticipate growth next year." },
            { en: "apparent", ua: "–æ—á–µ–≤–∏–¥–Ω–∏–π", level: "b2", example: "The reason was apparent." },
            { en: "arbitrary", ua: "–¥–æ–≤—ñ–ª—å–Ω–∏–π", level: "b2", example: "An arbitrary decision." },
            { en: "assess", ua: "–æ—Ü—ñ–Ω—é–≤–∞—Ç–∏", level: "b2", example: "Assess the situation carefully." },
            { en: "assumption", ua: "–ø—Ä–∏–ø—É—â–µ–Ω–Ω—è", level: "b2", example: "That's a wrong assumption." },
            { en: "bias", ua: "—É–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è", level: "b2", example: "Media bias is a problem." },
            { en: "breakthrough", ua: "–ø—Ä–æ—Ä–∏–≤", level: "b2", example: "A scientific breakthrough." },
            { en: "bureaucracy", ua: "–±—é—Ä–æ–∫—Ä–∞—Ç—ñ—è", level: "b2", example: "Too much bureaucracy." },
            { en: "circumstance", ua: "–æ–±—Å—Ç–∞–≤–∏–Ω–∞", level: "b2", example: "Under these circumstances." },
            { en: "coincidence", ua: "–∑–±—ñ–≥, –≤–∏–ø–∞–¥–∫–æ–≤—ñ—Å—Ç—å", level: "b2", example: "What a coincidence!" },
            { en: "comprehensive", ua: "–≤—Å–µ–±—ñ—á–Ω–∏–π, –≤–∏—á–µ—Ä–ø–Ω–∏–π", level: "b2", example: "A comprehensive report." },
            { en: "compromise", ua: "–∫–æ–º–ø—Ä–æ–º—ñ—Å", level: "b2", example: "We reached a compromise." },
            { en: "consequence", ua: "–Ω–∞—Å–ª—ñ–¥–æ–∫", level: "b2", example: "Face the consequences." },
            { en: "controversy", ua: "—Å—É–ø–µ—Ä–µ—á–∫–∞, –ø–æ–ª–µ–º—ñ–∫–∞", level: "b2", example: "The decision caused controversy." },
            { en: "crucial", ua: "–≤–∏—Ä—ñ—à–∞–ª—å–Ω–∏–π, –∫–ª—é—á–æ–≤–∏–π", level: "b2", example: "A crucial moment." },
            { en: "deliberate", ua: "–Ω–∞–≤–º–∏—Å–Ω–∏–π, –æ–±–¥—É–º–∞–Ω–∏–π", level: "b2", example: "It was a deliberate act." },
            { en: "deteriorate", ua: "–ø–æ–≥—ñ—Ä—à—É–≤–∞—Ç–∏—Å—è", level: "b2", example: "His health deteriorated." },
            { en: "dilemma", ua: "–¥–∏–ª–µ–º–∞", level: "b2", example: "A moral dilemma." },
            { en: "diminish", ua: "–∑–º–µ–Ω—à—É–≤–∞—Ç–∏(—Å—è)", level: "b2", example: "His influence diminished." },
            { en: "disrupt", ua: "–ø–æ—Ä—É—à—É–≤–∞—Ç–∏, –∑—Ä–∏–≤–∞—Ç–∏", level: "b2", example: "The protest disrupted traffic." },
            { en: "elaborate", ua: "–¥–µ—Ç–∞–ª—å–Ω–∏–π, —Ä–æ–∑—Ä–æ–±–ª—è—Ç–∏", level: "b2", example: "Please elaborate on this." },
            { en: "eliminate", ua: "—É—Å—É–≤–∞—Ç–∏, –ª—ñ–∫–≤—ñ–¥—É–≤–∞—Ç–∏", level: "b2", example: "Eliminate all errors." },
            { en: "embrace", ua: "–æ–±—ñ–π–º–∞—Ç–∏, –ø—Ä–∏–π–º–∞—Ç–∏", level: "b2", example: "Embrace new technology." },
            { en: "emerge", ua: "–∑'—è–≤–ª—è—Ç–∏—Å—è, –≤–∏–Ω–∏–∫–∞—Ç–∏", level: "b2", example: "New trends are emerging." },
            { en: "emphasize", ua: "–Ω–∞–≥–æ–ª–æ—à—É–≤–∞—Ç–∏", level: "b2", example: "I want to emphasize this point." },
            { en: "encounter", ua: "–∑—É—Å—Ç—Ä—ñ—á–∞—Ç–∏, —Å—Ç–∏–∫–∞—Ç–∏—Å—è", level: "b2", example: "We encountered a problem." },
            { en: "enhance", ua: "–ø–æ–∫—Ä–∞—â—É–≤–∞—Ç–∏, –ø–æ—Å–∏–ª—é–≤–∞—Ç–∏", level: "b2", example: "Enhance your skills." },
            { en: "exploit", ua: "–µ–∫—Å–ø–ª—É–∞—Ç—É–≤–∞—Ç–∏, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏", level: "b2", example: "Don't exploit others." },
            { en: "fluctuate", ua: "–∫–æ–ª–∏–≤–∞—Ç–∏—Å—è", level: "b2", example: "Prices fluctuate daily." },
            { en: "fundamental", ua: "–æ—Å–Ω–æ–≤–æ–ø–æ–ª–æ–∂–Ω–∏–π", level: "b2", example: "A fundamental principle." },
            { en: "genuine", ua: "—Å–ø—Ä–∞–≤–∂–Ω—ñ–π, —â–∏—Ä–∏–π", level: "b2", example: "A genuine smile." },
            { en: "hypothesis", ua: "–≥—ñ–ø–æ—Ç–µ–∑–∞", level: "b2", example: "Test the hypothesis." },
            { en: "implement", ua: "–≤–ø—Ä–æ–≤–∞–¥–∂—É–≤–∞—Ç–∏", level: "b2", example: "Implement the new policy." },
            { en: "implication", ua: "–Ω–∞—Å–ª—ñ–¥–æ–∫, –ø—ñ–¥—Ç–µ–∫—Å—Ç", level: "b2", example: "Consider the implications." },
            { en: "inevitable", ua: "–Ω–µ–º–∏–Ω—É—á–∏–π", level: "b2", example: "Change is inevitable." },
            { en: "infrastructure", ua: "—ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞", level: "b2", example: "Improve the infrastructure." },
            { en: "initiative", ua: "—ñ–Ω—ñ—Ü—ñ–∞—Ç–∏–≤–∞", level: "b2", example: "Take the initiative." },
            { en: "innovation", ua: "—ñ–Ω–Ω–æ–≤–∞—Ü—ñ—è", level: "b2", example: "Technological innovation." },
            { en: "integrate", ua: "—ñ–Ω—Ç–µ–≥—Ä—É–≤–∞—Ç–∏", level: "b2", example: "Integrate new members." },
            { en: "interpret", ua: "—Ç–ª—É–º–∞—á–∏—Ç–∏, —ñ–Ω—Ç–µ—Ä–ø—Ä–µ—Ç—É–≤–∞—Ç–∏", level: "b2", example: "How do you interpret this?" },
            { en: "justify", ua: "–≤–∏–ø—Ä–∞–≤–¥–æ–≤—É–≤–∞—Ç–∏", level: "b2", example: "Justify your decision." },

            // C1 - 50 words
            { en: "abolish", ua: "—Å–∫–∞—Å–æ–≤—É–≤–∞—Ç–∏", level: "c1", example: "Abolish outdated laws." },
            { en: "abstain", ua: "—É—Ç—Ä–∏–º—É–≤–∞—Ç–∏—Å—è", level: "c1", example: "Abstain from voting." },
            { en: "accentuate", ua: "–ø—ñ–¥–∫—Ä–µ—Å–ª—é–≤–∞—Ç–∏, –∞–∫—Ü–µ–Ω—Ç—É–≤–∞—Ç–∏", level: "c1", example: "Accentuate the positive." },
            { en: "acquaint", ua: "–æ–∑–Ω–∞–π–æ–º–ª—é–≤–∞—Ç–∏", level: "c1", example: "Acquaint yourself with the rules." },
            { en: "adversity", ua: "–Ω–µ–≥–∞—Ä–∞–∑–¥–∏, —Ç—Ä—É–¥–Ω–æ—â—ñ", level: "c1", example: "Overcome adversity." },
            { en: "alleviate", ua: "–ø–æ–ª–µ–≥—à—É–≤–∞—Ç–∏, –ø–æ–º'—è–∫—à—É–≤–∞—Ç–∏", level: "c1", example: "Alleviate the pain." },
            { en: "amalgamate", ua: "–æ–±'—î–¥–Ω—É–≤–∞—Ç–∏, –∑–ª–∏–≤–∞—Ç–∏", level: "c1", example: "The companies amalgamated." },
            { en: "ambivalent", ua: "–∞–º–±—ñ–≤–∞–ª–µ–Ω—Ç–Ω–∏–π, —Å—É–ø–µ—Ä–µ—á–ª–∏–≤–∏–π", level: "c1", example: "She felt ambivalent about it." },
            { en: "analogous", ua: "–∞–Ω–∞–ª–æ–≥—ñ—á–Ω–∏–π", level: "c1", example: "An analogous situation." },
            { en: "annihilate", ua: "–∑–Ω–∏—â—É–≤–∞—Ç–∏", level: "c1", example: "The army was annihilated." },
            { en: "articulate", ua: "—á—ñ—Ç–∫–æ –≤–∏—Å–ª–æ–≤–ª—é–≤–∞—Ç–∏", level: "c1", example: "Articulate your thoughts." },
            { en: "ascertain", ua: "–∑'—è—Å–æ–≤—É–≤–∞—Ç–∏, –≤—Å—Ç–∞–Ω–æ–≤–ª—é–≤–∞—Ç–∏", level: "c1", example: "Ascertain the facts." },
            { en: "benevolent", ua: "–¥–æ–±—Ä–æ–∑–∏—á–ª–∏–≤–∏–π", level: "c1", example: "A benevolent leader." },
            { en: "candid", ua: "–≤—ñ–¥–≤–µ—Ä—Ç–∏–π, —â–∏—Ä–∏–π", level: "c1", example: "A candid conversation." },
            { en: "coerce", ua: "–ø—Ä–∏–º—É—à—É–≤–∞—Ç–∏", level: "c1", example: "He was coerced into signing." },
            { en: "complacent", ua: "—Å–∞–º–æ–≤–¥–æ–≤–æ–ª–µ–Ω–∏–π", level: "c1", example: "Don't become complacent." },
            { en: "conceive", ua: "—É—è–≤–ª—è—Ç–∏, –∑–∞–¥—É–º—É–≤–∞—Ç–∏", level: "c1", example: "I can't conceive of such a thing." },
            { en: "condone", ua: "–ø–æ—Ç—É—Ä–∞—Ç–∏, –º–æ–≤—á–∞–∑–Ω–æ —Å—Ö–≤–∞–ª—é–≤–∞—Ç–∏", level: "c1", example: "We cannot condone violence." },
            { en: "conjecture", ua: "–ø—Ä–∏–ø—É—â–µ–Ω–Ω—è, –∑–¥–æ–≥–∞–¥–∫–∞", level: "c1", example: "That's mere conjecture." },
            { en: "consolidate", ua: "–∑–º—ñ—Ü–Ω—é–≤–∞—Ç–∏, –∫–æ–Ω—Å–æ–ª—ñ–¥—É–≤–∞—Ç–∏", level: "c1", example: "Consolidate your position." },
            { en: "contemplate", ua: "—Å–ø–æ–≥–ª—è–¥–∞—Ç–∏, –æ–±–º—ñ—Ä–∫–æ–≤—É–≤–∞—Ç–∏", level: "c1", example: "Contemplate the future." },
            { en: "corroborate", ua: "–ø—ñ–¥—Ç–≤–µ—Ä–¥–∂—É–≤–∞—Ç–∏", level: "c1", example: "Evidence corroborates the theory." },
            { en: "culminate", ua: "–∑–∞–≤–µ—Ä—à—É–≤–∞—Ç–∏—Å—è, –¥–æ—Å—è–≥–∞—Ç–∏ –∫—É–ª—å–º—ñ–Ω–∞—Ü—ñ—ó", level: "c1", example: "The event culminated in a concert." },
            { en: "debilitate", ua: "–æ—Å–ª–∞–±–ª—é–≤–∞—Ç–∏, –≤–∏—Å–Ω–∞–∂—É–≤–∞—Ç–∏", level: "c1", example: "A debilitating illness." },
            { en: "decipher", ua: "—Ä–æ–∑—à–∏—Ñ—Ä–æ–≤—É–≤–∞—Ç–∏", level: "c1", example: "Decipher the ancient text." },
            { en: "delineate", ua: "–æ–∫—Ä–µ—Å–ª—é–≤–∞—Ç–∏, –≤–∏–∑–Ω–∞—á–∞—Ç–∏", level: "c1", example: "Delineate the boundaries." },
            { en: "denounce", ua: "–∑–∞—Å—É–¥–∂—É–≤–∞—Ç–∏, –≤–∏–∫—Ä–∏–≤–∞—Ç–∏", level: "c1", example: "Denounce corruption." },
            { en: "deplete", ua: "–≤–∏—Å–Ω–∞–∂—É–≤–∞—Ç–∏, –≤–∏—á–µ—Ä–ø—É–≤–∞—Ç–∏", level: "c1", example: "Natural resources are depleted." },
            { en: "detrimental", ua: "—à–∫—ñ–¥–ª–∏–≤–∏–π, –∑–≥—É–±–Ω–∏–π", level: "c1", example: "Detrimental to health." },
            { en: "discrepancy", ua: "—Ä–æ–∑–±—ñ–∂–Ω—ñ—Å—Ç—å, –Ω–µ–≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—Å—Ç—å", level: "c1", example: "A discrepancy in the data." },
            { en: "disseminate", ua: "–ø–æ—à–∏—Ä—é–≤–∞—Ç–∏, —Ä–æ–∑–ø–æ–≤—Å—é–¥–∂—É–≤–∞—Ç–∏", level: "c1", example: "Disseminate information." },
            { en: "elicit", ua: "–≤–∏–∫–ª–∏–∫–∞—Ç–∏, –≤–∏—è–≤–ª—è—Ç–∏", level: "c1", example: "Elicit a response." },
            { en: "eloquent", ua: "–∫—Ä–∞—Å–Ω–æ–º–æ–≤–Ω–∏–π", level: "c1", example: "An eloquent speech." },
            { en: "emancipate", ua: "–µ–º–∞–Ω—Å–∏–ø—É–≤–∞—Ç–∏, –∑–≤—ñ–ª—å–Ω—è—Ç–∏", level: "c1", example: "Emancipate from oppression." },
            { en: "empirical", ua: "–µ–º–ø—ñ—Ä–∏—á–Ω–∏–π, –¥–æ—Å–ª—ñ–¥–Ω–∏–π", level: "c1", example: "Empirical evidence." },
            { en: "encompass", ua: "–æ—Ö–æ–ø–ª—é–≤–∞—Ç–∏, –≤–∫–ª—é—á–∞—Ç–∏", level: "c1", example: "The study encompasses many topics." },
            { en: "endorse", ua: "–ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞—Ç–∏, —Å—Ö–≤–∞–ª—é–≤–∞—Ç–∏", level: "c1", example: "Endorse the candidate." },
            { en: "enigmatic", ua: "–∑–∞–≥–∞–¥–∫–æ–≤–∏–π", level: "c1", example: "An enigmatic smile." },
            { en: "epitomize", ua: "–±—É—Ç–∏ –≤—Ç—ñ–ª–µ–Ω–Ω—è–º, —É–æ—Å–æ–±–ª—é–≤–∞—Ç–∏", level: "c1", example: "She epitomizes elegance." },
            { en: "exacerbate", ua: "–∑–∞–≥–æ—Å—Ç—Ä—é–≤–∞—Ç–∏, –ø–æ–≥—ñ—Ä—à—É–≤–∞—Ç–∏", level: "c1", example: "Don't exacerbate the problem." },
            { en: "exemplify", ua: "–±—É—Ç–∏ –ø—Ä–∏–∫–ª–∞–¥–æ–º, —ñ–ª—é—Å—Ç—Ä—É–≤–∞—Ç–∏", level: "c1", example: "This exemplifies the issue." },
            { en: "expedite", ua: "–ø—Ä–∏—Å–∫–æ—Ä—é–≤–∞—Ç–∏", level: "c1", example: "Expedite the process." },
            { en: "fabricate", ua: "—Ñ–∞–±—Ä–∏–∫—É–≤–∞—Ç–∏, –≤–∏–≥–∞–¥—É–≤–∞—Ç–∏", level: "c1", example: "Fabricate evidence." },
            { en: "formidable", ua: "–≥—Ä—ñ–∑–Ω–∏–π, –∑–Ω–∞—á–Ω–∏–π", level: "c1", example: "A formidable opponent." },
            { en: "futile", ua: "–º–∞—Ä–Ω–∏–π, –¥–∞—Ä–µ–º–Ω–∏–π", level: "c1", example: "A futile attempt." },
            { en: "gregarious", ua: "—Ç–æ–≤–∞—Ä–∏—Å—å–∫–∏–π, –∫–æ–º–ø–∞–Ω—ñ–π—Å—å–∫–∏–π", level: "c1", example: "A gregarious personality." },
            { en: "hinder", ua: "–ø–µ—Ä–µ—à–∫–æ–¥–∂–∞—Ç–∏, –∑–∞–≤–∞–∂–∞—Ç–∏", level: "c1", example: "Don't hinder progress." },
            { en: "imminent", ua: "–Ω–µ–º–∏–Ω—É—á–∏–π, –±–ª–∏–∑—å–∫–∏–π", level: "c1", example: "An imminent threat." },
            { en: "impeccable", ua: "–±–µ–∑–¥–æ–≥–∞–Ω–Ω–∏–π", level: "c1", example: "Impeccable manners." },
            { en: "indispensable", ua: "–Ω–µ–∑–∞–º—ñ–Ω–Ω–∏–π, –Ω–µ–æ–±—Ö—ñ–¥–Ω–∏–π", level: "c1", example: "An indispensable tool." }
        ];

        // ==================== STATE ====================
        let state = {
            decks: [],
            cardProgress: {},  // { wordKey: { interval, easeFactor, repetitions, nextReview, lastReview } }
            studyHistory: [],  // { date, cardsStudied, correct }
            currentDeck: null,
            currentCardIndex: 0,
            sessionStats: { studied: 0, correct: 0, wrong: 0 },
            streak: 0,
            lastStudyDate: null,
            todayStudied: 0
        };

        // ==================== STORAGE ====================
        function saveState() {
            localStorage.setItem('flashlearn_state', JSON.stringify(state));
        }

        function loadState() {
            const saved = localStorage.getItem('flashlearn_state');
            if (saved) {
                try {
                    const parsed = JSON.parse(saved);
                    state = { ...state, ...parsed };
                } catch (e) {
                    console.error('Failed to load state:', e);
                }
            }

            // Initialize default decks if none exist
            if (state.decks.length === 0) {
                initializeDefaultDecks();
            }

            // Update streak
            updateStreak();
            updateTodayCount();
        }

        function initializeDefaultDecks() {
            const b1Words = defaultWords.filter(w => w.level === 'b1');
            const b2Words = defaultWords.filter(w => w.level === 'b2');
            const c1Words = defaultWords.filter(w => w.level === 'c1');

            state.decks = [
                {
                    id: 'b1-default',
                    name: '–ê–Ω–≥–ª—ñ–π—Å—å–∫–∞ B1',
                    description: '–û—Å–Ω–æ–≤–Ω–∞ –ª–µ–∫—Å–∏–∫–∞ —Å–µ—Ä–µ–¥–Ω—å–æ–≥–æ —Ä—ñ–≤–Ω—è. 50 –Ω–∞–π–≤–∞–∂–ª–∏–≤—ñ—à–∏—Ö —Å–ª—ñ–≤ –¥–ª—è –ø–æ–≤—Å—è–∫–¥–µ–Ω–Ω–æ–≥–æ —Å–ø—ñ–ª–∫—É–≤–∞–Ω–Ω—è.',
                    level: 'b1',
                    cards: b1Words.map(w => ({ front: w.en, back: w.ua, example: w.example, level: w.level })),
                    isDefault: true,
                    createdAt: Date.now()
                },
                {
                    id: 'b2-default',
                    name: '–ê–Ω–≥–ª—ñ–π—Å—å–∫–∞ B2',
                    description: '–õ–µ–∫—Å–∏–∫–∞ –≤–∏—â–µ —Å–µ—Ä–µ–¥–Ω—å–æ–≥–æ —Ä—ñ–≤–Ω—è. 50 —Å–ª—ñ–≤ –¥–ª—è –∞–∫–∞–¥–µ–º—ñ—á–Ω–æ–≥–æ —Ç–∞ –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω–æ–≥–æ —Å–ø—ñ–ª–∫—É–≤–∞–Ω–Ω—è.',
                    level: 'b2',
                    cards: b2Words.map(w => ({ front: w.en, back: w.ua, example: w.example, level: w.level })),
                    isDefault: true,
                    createdAt: Date.now()
                },
                {
                    id: 'c1-default',
                    name: '–ê–Ω–≥–ª—ñ–π—Å—å–∫–∞ C1',
                    description: '–ü—Ä–æ—Å—É–Ω—É—Ç–∞ –ª–µ–∫—Å–∏–∫–∞. 50 —Å–∫–ª–∞–¥–Ω–∏—Ö —Å–ª—ñ–≤ –¥–ª—è –≤—ñ–ª—å–Ω–æ–≥–æ –≤–æ–ª–æ–¥—ñ–Ω–Ω—è –º–æ–≤–æ—é.',
                    level: 'c1',
                    cards: c1Words.map(w => ({ front: w.en, back: w.ua, example: w.example, level: w.level })),
                    isDefault: true,
                    createdAt: Date.now()
                }
            ];
            saveState();
        }

        // ==================== SPACED REPETITION ====================
        function getCardProgress(cardKey) {
            if (!state.cardProgress[cardKey]) {
                state.cardProgress[cardKey] = {
                    interval: 0,
                    easeFactor: 2.5,
                    repetitions: 0,
                    nextReview: Date.now(),
                    lastReview: null
                };
            }
            return state.cardProgress[cardKey];
        }

        function updateCardProgress(cardKey, quality) {
            // quality: 0 = again, 1 = hard, 2 = good, 3 = easy
            const progress = getCardProgress(cardKey);
            const now = Date.now();

            // SM-2 algorithm adaptation
            if (quality < 2) {
                // Failed - reset
                progress.repetitions = 0;
                progress.interval = 1;
            } else {
                if (progress.repetitions === 0) {
                    progress.interval = 1;
                } else if (progress.repetitions === 1) {
                    progress.interval = 6;
                } else {
                    progress.interval = Math.round(progress.interval * progress.easeFactor);
                }
                progress.repetitions++;
            }

            // Update ease factor
            const q = quality;
            progress.easeFactor = Math.max(1.3,
                progress.easeFactor + (0.1 - (3 - q) * (0.08 + (3 - q) * 0.02))
            );

            // Adjust interval based on quality
            if (quality === 3) progress.interval = Math.round(progress.interval * 1.3);
            if (quality === 1) progress.interval = Math.max(1, Math.round(progress.interval * 0.6));

            progress.nextReview = now + progress.interval * 24 * 60 * 60 * 1000;
            progress.lastReview = now;

            state.cardProgress[cardKey] = progress;

            // Update stats
            state.sessionStats.studied++;
            if (quality >= 2) state.sessionStats.correct++;
            else state.sessionStats.wrong++;

            state.todayStudied++;
            state.lastStudyDate = new Date().toDateString();

            // Add to history
            const today = new Date().toDateString();
            let todayHistory = state.studyHistory.find(h => h.date === today);
            if (!todayHistory) {
                todayHistory = { date: today, cardsStudied: 0, correct: 0 };
                state.studyHistory.push(todayHistory);
            }
            todayHistory.cardsStudied++;
            if (quality >= 2) todayHistory.correct++;

            saveState();
            updateHeaderStats();
        }

        function getCardsDueForReview(deck) {
            const now = Date.now();
            return deck.cards.filter(card => {
                const key = `${deck.id}_${card.front}`;
                const progress = getCardProgress(key);
                return progress.nextReview <= now;
            });
        }

        function getNewCards(deck) {
            return deck.cards.filter(card => {
                const key = `${deck.id}_${card.front}`;
                return !state.cardProgress[key] || state.cardProgress[key].lastReview === null;
            });
        }

        function getMasteryLevel(cardKey) {
            const progress = state.cardProgress[cardKey];
            if (!progress || progress.lastReview === null) return 0;
            if (progress.repetitions >= 5) return 5;
            return Math.min(5, progress.repetitions);
        }

        // ==================== STREAK ====================
        function updateStreak() {
            const today = new Date().toDateString();
            const yesterday = new Date(Date.now() - 86400000).toDateString();

            if (state.lastStudyDate === today) {
                // Already studied today, streak is current
            } else if (state.lastStudyDate === yesterday) {
                // Studied yesterday, streak continues
            } else if (state.lastStudyDate && state.lastStudyDate !== today) {
                // Missed a day, check how many days ago
                const lastDate = new Date(state.lastStudyDate);
                const diff = Math.floor((Date.now() - lastDate.getTime()) / 86400000);
                if (diff > 1) {
                    state.streak = 0;
                }
            }

            // Calculate streak from history
            let streak = 0;
            const sortedHistory = [...state.studyHistory].sort((a, b) => new Date(b.date) - new Date(a.date));

            for (let i = 0; i < sortedHistory.length; i++) {
                const expectedDate = new Date(Date.now() - i * 86400000).toDateString();
                if (sortedHistory.find(h => h.date === expectedDate)) {
                    streak++;
                } else {
                    break;
                }
            }

            state.streak = streak;
            saveState();
        }

        function updateTodayCount() {
            const today = new Date().toDateString();
            const todayHistory = state.studyHistory.find(h => h.date === today);
            state.todayStudied = todayHistory ? todayHistory.cardsStudied : 0;
        }

        // ==================== UI ====================
        function updateHeaderStats() {
            document.getElementById('streakCount').textContent = state.streak;
            document.getElementById('todayCount').textContent = state.todayStudied;

            // Count learned words (mastery >= 3)
            let learned = 0;
            for (const key in state.cardProgress) {
                if (state.cardProgress[key].repetitions >= 3) learned++;
            }
            document.getElementById('learnedCount').textContent = learned;
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        // ==================== NAVIGATION ====================
        document.querySelectorAll('.nav-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                tab.classList.add('active');
                document.getElementById(`page-${tab.dataset.page}`).classList.add('active');

                // Render page content
                switch (tab.dataset.page) {
                    case 'decks': renderDecks(); break;
                    case 'study': renderStudyPage(); break;
                    case 'words': renderWordList(); break;
                    case 'stats': renderStats(); break;
                }
            });
        });

        // ==================== DECKS PAGE ====================
        function renderDecks() {
            const grid = document.getElementById('decksGrid');
            grid.innerHTML = '';

            state.decks.forEach(deck => {
                const totalCards = deck.cards.length;
                const dueCards = getCardsDueForReview(deck).length;
                const newCards = getNewCards(deck).length;

                let masteredCount = 0;
                deck.cards.forEach(card => {
                    const key = `${deck.id}_${card.front}`;
                    if (getMasteryLevel(key) >= 3) masteredCount++;
                });

                const progress = totalCards > 0 ? Math.round((masteredCount / totalCards) * 100) : 0;

                const levelClass = deck.isDefault ? `level-${deck.level}` : 'custom';

                const el = document.createElement('div');
                el.className = `deck-card ${levelClass}`;
                el.innerHTML = `
                    ${!deck.isDefault ? `<button class="delete-deck-btn" onclick="event.stopPropagation();deleteDeck('${deck.id}')" title="–í–∏–¥–∞–ª–∏—Ç–∏">üóë</button>` : ''}
                    <div class="deck-header">
                        <div class="deck-title">${deck.name}</div>
                        <div class="deck-level">${deck.level.toUpperCase()}</div>
                    </div>
                    <div class="deck-description">${deck.description}</div>
                    <div class="deck-progress">
                        <div class="progress-text">
                            <span>–ü—Ä–æ–≥—Ä–µ—Å: ${progress}%</span>
                            <span>${masteredCount}/${totalCards}</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width:${progress}%"></div>
                        </div>
                    </div>
                    <div class="deck-footer">
                        <div class="deck-count">
                            üìã ${totalCards} –∫–∞—Ä—Ç–æ–∫ ¬∑ üîÑ ${dueCards} –Ω–∞ –ø–æ–≤—Ç–æ—Ä ¬∑ ‚ú® ${newCards} –Ω–æ–≤–∏—Ö
                        </div>
                    </div>
                `;
                el.addEventListener('click', () => startStudy(deck.id));
                grid.appendChild(el);
            });
        }

        // ==================== CREATE DECK ====================
        function showCreateDeckModal() {
            document.getElementById('createDeckModal').classList.add('active');
            document.getElementById('deckName').value = '';
            document.getElementById('deckDescription').value = '';
            document.getElementById('deckCards').value = '';
        }

        function closeCreateDeckModal() {
            document.getElementById('createDeckModal').classList.remove('active');
        }

        function createDeck() {
            const name = document.getElementById('deckName').value.trim();
            const description = document.getElementById('deckDescription').value.trim();
            const level = document.getElementById('deckLevel').value;
            const cardsText = document.getElementById('deckCards').value.trim();

            if (!name) {
                showToast('‚ö†Ô∏è –í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É –∫–æ–ª–æ–¥–∏');
                return;
            }

            const cards = [];
            if (cardsText) {
                cardsText.split('\n').forEach(line => {
                    const parts = line.split('|').map(s => s.trim());
                    if (parts.length >= 2 && parts[0] && parts[1]) {
                        cards.push({
                            front: parts[0],
                            back: parts[1],
                            example: parts[2] || '',
                            level: level
                        });
                    }
                });
            }

            const deck = {
                id: 'custom_' + Date.now(),
                name,
                description: description || '–í–ª–∞—Å–Ω–∞ –∫–æ–ª–æ–¥–∞',
                level,
                cards,
                isDefault: false,
                createdAt: Date.now()
            };

            state.decks.push(deck);
            saveState();
            closeCreateDeckModal();
            renderDecks();
            showToast(`‚úÖ –ö–æ–ª–æ–¥—É "${name}" —Å—Ç–≤–æ—Ä–µ–Ω–æ!`);
        }

        function deleteDeck(deckId) {
            if (confirm('–í–∏–¥–∞–ª–∏—Ç–∏ —Ü—é –∫–æ–ª–æ–¥—É?')) {
                state.decks = state.decks.filter(d => d.id !== deckId);
                // Clean up progress for this deck
                for (const key in state.cardProgress) {
                    if (key.startsWith(deckId + '_')) {
                        delete state.cardProgress[key];
                    }
                }
                saveState();
                renderDecks();
                showToast('üóë –ö–æ–ª–æ–¥—É –≤–∏–¥–∞–ª–µ–Ω–æ');
            }
        }

        // ==================== STUDY PAGE ====================
        let studyQueue = [];
        let currentStudyDeck = null;
        let isFlipped = false;

        function startStudy(deckId) {
            const deck = state.decks.find(d => d.id === deckId);
            if (!deck) return;

            currentStudyDeck = deck;
            state.currentDeck = deckId;
            state.sessionStats = { studied: 0, correct: 0, wrong: 0 };

            // Build study queue: due cards first, then new cards (limit 20 new per session)
            const dueCards = getCardsDueForReview(deck);
            const newCards = getNewCards(deck).slice(0, 20);

            studyQueue = [...dueCards, ...newCards];

            // Shuffle
            for (let i = studyQueue.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [studyQueue[i], studyQueue[j]] = [studyQueue[j], studyQueue[i]];
            }

            state.currentCardIndex = 0;
            isFlipped = false;

            // Switch to study tab
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelector('[data-page="study"]').classList.add('active');
            document.getElementById('page-study').classList.add('active');

            renderStudyPage();
            saveState();
        }

        function renderStudyPage() {
            const content = document.getElementById('studyContent');

            if (!currentStudyDeck) {
                content.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìö</div>
                        <h3>–û–±–µ—Ä—ñ—Ç—å –∫–æ–ª–æ–¥—É –¥–ª—è –Ω–∞–≤—á–∞–Ω–Ω—è</h3>
                        <p style="margin-top:8px;color:var(--text-secondary)">–ü–µ—Ä–µ–π–¥—ñ—Ç—å –Ω–∞ –≤–∫–ª–∞–¥–∫—É "–ö–æ–ª–æ–¥–∏" —Ç–∞ –æ–±–µ—Ä—ñ—Ç—å –∫–æ–ª–æ–¥—É</p>
                        <button class="btn btn-primary" style="margin-top:16px" onclick="document.querySelector('[data-page=decks]').click()">
                            üìö –î–æ –∫–æ–ª–æ–¥
                        </button>
                    </div>
                `;
                return;
            }

            if (studyQueue.length === 0) {
                content.innerHTML = `
                    <div class="no-cards-msg">
                        <div class="emoji">üéâ</div>
                        <h3>–í—Å—ñ –∫–∞—Ä—Ç–∫–∏ –≤–∏–≤—á–µ–Ω—ñ!</h3>
                        <p style="margin-top:8px;color:var(--text-secondary)">–ü–æ–≤–µ—Ä–Ω—ñ—Ç—å—Å—è –ø—ñ–∑–Ω—ñ—à–µ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–µ–Ω–Ω—è</p>
                        <button class="btn btn-primary" style="margin-top:16px" onclick="document.querySelector('[data-page=decks]').click()">
                            üìö –î–æ –∫–æ–ª–æ–¥
                        </button>
                    </div>
                `;
                return;
            }

            if (state.currentCardIndex >= studyQueue.length) {
                renderSessionComplete();
                return;
            }

            const card = studyQueue[state.currentCardIndex];
            const cardKey = `${currentStudyDeck.id}_${card.front}`;
            const mastery = getMasteryLevel(cardKey);
            const progress = getCardProgress(cardKey);
            const isNew = progress.lastReview === null;

            content.innerHTML = `
                <div class="study-area">
                    <div class="study-header">
                        <div>
                            <div class="study-title">${currentStudyDeck.name}</div>
                            <div class="card-counter" style="margin-top:4px;">
                                –ö–∞—Ä—Ç–∫–∞ ${state.currentCardIndex + 1} –∑ ${studyQueue.length}
                                ${isNew ? ' ¬∑ <span style="color:var(--secondary)">‚ú® –ù–æ–≤–∞</span>' : ' ¬∑ <span style="color:var(--primary-light)">üîÑ –ü–æ–≤—Ç–æ—Ä–µ–Ω–Ω—è</span>'}
                            </div>
                        </div>
                        <div style="display:flex;gap:8px;align-items:center;">
                            <div class="mastery-dots" title="–†—ñ–≤–µ–Ω—å –∑–∞—Å–≤–æ—î–Ω–Ω—è: ${mastery}/5">
                                ${[1,2,3,4,5].map(i => `<div class="mastery-dot ${i <= mastery ? 'filled' : ''}"></div>`).join('')}
                            </div>
                            <button class="btn btn-secondary btn-small" onclick="document.querySelector('[data-page=decks]').click()">‚úï</button>
                        </div>
                    </div>

                    <div class="progress-bar" style="width:100%;max-width:500px;margin-bottom:20px;">
                        <div class="progress-fill" style="width:${((state.currentCardIndex) / studyQueue.length) * 100}%"></div>
                    </div>

                    <div class="flashcard-container" onclick="flipCard()">
                        <div class="flashcard ${isFlipped ? 'flipped' : ''}" id="flashcard">
                            <div class="flashcard-face flashcard-front">
                                <div class="flashcard-word">${card.front}</div>
                                ${card.level ? `<div class="flashcard-phonetic">${card.level.toUpperCase()}</div>` : ''}
                                <div class="flip-indicator">üëÜ –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å, —â–æ–± –ø–µ—Ä–µ–≤–µ—Ä–Ω—É—Ç–∏</div>
                            </div>
                            <div class="flashcard-face flashcard-back">
                                <div class="flashcard-translation">${card.back}</div>
                                ${card.example ? `<div class="flashcard-example">"${card.example}"</div>` : ''}
                                <div class="flip-indicator">–û—Ü—ñ–Ω—ñ—Ç—å —Å–≤–æ—é –≤—ñ–¥–ø–æ–≤—ñ–¥—å ‚¨áÔ∏è</div>
                            </div>
                        </div>
                    </div>

                    <div class="rating-buttons" id="ratingButtons" style="display:${isFlipped ? 'flex' : 'none'}">
                        <button class="rating-btn again" onclick="rateCard(0)">
                            üòü –ó–Ω–æ–≤—É
                            <span class="rating-label">&lt; 1 —Ö–≤</span>
                        </button>
                        <button class="rating-btn hard" onclick="rateCard(1)">
                            üòê –í–∞–∂–∫–æ
                            <span class="rating-label">~1 –¥–µ–Ω—å</span>
                        </button>
                        <button class="rating-btn good" onclick="rateCard(2)">
                            üòä –î–æ–±—Ä–µ
                            <span class="rating-label">~${getNextInterval(cardKey, 2)} –¥–Ω</span>
                        </button>
                        <button class="rating-btn easy" onclick="rateCard(3)">
                            ü§© –õ–µ–≥–∫–æ
                            <span class="rating-label">~${getNextInterval(cardKey, 3)} –¥–Ω</span>
                        </button>
                    </div>
                </div>
            `;
        }

        function getNextInterval(cardKey, quality) {
            const progress = { ...getCardProgress(cardKey) };
            if (quality < 2) return 1;
            if (progress.repetitions === 0) return 1;
            if (progress.repetitions === 1) return 6;
            let interval = Math.round(progress.interval * progress.easeFactor);
            if (quality === 3) interval = Math.round(interval * 1.3);
            return Math.max(1, interval);
        }

        function flipCard() {
            isFlipped = !isFlipped;
            const flashcard = document.getElementById('flashcard');
            const ratingButtons = document.getElementById('ratingButtons');

            if (flashcard) {
                flashcard.classList.toggle('flipped', isFlipped);
            }
            if (ratingButtons) {
                ratingButtons.style.display = isFlipped ? 'flex' : 'none';
            }
        }

        function rateCard(quality) {
            const card = studyQueue[state.currentCardIndex];
            const cardKey = `${currentStudyDeck.id}_${card.front}`;

            updateCardProgress(cardKey, quality);

            // If failed, add card back to queue
            if (quality === 0) {
                const reinsertPos = Math.min(
                    state.currentCardIndex + 3 + Math.floor(Math.random() * 3),
                    studyQueue.length
                );
                studyQueue.splice(reinsertPos, 0, card);
            }

            state.currentCardIndex++;
            isFlipped = false;
            renderStudyPage();
        }

        function renderSessionComplete() {
            const content = document.getElementById('studyContent');
            const { studied, correct, wrong } = state.sessionStats;
            const accuracy = studied > 0 ? Math.round((correct / studied) * 100) : 0;

            content.innerHTML = `
                <div class="session-complete">
                    <div class="session-complete-icon">üéâ</div>
                    <h2>–°–µ—Å—ñ—é –∑–∞–≤–µ—Ä—à–µ–Ω–æ!</h2>
                    <p>–ß—É–¥–æ–≤–∞ —Ä–æ–±–æ—Ç–∞! –û—Å—å –≤–∞—à—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏:</p>
                    <div class="session-stats">
                        <div class="session-stat">
                            <div class="session-stat-value">${studied}</div>
                            <div class="session-stat-label">–í–∏–≤—á–µ–Ω–æ</div>
                        </div>
                        <div class="session-stat">
                            <div class="session-stat-value" style="color:var(--success)">${correct}</div>
                            <div class="session-stat-label">–ü—Ä–∞–≤–∏–ª—å–Ω–æ</div>
                        </div>
                        <div class="session-stat">
                            <div class="session-stat-value" style="color:var(--danger)">${wrong}</div>
                            <div class="session-stat-label">–ù–∞ –ø–æ–≤—Ç–æ—Ä</div>
                        </div>
                        <div class="session-stat">
                            <div class="session-stat-value">${accuracy}%</div>
                            <div class="session-stat-label">–¢–æ—á–Ω—ñ—Å—Ç—å</div>
                        </div>
                    </div>
                    <div style="display:flex;gap:10px;justify-content:center;flex-wrap:wrap;">
                        <button class="btn btn-primary" onclick="startStudy('${currentStudyDeck.id}')">
                            üîÑ –©–µ —Ä–∞–∑
                        </button>
                        <button class="btn btn-secondary" onclick="document.querySelector('[data-page=decks]').click()">
                            üìö –î–æ –∫–æ–ª–æ–¥
                        </button>
                    </div>
                </div>
            `;

            updateStreak();
            updateHeaderStats();
        }

        // Keyboard support
        document.addEventListener('keydown', (e) => {
            if (!document.getElementById('page-study').classList.contains('active')) return;
            if (!currentStudyDeck || state.currentCardIndex >= studyQueue.length) return;

            if (e.code === 'Space' || e.code === 'Enter') {
                e.preventDefault();
                if (!isFlipped) {
                    flipCard();
                }
            } else if (isFlipped) {
                switch (e.key) {
                    case '1': rateCard(0); break;
                    case '2': rateCard(1); break;
                    case '3': rateCard(2); break;
                    case '4': rateCard(3); break;
                }
            }
        });

        // ==================== WORDS PAGE ====================
        let currentFilter = 'all';

        function renderWordList() {
            const content = document.getElementById('wordListContent');
            let allCards = [];

            state.decks.forEach(deck => {
                deck.cards.forEach(card => {
                    const key = `${deck.id}_${card.front}`;
                    allCards.push({
                        ...card,
                        deckId: deck.id,
                        deckName: deck.name,
                        key,
                        mastery: getMasteryLevel(key)
                    });
                });
            });

            // Remove duplicates by front word
            const seen = new Set();
            allCards = allCards.filter(c => {
                if (seen.has(c.front)) return false;
                seen.add(c.front);
                return true;
            });

            if (currentFilter !== 'all') {
                allCards = allCards.filter(c => c.level === currentFilter);
            }

            // Sort: least mastered first
            allCards.sort((a, b) => a.mastery - b.mastery);

            if (allCards.length === 0) {
                content.innerHTML = '<div style="padding:40px;text-align:center;color:var(--text-secondary)">–ù–µ–º–∞—î —Å–ª—ñ–≤ –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è</div>';
                return;
            }

            content.innerHTML = allCards.map(card => `
                <div class="word-item">
                    <span class="word-level-badge ${card.level}">${card.level.toUpperCase()}</span>
                    <span class="word-english">${card.front}</span>
                    <span class="word-translation">${card.back}</span>
                    <div class="word-mastery">
                        <div class="mastery-dots">
                            ${[1,2,3,4,5].map(i => `<div class="mastery-dot ${i <= card.mastery ? 'filled' : ''}"></div>`).join('')}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Filter buttons
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentFilter = btn.dataset.filter;
                renderWordList();
            });
        });

        // ==================== STATS PAGE ====================
        function renderStats() {
            // Calculate stats
            let totalCards = 0;
            let masteredCards = 0;
            let reviewedCards = 0;
            let totalReviews = 0;

            state.decks.forEach(deck => {
                deck.cards.forEach(card => {
                    totalCards++;
                    const key = `${deck.id}_${card.front}`;
                    const progress = state.cardProgress[key];
                    if (progress && progress.lastReview !== null) {
                        reviewedCards++;
                        totalReviews += progress.repetitions;
                        if (progress.repetitions >= 3) masteredCards++;
                    }
                });
            });

            const totalDays = state.studyHistory.length;
            const totalStudied = state.studyHistory.reduce((sum, h) => sum + h.cardsStudied, 0);
            const totalCorrect = state.studyHistory.reduce((sum, h) => sum + h.correct, 0);
            const avgAccuracy = totalStudied > 0 ? Math.round((totalCorrect / totalStudied) * 100) : 0;

            // Stats grid
            document.getElementById('statsGrid').innerHTML = `
                <div class="stat-card">
                    <div class="stat-card-icon">üìö</div>
                    <div class="stat-card-value">${totalCards}</div>
                    <div class="stat-card-label">–í—Å—å–æ–≥–æ –∫–∞—Ä—Ç–æ–∫</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-icon">‚úÖ</div>
                    <div class="stat-card-value">${masteredCards}</div>
                    <div class="stat-card-label">–í–∏–≤—á–µ–Ω–æ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-icon">üîÑ</div>
                    <div class="stat-card-value">${reviewedCards}</div>
                    <div class="stat-card-label">–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–æ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-icon">üî•</div>
                    <div class="stat-card-value">${state.streak}</div>
                    <div class="stat-card-label">–°–µ—Ä—ñ—è –¥–Ω—ñ–≤</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-icon">üìä</div>
                    <div class="stat-card-value">${avgAccuracy}%</div>
                    <div class="stat-card-label">–¢–æ—á–Ω—ñ—Å—Ç—å</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-icon">üìÖ</div>
                    <div class="stat-card-value">${totalDays}</div>
                    <div class="stat-card-label">–î–Ω—ñ–≤ –Ω–∞–≤—á–∞–Ω–Ω—è</div>
                </div>
            `;

            // Streak calendar (last 30 days)
            const streakDays = document.getElementById('streakDays');
            const days = [];
            for (let i = 29; i >= 0; i--) {
                const date = new Date(Date.now() - i * 86400000);
                const dateStr = date.toDateString();
                const hasStudy = state.studyHistory.some(h => h.date === dateStr);
                const isToday = i === 0;
                days.push(`
                    <div class="streak-day ${hasStudy ? 'active' : ''} ${isToday ? 'today' : ''}" 
                         title="${date.toLocaleDateString('uk-UA')}">
                        ${date.getDate()}
                    </div>
                `);
            }
            streakDays.innerHTML = days.join('');

            // Level progress
            const levelStats = { b1: { total: 0, mastered: 0 }, b2: { total: 0, mastered: 0 }, c1: { total: 0, mastered: 0 } };

            state.decks.forEach(deck => {
                if (!deck.isDefault) return;
                deck.cards.forEach(card => {
                    const level = card.level || deck.level;
                    if (levelStats[level]) {
                        levelStats[level].total++;
                        const key = `${deck.id}_${card.front}`;
                        if (getMasteryLevel(key) >= 3) levelStats[level].mastered++;
                    }
                });
            });

            const levelColors = { b1: 'var(--success)', b2: 'var(--warning)', c1: 'var(--danger)' };
            const levelNames = { b1: 'B1 - –°–µ—Ä–µ–¥–Ω—ñ–π', b2: 'B2 - –í–∏—â–µ —Å–µ—Ä–µ–¥–Ω—å–æ–≥–æ', c1: 'C1 - –ü—Ä–æ—Å—É–Ω—É—Ç–∏–π' };

            document.getElementById('levelProgress').innerHTML = Object.entries(levelStats).map(([level, stats]) => {
                const pct = stats.total > 0 ? Math.round((stats.mastered / stats.total) * 100) : 0;
                return `
                    <div class="word-item" style="flex-direction:column;align-items:stretch;gap:8px;">
                        <div style="display:flex;justify-content:space-between;align-items:center;">
                            <span style="font-weight:600;">${levelNames[level]}</span>
                            <span style="color:var(--text-secondary);font-size:0.85em;">${stats.mastered}/${stats.total} (${pct}%)</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width:${pct}%;background:${levelColors[level]}"></div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ==================== TOUCH SUPPORT ====================
        let touchStartX = 0;
        let touchStartY = 0;

        document.addEventListener('touchstart', (e) => {
            touchStartX = e.touches[0].clientX;
            touchStartY = e.touches[0].clientY;
        }, { passive: true });

        document.addEventListener('touchend', (e) => {
            if (!document.getElementById('page-study').classList.contains('active')) return;
            if (!currentStudyDeck || state.currentCardIndex >= studyQueue.length) return;

            const touchEndX = e.changedTouches[0].clientX;
            const touchEndY = e.changedTouches[0].clientY;
            const diffX = touchEndX - touchStartX;
            const diffY = touchEndY - touchStartY;

            // Only handle horizontal swipes when card is flipped
            if (isFlipped && Math.abs(diffX) > 80 && Math.abs(diffX) > Math.abs(diffY)) {
                if (diffX > 0) {
                    rateCard(2); // Swipe right = good
                } else {
                    rateCard(0); // Swipe left = again
                }
            }
        }, { passive: true });

        // ==================== MODAL CLOSE ON OVERLAY CLICK ====================
        document.getElementById('createDeckModal').addEventListener('click', (e) => {
            if (e.target === document.getElementById('createDeckModal')) {
                closeCreateDeckModal();
            }
        });

        // ==================== INIT ====================
        function init() {
            loadState();
            updateHeaderStats();
            renderDecks();
        }

        init();
    </script>
</body>
</html>
